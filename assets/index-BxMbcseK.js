var eo=Object.defineProperty;var no=(n,t,e)=>t in n?eo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var U=(n,t,e)=>no(n,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();var so=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ro(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ei={exports:{}};(function(n,t){(function(e,s){n.exports=s()})(so,function(){var e=function(){function s(T){return o.appendChild(T.dom),T}function r(T){for(var P=0;P<o.children.length;P++)o.children[P].style.display=P===T?"block":"none";i=T}var i=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(T){T.preventDefault(),r(++i%o.children.length)},!1);var h=(performance||Date).now(),m=h,g=0,w=s(new e.Panel("FPS","#0ff","#002")),M=s(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var S=s(new e.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:o,addPanel:s,showPanel:r,begin:function(){h=(performance||Date).now()},end:function(){g++;var T=(performance||Date).now();if(M.update(T-h,200),T>m+1e3&&(w.update(1e3*g/(T-m),100),m=T,g=0,S)){var P=performance.memory;S.update(P.usedJSHeapSize/1048576,P.jsHeapSizeLimit/1048576)}return T},update:function(){h=this.end()},domElement:o,setMode:r}};return e.Panel=function(s,r,i){var o=1/0,h=0,m=Math.round,g=m(window.devicePixelRatio||1),w=80*g,M=48*g,S=3*g,T=2*g,P=3*g,H=15*g,N=74*g,V=30*g,Q=document.createElement("canvas");Q.width=w,Q.height=M,Q.style.cssText="width:80px;height:48px";var G=Q.getContext("2d");return G.font="bold "+9*g+"px Helvetica,Arial,sans-serif",G.textBaseline="top",G.fillStyle=i,G.fillRect(0,0,w,M),G.fillStyle=r,G.fillText(s,S,T),G.fillRect(P,H,N,V),G.fillStyle=i,G.globalAlpha=.9,G.fillRect(P,H,N,V),{dom:Q,update:function(j,ct){o=Math.min(o,j),h=Math.max(h,j),G.fillStyle=i,G.globalAlpha=1,G.fillRect(0,0,w,H),G.fillStyle=r,G.fillText(m(j)+" "+s+" ("+m(o)+"-"+m(h)+")",S,T),G.drawImage(Q,P+g,H,N-g,V,P,H,N-g,V),G.fillRect(P+N-g,H,g,V),G.fillStyle=i,G.globalAlpha=.9,G.fillRect(P+N-g,H,g,m((1-j/ct)*V))}}},e})})(ei);var io=ei.exports;const oo=ro(io);function ao(n,t){return class extends n{constructor(...e){super(...e),t(this)}}}const co=ao(Array,n=>n.fill(0));let Y=1e-6;function ho(n){function t(a=0,p=0){const c=new n(2);return a!==void 0&&(c[0]=a,p!==void 0&&(c[1]=p)),c}const e=t;function s(a,p,c){const l=c??new n(2);return l[0]=a,l[1]=p,l}function r(a,p){const c=p??new n(2);return c[0]=Math.ceil(a[0]),c[1]=Math.ceil(a[1]),c}function i(a,p){const c=p??new n(2);return c[0]=Math.floor(a[0]),c[1]=Math.floor(a[1]),c}function o(a,p){const c=p??new n(2);return c[0]=Math.round(a[0]),c[1]=Math.round(a[1]),c}function h(a,p=0,c=1,l){const B=l??new n(2);return B[0]=Math.min(c,Math.max(p,a[0])),B[1]=Math.min(c,Math.max(p,a[1])),B}function m(a,p,c){const l=c??new n(2);return l[0]=a[0]+p[0],l[1]=a[1]+p[1],l}function g(a,p,c,l){const B=l??new n(2);return B[0]=a[0]+p[0]*c,B[1]=a[1]+p[1]*c,B}function w(a,p){const c=a[0],l=a[1],B=p[0],E=p[1],v=Math.sqrt(c*c+l*l),A=Math.sqrt(B*B+E*E),y=v*A,_=y&&kt(a,p)/y;return Math.acos(_)}function M(a,p,c){const l=c??new n(2);return l[0]=a[0]-p[0],l[1]=a[1]-p[1],l}const S=M;function T(a,p){return Math.abs(a[0]-p[0])<Y&&Math.abs(a[1]-p[1])<Y}function P(a,p){return a[0]===p[0]&&a[1]===p[1]}function H(a,p,c,l){const B=l??new n(2);return B[0]=a[0]+c*(p[0]-a[0]),B[1]=a[1]+c*(p[1]-a[1]),B}function N(a,p,c,l){const B=l??new n(2);return B[0]=a[0]+c[0]*(p[0]-a[0]),B[1]=a[1]+c[1]*(p[1]-a[1]),B}function V(a,p,c){const l=c??new n(2);return l[0]=Math.max(a[0],p[0]),l[1]=Math.max(a[1],p[1]),l}function Q(a,p,c){const l=c??new n(2);return l[0]=Math.min(a[0],p[0]),l[1]=Math.min(a[1],p[1]),l}function G(a,p,c){const l=c??new n(2);return l[0]=a[0]*p,l[1]=a[1]*p,l}const j=G;function ct(a,p,c){const l=c??new n(2);return l[0]=a[0]/p,l[1]=a[1]/p,l}function gt(a,p){const c=p??new n(2);return c[0]=1/a[0],c[1]=1/a[1],c}const Ct=gt;function Jt(a,p,c){const l=c??new n(3),B=a[0]*p[1]-a[1]*p[0];return l[0]=0,l[1]=0,l[2]=B,l}function kt(a,p){return a[0]*p[0]+a[1]*p[1]}function Bt(a){const p=a[0],c=a[1];return Math.sqrt(p*p+c*c)}const Yt=Bt;function tt(a){const p=a[0],c=a[1];return p*p+c*c}const rt=tt;function Z(a,p){const c=a[0]-p[0],l=a[1]-p[1];return Math.sqrt(c*c+l*l)}const ee=Z;function Tt(a,p){const c=a[0]-p[0],l=a[1]-p[1];return c*c+l*l}const ne=Tt;function Ft(a,p){const c=p??new n(2),l=a[0],B=a[1],E=Math.sqrt(l*l+B*B);return E>1e-5?(c[0]=l/E,c[1]=B/E):(c[0]=0,c[1]=0),c}function se(a,p){const c=p??new n(2);return c[0]=-a[0],c[1]=-a[1],c}function at(a,p){const c=p??new n(2);return c[0]=a[0],c[1]=a[1],c}const re=at;function Ut(a,p,c){const l=c??new n(2);return l[0]=a[0]*p[0],l[1]=a[1]*p[1],l}const ie=Ut;function Lt(a,p,c){const l=c??new n(2);return l[0]=a[0]/p[0],l[1]=a[1]/p[1],l}const $t=Lt;function zt(a=1,p){const c=p??new n(2),l=Math.random()*2*Math.PI;return c[0]=Math.cos(l)*a,c[1]=Math.sin(l)*a,c}function f(a){const p=a??new n(2);return p[0]=0,p[1]=0,p}function C(a,p,c){const l=c??new n(2),B=a[0],E=a[1];return l[0]=B*p[0]+E*p[4]+p[12],l[1]=B*p[1]+E*p[5]+p[13],l}function u(a,p,c){const l=c??new n(2),B=a[0],E=a[1];return l[0]=p[0]*B+p[4]*E+p[8],l[1]=p[1]*B+p[5]*E+p[9],l}function d(a,p,c,l){const B=l??new n(2),E=a[0]-p[0],v=a[1]-p[1],A=Math.sin(c),y=Math.cos(c);return B[0]=E*y-v*A+p[0],B[1]=E*A+v*y+p[1],B}function b(a,p,c){const l=c??new n(2);return Ft(a,l),G(l,p,l)}function x(a,p,c){const l=c??new n(2);return Bt(a)>p?b(a,p,l):at(a,l)}function I(a,p,c){const l=c??new n(2);return H(a,p,.5,l)}return{create:t,fromValues:e,set:s,ceil:r,floor:i,round:o,clamp:h,add:m,addScaled:g,angle:w,subtract:M,sub:S,equalsApproximately:T,equals:P,lerp:H,lerpV:N,max:V,min:Q,mulScalar:G,scale:j,divScalar:ct,inverse:gt,invert:Ct,cross:Jt,dot:kt,length:Bt,len:Yt,lengthSq:tt,lenSq:rt,distance:Z,dist:ee,distanceSq:Tt,distSq:ne,normalize:Ft,negate:se,copy:at,clone:re,multiply:Ut,mul:ie,divide:Lt,div:$t,random:zt,zero:f,transformMat4:C,transformMat3:u,rotate:d,setLength:b,truncate:x,midpoint:I}}const $s=new Map;function ni(n){let t=$s.get(n);return t||(t=ho(n),$s.set(n,t)),t}function uo(n){function t(A,y,_){const D=new n(3);return A!==void 0&&(D[0]=A,y!==void 0&&(D[1]=y,_!==void 0&&(D[2]=_))),D}const e=t;function s(A,y,_,D){const F=D??new n(3);return F[0]=A,F[1]=y,F[2]=_,F}function r(A,y){const _=y??new n(3);return _[0]=Math.ceil(A[0]),_[1]=Math.ceil(A[1]),_[2]=Math.ceil(A[2]),_}function i(A,y){const _=y??new n(3);return _[0]=Math.floor(A[0]),_[1]=Math.floor(A[1]),_[2]=Math.floor(A[2]),_}function o(A,y){const _=y??new n(3);return _[0]=Math.round(A[0]),_[1]=Math.round(A[1]),_[2]=Math.round(A[2]),_}function h(A,y=0,_=1,D){const F=D??new n(3);return F[0]=Math.min(_,Math.max(y,A[0])),F[1]=Math.min(_,Math.max(y,A[1])),F[2]=Math.min(_,Math.max(y,A[2])),F}function m(A,y,_){const D=_??new n(3);return D[0]=A[0]+y[0],D[1]=A[1]+y[1],D[2]=A[2]+y[2],D}function g(A,y,_,D){const F=D??new n(3);return F[0]=A[0]+y[0]*_,F[1]=A[1]+y[1]*_,F[2]=A[2]+y[2]*_,F}function w(A,y){const _=A[0],D=A[1],F=A[2],R=y[0],O=y[1],k=y[2],K=Math.sqrt(_*_+D*D+F*F),J=Math.sqrt(R*R+O*O+k*k),z=K*J,$=z&&kt(A,y)/z;return Math.acos($)}function M(A,y,_){const D=_??new n(3);return D[0]=A[0]-y[0],D[1]=A[1]-y[1],D[2]=A[2]-y[2],D}const S=M;function T(A,y){return Math.abs(A[0]-y[0])<Y&&Math.abs(A[1]-y[1])<Y&&Math.abs(A[2]-y[2])<Y}function P(A,y){return A[0]===y[0]&&A[1]===y[1]&&A[2]===y[2]}function H(A,y,_,D){const F=D??new n(3);return F[0]=A[0]+_*(y[0]-A[0]),F[1]=A[1]+_*(y[1]-A[1]),F[2]=A[2]+_*(y[2]-A[2]),F}function N(A,y,_,D){const F=D??new n(3);return F[0]=A[0]+_[0]*(y[0]-A[0]),F[1]=A[1]+_[1]*(y[1]-A[1]),F[2]=A[2]+_[2]*(y[2]-A[2]),F}function V(A,y,_){const D=_??new n(3);return D[0]=Math.max(A[0],y[0]),D[1]=Math.max(A[1],y[1]),D[2]=Math.max(A[2],y[2]),D}function Q(A,y,_){const D=_??new n(3);return D[0]=Math.min(A[0],y[0]),D[1]=Math.min(A[1],y[1]),D[2]=Math.min(A[2],y[2]),D}function G(A,y,_){const D=_??new n(3);return D[0]=A[0]*y,D[1]=A[1]*y,D[2]=A[2]*y,D}const j=G;function ct(A,y,_){const D=_??new n(3);return D[0]=A[0]/y,D[1]=A[1]/y,D[2]=A[2]/y,D}function gt(A,y){const _=y??new n(3);return _[0]=1/A[0],_[1]=1/A[1],_[2]=1/A[2],_}const Ct=gt;function Jt(A,y,_){const D=_??new n(3),F=A[2]*y[0]-A[0]*y[2],R=A[0]*y[1]-A[1]*y[0];return D[0]=A[1]*y[2]-A[2]*y[1],D[1]=F,D[2]=R,D}function kt(A,y){return A[0]*y[0]+A[1]*y[1]+A[2]*y[2]}function Bt(A){const y=A[0],_=A[1],D=A[2];return Math.sqrt(y*y+_*_+D*D)}const Yt=Bt;function tt(A){const y=A[0],_=A[1],D=A[2];return y*y+_*_+D*D}const rt=tt;function Z(A,y){const _=A[0]-y[0],D=A[1]-y[1],F=A[2]-y[2];return Math.sqrt(_*_+D*D+F*F)}const ee=Z;function Tt(A,y){const _=A[0]-y[0],D=A[1]-y[1],F=A[2]-y[2];return _*_+D*D+F*F}const ne=Tt;function Ft(A,y){const _=y??new n(3),D=A[0],F=A[1],R=A[2],O=Math.sqrt(D*D+F*F+R*R);return O>1e-5?(_[0]=D/O,_[1]=F/O,_[2]=R/O):(_[0]=0,_[1]=0,_[2]=0),_}function se(A,y){const _=y??new n(3);return _[0]=-A[0],_[1]=-A[1],_[2]=-A[2],_}function at(A,y){const _=y??new n(3);return _[0]=A[0],_[1]=A[1],_[2]=A[2],_}const re=at;function Ut(A,y,_){const D=_??new n(3);return D[0]=A[0]*y[0],D[1]=A[1]*y[1],D[2]=A[2]*y[2],D}const ie=Ut;function Lt(A,y,_){const D=_??new n(3);return D[0]=A[0]/y[0],D[1]=A[1]/y[1],D[2]=A[2]/y[2],D}const $t=Lt;function zt(A=1,y){const _=y??new n(3),D=Math.random()*2*Math.PI,F=Math.random()*2-1,R=Math.sqrt(1-F*F)*A;return _[0]=Math.cos(D)*R,_[1]=Math.sin(D)*R,_[2]=F*A,_}function f(A){const y=A??new n(3);return y[0]=0,y[1]=0,y[2]=0,y}function C(A,y,_){const D=_??new n(3),F=A[0],R=A[1],O=A[2],k=y[3]*F+y[7]*R+y[11]*O+y[15]||1;return D[0]=(y[0]*F+y[4]*R+y[8]*O+y[12])/k,D[1]=(y[1]*F+y[5]*R+y[9]*O+y[13])/k,D[2]=(y[2]*F+y[6]*R+y[10]*O+y[14])/k,D}function u(A,y,_){const D=_??new n(3),F=A[0],R=A[1],O=A[2];return D[0]=F*y[0*4+0]+R*y[1*4+0]+O*y[2*4+0],D[1]=F*y[0*4+1]+R*y[1*4+1]+O*y[2*4+1],D[2]=F*y[0*4+2]+R*y[1*4+2]+O*y[2*4+2],D}function d(A,y,_){const D=_??new n(3),F=A[0],R=A[1],O=A[2];return D[0]=F*y[0]+R*y[4]+O*y[8],D[1]=F*y[1]+R*y[5]+O*y[9],D[2]=F*y[2]+R*y[6]+O*y[10],D}function b(A,y,_){const D=_??new n(3),F=y[0],R=y[1],O=y[2],k=y[3]*2,K=A[0],J=A[1],z=A[2],$=R*z-O*J,et=O*K-F*z,lt=F*J-R*K;return D[0]=K+$*k+(R*lt-O*et)*2,D[1]=J+et*k+(O*$-F*lt)*2,D[2]=z+lt*k+(F*et-R*$)*2,D}function x(A,y){const _=y??new n(3);return _[0]=A[12],_[1]=A[13],_[2]=A[14],_}function I(A,y,_){const D=_??new n(3),F=y*4;return D[0]=A[F+0],D[1]=A[F+1],D[2]=A[F+2],D}function a(A,y){const _=y??new n(3),D=A[0],F=A[1],R=A[2],O=A[4],k=A[5],K=A[6],J=A[8],z=A[9],$=A[10];return _[0]=Math.sqrt(D*D+F*F+R*R),_[1]=Math.sqrt(O*O+k*k+K*K),_[2]=Math.sqrt(J*J+z*z+$*$),_}function p(A,y,_,D){const F=D??new n(3),R=[],O=[];return R[0]=A[0]-y[0],R[1]=A[1]-y[1],R[2]=A[2]-y[2],O[0]=R[0],O[1]=R[1]*Math.cos(_)-R[2]*Math.sin(_),O[2]=R[1]*Math.sin(_)+R[2]*Math.cos(_),F[0]=O[0]+y[0],F[1]=O[1]+y[1],F[2]=O[2]+y[2],F}function c(A,y,_,D){const F=D??new n(3),R=[],O=[];return R[0]=A[0]-y[0],R[1]=A[1]-y[1],R[2]=A[2]-y[2],O[0]=R[2]*Math.sin(_)+R[0]*Math.cos(_),O[1]=R[1],O[2]=R[2]*Math.cos(_)-R[0]*Math.sin(_),F[0]=O[0]+y[0],F[1]=O[1]+y[1],F[2]=O[2]+y[2],F}function l(A,y,_,D){const F=D??new n(3),R=[],O=[];return R[0]=A[0]-y[0],R[1]=A[1]-y[1],R[2]=A[2]-y[2],O[0]=R[0]*Math.cos(_)-R[1]*Math.sin(_),O[1]=R[0]*Math.sin(_)+R[1]*Math.cos(_),O[2]=R[2],F[0]=O[0]+y[0],F[1]=O[1]+y[1],F[2]=O[2]+y[2],F}function B(A,y,_){const D=_??new n(3);return Ft(A,D),G(D,y,D)}function E(A,y,_){const D=_??new n(3);return Bt(A)>y?B(A,y,D):at(A,D)}function v(A,y,_){const D=_??new n(3);return H(A,y,.5,D)}return{create:t,fromValues:e,set:s,ceil:r,floor:i,round:o,clamp:h,add:m,addScaled:g,angle:w,subtract:M,sub:S,equalsApproximately:T,equals:P,lerp:H,lerpV:N,max:V,min:Q,mulScalar:G,scale:j,divScalar:ct,inverse:gt,invert:Ct,cross:Jt,dot:kt,length:Bt,len:Yt,lengthSq:tt,lenSq:rt,distance:Z,dist:ee,distanceSq:Tt,distSq:ne,normalize:Ft,negate:se,copy:at,clone:re,multiply:Ut,mul:ie,divide:Lt,div:$t,random:zt,zero:f,transformMat4:C,transformMat4Upper3x3:u,transformMat3:d,transformQuat:b,getTranslation:x,getAxis:I,getScaling:a,rotateX:p,rotateY:c,rotateZ:l,setLength:B,truncate:E,midpoint:v}}const qs=new Map;function Hn(n){let t=qs.get(n);return t||(t=uo(n),qs.set(n,t)),t}function lo(n){const t=ni(n),e=Hn(n);function s(f,C,u,d,b,x,I,a,p){const c=new n(12);return c[3]=0,c[7]=0,c[11]=0,f!==void 0&&(c[0]=f,C!==void 0&&(c[1]=C,u!==void 0&&(c[2]=u,d!==void 0&&(c[4]=d,b!==void 0&&(c[5]=b,x!==void 0&&(c[6]=x,I!==void 0&&(c[8]=I,a!==void 0&&(c[9]=a,p!==void 0&&(c[10]=p))))))))),c}function r(f,C,u,d,b,x,I,a,p,c){const l=c??new n(12);return l[0]=f,l[1]=C,l[2]=u,l[3]=0,l[4]=d,l[5]=b,l[6]=x,l[7]=0,l[8]=I,l[9]=a,l[10]=p,l[11]=0,l}function i(f,C){const u=C??new n(12);return u[0]=f[0],u[1]=f[1],u[2]=f[2],u[3]=0,u[4]=f[4],u[5]=f[5],u[6]=f[6],u[7]=0,u[8]=f[8],u[9]=f[9],u[10]=f[10],u[11]=0,u}function o(f,C){const u=C??new n(12),d=f[0],b=f[1],x=f[2],I=f[3],a=d+d,p=b+b,c=x+x,l=d*a,B=b*a,E=b*p,v=x*a,A=x*p,y=x*c,_=I*a,D=I*p,F=I*c;return u[0]=1-E-y,u[1]=B+F,u[2]=v-D,u[3]=0,u[4]=B-F,u[5]=1-l-y,u[6]=A+_,u[7]=0,u[8]=v+D,u[9]=A-_,u[10]=1-l-E,u[11]=0,u}function h(f,C){const u=C??new n(12);return u[0]=-f[0],u[1]=-f[1],u[2]=-f[2],u[4]=-f[4],u[5]=-f[5],u[6]=-f[6],u[8]=-f[8],u[9]=-f[9],u[10]=-f[10],u}function m(f,C){const u=C??new n(12);return u[0]=f[0],u[1]=f[1],u[2]=f[2],u[4]=f[4],u[5]=f[5],u[6]=f[6],u[8]=f[8],u[9]=f[9],u[10]=f[10],u}const g=m;function w(f,C){return Math.abs(f[0]-C[0])<Y&&Math.abs(f[1]-C[1])<Y&&Math.abs(f[2]-C[2])<Y&&Math.abs(f[4]-C[4])<Y&&Math.abs(f[5]-C[5])<Y&&Math.abs(f[6]-C[6])<Y&&Math.abs(f[8]-C[8])<Y&&Math.abs(f[9]-C[9])<Y&&Math.abs(f[10]-C[10])<Y}function M(f,C){return f[0]===C[0]&&f[1]===C[1]&&f[2]===C[2]&&f[4]===C[4]&&f[5]===C[5]&&f[6]===C[6]&&f[8]===C[8]&&f[9]===C[9]&&f[10]===C[10]}function S(f){const C=f??new n(12);return C[0]=1,C[1]=0,C[2]=0,C[4]=0,C[5]=1,C[6]=0,C[8]=0,C[9]=0,C[10]=1,C}function T(f,C){const u=C??new n(12);if(u===f){let E;return E=f[1],f[1]=f[4],f[4]=E,E=f[2],f[2]=f[8],f[8]=E,E=f[6],f[6]=f[9],f[9]=E,u}const d=f[0*4+0],b=f[0*4+1],x=f[0*4+2],I=f[1*4+0],a=f[1*4+1],p=f[1*4+2],c=f[2*4+0],l=f[2*4+1],B=f[2*4+2];return u[0]=d,u[1]=I,u[2]=c,u[4]=b,u[5]=a,u[6]=l,u[8]=x,u[9]=p,u[10]=B,u}function P(f,C){const u=C??new n(12),d=f[0*4+0],b=f[0*4+1],x=f[0*4+2],I=f[1*4+0],a=f[1*4+1],p=f[1*4+2],c=f[2*4+0],l=f[2*4+1],B=f[2*4+2],E=B*a-p*l,v=-B*I+p*c,A=l*I-a*c,y=1/(d*E+b*v+x*A);return u[0]=E*y,u[1]=(-B*b+x*l)*y,u[2]=(p*b-x*a)*y,u[4]=v*y,u[5]=(B*d-x*c)*y,u[6]=(-p*d+x*I)*y,u[8]=A*y,u[9]=(-l*d+b*c)*y,u[10]=(a*d-b*I)*y,u}function H(f){const C=f[0],u=f[0*4+1],d=f[0*4+2],b=f[1*4+0],x=f[1*4+1],I=f[1*4+2],a=f[2*4+0],p=f[2*4+1],c=f[2*4+2];return C*(x*c-p*I)-b*(u*c-p*d)+a*(u*I-x*d)}const N=P;function V(f,C,u){const d=u??new n(12),b=f[0],x=f[1],I=f[2],a=f[4],p=f[5],c=f[6],l=f[8],B=f[9],E=f[10],v=C[0],A=C[1],y=C[2],_=C[4],D=C[5],F=C[6],R=C[8],O=C[9],k=C[10];return d[0]=b*v+a*A+l*y,d[1]=x*v+p*A+B*y,d[2]=I*v+c*A+E*y,d[4]=b*_+a*D+l*F,d[5]=x*_+p*D+B*F,d[6]=I*_+c*D+E*F,d[8]=b*R+a*O+l*k,d[9]=x*R+p*O+B*k,d[10]=I*R+c*O+E*k,d}const Q=V;function G(f,C,u){const d=u??S();return f!==d&&(d[0]=f[0],d[1]=f[1],d[2]=f[2],d[4]=f[4],d[5]=f[5],d[6]=f[6]),d[8]=C[0],d[9]=C[1],d[10]=1,d}function j(f,C){const u=C??t.create();return u[0]=f[8],u[1]=f[9],u}function ct(f,C,u){const d=u??t.create(),b=C*4;return d[0]=f[b+0],d[1]=f[b+1],d}function gt(f,C,u,d){const b=d===f?f:m(f,d),x=u*4;return b[x+0]=C[0],b[x+1]=C[1],b}function Ct(f,C){const u=C??t.create(),d=f[0],b=f[1],x=f[4],I=f[5];return u[0]=Math.sqrt(d*d+b*b),u[1]=Math.sqrt(x*x+I*I),u}function Jt(f,C){const u=C??e.create(),d=f[0],b=f[1],x=f[2],I=f[4],a=f[5],p=f[6],c=f[8],l=f[9],B=f[10];return u[0]=Math.sqrt(d*d+b*b+x*x),u[1]=Math.sqrt(I*I+a*a+p*p),u[2]=Math.sqrt(c*c+l*l+B*B),u}function kt(f,C){const u=C??new n(12);return u[0]=1,u[1]=0,u[2]=0,u[4]=0,u[5]=1,u[6]=0,u[8]=f[0],u[9]=f[1],u[10]=1,u}function Bt(f,C,u){const d=u??new n(12),b=C[0],x=C[1],I=f[0],a=f[1],p=f[2],c=f[1*4+0],l=f[1*4+1],B=f[1*4+2],E=f[2*4+0],v=f[2*4+1],A=f[2*4+2];return f!==d&&(d[0]=I,d[1]=a,d[2]=p,d[4]=c,d[5]=l,d[6]=B),d[8]=I*b+c*x+E,d[9]=a*b+l*x+v,d[10]=p*b+B*x+A,d}function Yt(f,C){const u=C??new n(12),d=Math.cos(f),b=Math.sin(f);return u[0]=d,u[1]=b,u[2]=0,u[4]=-b,u[5]=d,u[6]=0,u[8]=0,u[9]=0,u[10]=1,u}function tt(f,C,u){const d=u??new n(12),b=f[0*4+0],x=f[0*4+1],I=f[0*4+2],a=f[1*4+0],p=f[1*4+1],c=f[1*4+2],l=Math.cos(C),B=Math.sin(C);return d[0]=l*b+B*a,d[1]=l*x+B*p,d[2]=l*I+B*c,d[4]=l*a-B*b,d[5]=l*p-B*x,d[6]=l*c-B*I,f!==d&&(d[8]=f[8],d[9]=f[9],d[10]=f[10]),d}function rt(f,C){const u=C??new n(12),d=Math.cos(f),b=Math.sin(f);return u[0]=1,u[1]=0,u[2]=0,u[4]=0,u[5]=d,u[6]=b,u[8]=0,u[9]=-b,u[10]=d,u}function Z(f,C,u){const d=u??new n(12),b=f[4],x=f[5],I=f[6],a=f[8],p=f[9],c=f[10],l=Math.cos(C),B=Math.sin(C);return d[4]=l*b+B*a,d[5]=l*x+B*p,d[6]=l*I+B*c,d[8]=l*a-B*b,d[9]=l*p-B*x,d[10]=l*c-B*I,f!==d&&(d[0]=f[0],d[1]=f[1],d[2]=f[2]),d}function ee(f,C){const u=C??new n(12),d=Math.cos(f),b=Math.sin(f);return u[0]=d,u[1]=0,u[2]=-b,u[4]=0,u[5]=1,u[6]=0,u[8]=b,u[9]=0,u[10]=d,u}function Tt(f,C,u){const d=u??new n(12),b=f[0*4+0],x=f[0*4+1],I=f[0*4+2],a=f[2*4+0],p=f[2*4+1],c=f[2*4+2],l=Math.cos(C),B=Math.sin(C);return d[0]=l*b-B*a,d[1]=l*x-B*p,d[2]=l*I-B*c,d[8]=l*a+B*b,d[9]=l*p+B*x,d[10]=l*c+B*I,f!==d&&(d[4]=f[4],d[5]=f[5],d[6]=f[6]),d}const ne=Yt,Ft=tt;function se(f,C){const u=C??new n(12);return u[0]=f[0],u[1]=0,u[2]=0,u[4]=0,u[5]=f[1],u[6]=0,u[8]=0,u[9]=0,u[10]=1,u}function at(f,C,u){const d=u??new n(12),b=C[0],x=C[1];return d[0]=b*f[0*4+0],d[1]=b*f[0*4+1],d[2]=b*f[0*4+2],d[4]=x*f[1*4+0],d[5]=x*f[1*4+1],d[6]=x*f[1*4+2],f!==d&&(d[8]=f[8],d[9]=f[9],d[10]=f[10]),d}function re(f,C){const u=C??new n(12);return u[0]=f[0],u[1]=0,u[2]=0,u[4]=0,u[5]=f[1],u[6]=0,u[8]=0,u[9]=0,u[10]=f[2],u}function Ut(f,C,u){const d=u??new n(12),b=C[0],x=C[1],I=C[2];return d[0]=b*f[0*4+0],d[1]=b*f[0*4+1],d[2]=b*f[0*4+2],d[4]=x*f[1*4+0],d[5]=x*f[1*4+1],d[6]=x*f[1*4+2],d[8]=I*f[2*4+0],d[9]=I*f[2*4+1],d[10]=I*f[2*4+2],d}function ie(f,C){const u=C??new n(12);return u[0]=f,u[1]=0,u[2]=0,u[4]=0,u[5]=f,u[6]=0,u[8]=0,u[9]=0,u[10]=1,u}function Lt(f,C,u){const d=u??new n(12);return d[0]=C*f[0*4+0],d[1]=C*f[0*4+1],d[2]=C*f[0*4+2],d[4]=C*f[1*4+0],d[5]=C*f[1*4+1],d[6]=C*f[1*4+2],f!==d&&(d[8]=f[8],d[9]=f[9],d[10]=f[10]),d}function $t(f,C){const u=C??new n(12);return u[0]=f,u[1]=0,u[2]=0,u[4]=0,u[5]=f,u[6]=0,u[8]=0,u[9]=0,u[10]=f,u}function zt(f,C,u){const d=u??new n(12);return d[0]=C*f[0*4+0],d[1]=C*f[0*4+1],d[2]=C*f[0*4+2],d[4]=C*f[1*4+0],d[5]=C*f[1*4+1],d[6]=C*f[1*4+2],d[8]=C*f[2*4+0],d[9]=C*f[2*4+1],d[10]=C*f[2*4+2],d}return{clone:g,create:s,set:r,fromMat4:i,fromQuat:o,negate:h,copy:m,equalsApproximately:w,equals:M,identity:S,transpose:T,inverse:P,invert:N,determinant:H,mul:Q,multiply:V,setTranslation:G,getTranslation:j,getAxis:ct,setAxis:gt,getScaling:Ct,get3DScaling:Jt,translation:kt,translate:Bt,rotation:Yt,rotate:tt,rotationX:rt,rotateX:Z,rotationY:ee,rotateY:Tt,rotationZ:ne,rotateZ:Ft,scaling:se,scale:at,uniformScaling:ie,uniformScale:Lt,scaling3D:re,scale3D:Ut,uniformScaling3D:$t,uniformScale3D:zt}}const Zs=new Map;function fo(n){let t=Zs.get(n);return t||(t=lo(n),Zs.set(n,t)),t}function po(n){const t=Hn(n);function e(a,p,c,l,B,E,v,A,y,_,D,F,R,O,k,K){const J=new n(16);return a!==void 0&&(J[0]=a,p!==void 0&&(J[1]=p,c!==void 0&&(J[2]=c,l!==void 0&&(J[3]=l,B!==void 0&&(J[4]=B,E!==void 0&&(J[5]=E,v!==void 0&&(J[6]=v,A!==void 0&&(J[7]=A,y!==void 0&&(J[8]=y,_!==void 0&&(J[9]=_,D!==void 0&&(J[10]=D,F!==void 0&&(J[11]=F,R!==void 0&&(J[12]=R,O!==void 0&&(J[13]=O,k!==void 0&&(J[14]=k,K!==void 0&&(J[15]=K)))))))))))))))),J}function s(a,p,c,l,B,E,v,A,y,_,D,F,R,O,k,K,J){const z=J??new n(16);return z[0]=a,z[1]=p,z[2]=c,z[3]=l,z[4]=B,z[5]=E,z[6]=v,z[7]=A,z[8]=y,z[9]=_,z[10]=D,z[11]=F,z[12]=R,z[13]=O,z[14]=k,z[15]=K,z}function r(a,p){const c=p??new n(16);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=0,c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=0,c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function i(a,p){const c=p??new n(16),l=a[0],B=a[1],E=a[2],v=a[3],A=l+l,y=B+B,_=E+E,D=l*A,F=B*A,R=B*y,O=E*A,k=E*y,K=E*_,J=v*A,z=v*y,$=v*_;return c[0]=1-R-K,c[1]=F+$,c[2]=O-z,c[3]=0,c[4]=F-$,c[5]=1-D-K,c[6]=k+J,c[7]=0,c[8]=O+z,c[9]=k-J,c[10]=1-D-R,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function o(a,p){const c=p??new n(16);return c[0]=-a[0],c[1]=-a[1],c[2]=-a[2],c[3]=-a[3],c[4]=-a[4],c[5]=-a[5],c[6]=-a[6],c[7]=-a[7],c[8]=-a[8],c[9]=-a[9],c[10]=-a[10],c[11]=-a[11],c[12]=-a[12],c[13]=-a[13],c[14]=-a[14],c[15]=-a[15],c}function h(a,p){const c=p??new n(16);return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c}const m=h;function g(a,p){return Math.abs(a[0]-p[0])<Y&&Math.abs(a[1]-p[1])<Y&&Math.abs(a[2]-p[2])<Y&&Math.abs(a[3]-p[3])<Y&&Math.abs(a[4]-p[4])<Y&&Math.abs(a[5]-p[5])<Y&&Math.abs(a[6]-p[6])<Y&&Math.abs(a[7]-p[7])<Y&&Math.abs(a[8]-p[8])<Y&&Math.abs(a[9]-p[9])<Y&&Math.abs(a[10]-p[10])<Y&&Math.abs(a[11]-p[11])<Y&&Math.abs(a[12]-p[12])<Y&&Math.abs(a[13]-p[13])<Y&&Math.abs(a[14]-p[14])<Y&&Math.abs(a[15]-p[15])<Y}function w(a,p){return a[0]===p[0]&&a[1]===p[1]&&a[2]===p[2]&&a[3]===p[3]&&a[4]===p[4]&&a[5]===p[5]&&a[6]===p[6]&&a[7]===p[7]&&a[8]===p[8]&&a[9]===p[9]&&a[10]===p[10]&&a[11]===p[11]&&a[12]===p[12]&&a[13]===p[13]&&a[14]===p[14]&&a[15]===p[15]}function M(a){const p=a??new n(16);return p[0]=1,p[1]=0,p[2]=0,p[3]=0,p[4]=0,p[5]=1,p[6]=0,p[7]=0,p[8]=0,p[9]=0,p[10]=1,p[11]=0,p[12]=0,p[13]=0,p[14]=0,p[15]=1,p}function S(a,p){const c=p??new n(16);if(c===a){let et;return et=a[1],a[1]=a[4],a[4]=et,et=a[2],a[2]=a[8],a[8]=et,et=a[3],a[3]=a[12],a[12]=et,et=a[6],a[6]=a[9],a[9]=et,et=a[7],a[7]=a[13],a[13]=et,et=a[11],a[11]=a[14],a[14]=et,c}const l=a[0*4+0],B=a[0*4+1],E=a[0*4+2],v=a[0*4+3],A=a[1*4+0],y=a[1*4+1],_=a[1*4+2],D=a[1*4+3],F=a[2*4+0],R=a[2*4+1],O=a[2*4+2],k=a[2*4+3],K=a[3*4+0],J=a[3*4+1],z=a[3*4+2],$=a[3*4+3];return c[0]=l,c[1]=A,c[2]=F,c[3]=K,c[4]=B,c[5]=y,c[6]=R,c[7]=J,c[8]=E,c[9]=_,c[10]=O,c[11]=z,c[12]=v,c[13]=D,c[14]=k,c[15]=$,c}function T(a,p){const c=p??new n(16),l=a[0*4+0],B=a[0*4+1],E=a[0*4+2],v=a[0*4+3],A=a[1*4+0],y=a[1*4+1],_=a[1*4+2],D=a[1*4+3],F=a[2*4+0],R=a[2*4+1],O=a[2*4+2],k=a[2*4+3],K=a[3*4+0],J=a[3*4+1],z=a[3*4+2],$=a[3*4+3],et=O*$,lt=z*k,dt=_*$,pt=z*D,yt=_*k,xt=O*D,Mt=E*$,_t=z*v,Et=E*k,Dt=O*v,It=E*D,vt=_*v,Rt=F*J,Gt=K*R,Vt=A*J,jt=K*y,Kt=A*R,ln=F*y,fn=l*J,dn=K*B,pn=l*R,An=F*B,mn=l*y,gn=A*B,Ws=et*y+pt*R+yt*J-(lt*y+dt*R+xt*J),Xs=lt*B+Mt*R+Dt*J-(et*B+_t*R+Et*J),Qs=dt*B+_t*y+It*J-(pt*B+Mt*y+vt*J),Ys=xt*B+Et*y+vt*R-(yt*B+Dt*y+It*R),St=1/(l*Ws+A*Xs+F*Qs+K*Ys);return c[0]=St*Ws,c[1]=St*Xs,c[2]=St*Qs,c[3]=St*Ys,c[4]=St*(lt*A+dt*F+xt*K-(et*A+pt*F+yt*K)),c[5]=St*(et*l+_t*F+Et*K-(lt*l+Mt*F+Dt*K)),c[6]=St*(pt*l+Mt*A+vt*K-(dt*l+_t*A+It*K)),c[7]=St*(yt*l+Dt*A+It*F-(xt*l+Et*A+vt*F)),c[8]=St*(Rt*D+jt*k+Kt*$-(Gt*D+Vt*k+ln*$)),c[9]=St*(Gt*v+fn*k+An*$-(Rt*v+dn*k+pn*$)),c[10]=St*(Vt*v+dn*D+mn*$-(jt*v+fn*D+gn*$)),c[11]=St*(ln*v+pn*D+gn*k-(Kt*v+An*D+mn*k)),c[12]=St*(Vt*O+ln*z+Gt*_-(Kt*z+Rt*_+jt*O)),c[13]=St*(pn*z+Rt*E+dn*O-(fn*O+An*z+Gt*E)),c[14]=St*(fn*_+gn*z+jt*E-(mn*z+Vt*E+dn*_)),c[15]=St*(mn*O+Kt*E+An*_-(pn*_+gn*O+ln*E)),c}function P(a){const p=a[0],c=a[0*4+1],l=a[0*4+2],B=a[0*4+3],E=a[1*4+0],v=a[1*4+1],A=a[1*4+2],y=a[1*4+3],_=a[2*4+0],D=a[2*4+1],F=a[2*4+2],R=a[2*4+3],O=a[3*4+0],k=a[3*4+1],K=a[3*4+2],J=a[3*4+3],z=F*J,$=K*R,et=A*J,lt=K*y,dt=A*R,pt=F*y,yt=l*J,xt=K*B,Mt=l*R,_t=F*B,Et=l*y,Dt=A*B,It=z*v+lt*D+dt*k-($*v+et*D+pt*k),vt=$*c+yt*D+_t*k-(z*c+xt*D+Mt*k),Rt=et*c+xt*v+Et*k-(lt*c+yt*v+Dt*k),Gt=pt*c+Mt*v+Dt*D-(dt*c+_t*v+Et*D);return p*It+E*vt+_*Rt+O*Gt}const H=T;function N(a,p,c){const l=c??new n(16),B=a[0],E=a[1],v=a[2],A=a[3],y=a[4],_=a[5],D=a[6],F=a[7],R=a[8],O=a[9],k=a[10],K=a[11],J=a[12],z=a[13],$=a[14],et=a[15],lt=p[0],dt=p[1],pt=p[2],yt=p[3],xt=p[4],Mt=p[5],_t=p[6],Et=p[7],Dt=p[8],It=p[9],vt=p[10],Rt=p[11],Gt=p[12],Vt=p[13],jt=p[14],Kt=p[15];return l[0]=B*lt+y*dt+R*pt+J*yt,l[1]=E*lt+_*dt+O*pt+z*yt,l[2]=v*lt+D*dt+k*pt+$*yt,l[3]=A*lt+F*dt+K*pt+et*yt,l[4]=B*xt+y*Mt+R*_t+J*Et,l[5]=E*xt+_*Mt+O*_t+z*Et,l[6]=v*xt+D*Mt+k*_t+$*Et,l[7]=A*xt+F*Mt+K*_t+et*Et,l[8]=B*Dt+y*It+R*vt+J*Rt,l[9]=E*Dt+_*It+O*vt+z*Rt,l[10]=v*Dt+D*It+k*vt+$*Rt,l[11]=A*Dt+F*It+K*vt+et*Rt,l[12]=B*Gt+y*Vt+R*jt+J*Kt,l[13]=E*Gt+_*Vt+O*jt+z*Kt,l[14]=v*Gt+D*Vt+k*jt+$*Kt,l[15]=A*Gt+F*Vt+K*jt+et*Kt,l}const V=N;function Q(a,p,c){const l=c??M();return a!==l&&(l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=a[7],l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11]),l[12]=p[0],l[13]=p[1],l[14]=p[2],l[15]=1,l}function G(a,p){const c=p??t.create();return c[0]=a[12],c[1]=a[13],c[2]=a[14],c}function j(a,p,c){const l=c??t.create(),B=p*4;return l[0]=a[B+0],l[1]=a[B+1],l[2]=a[B+2],l}function ct(a,p,c,l){const B=l===a?l:h(a,l),E=c*4;return B[E+0]=p[0],B[E+1]=p[1],B[E+2]=p[2],B}function gt(a,p){const c=p??t.create(),l=a[0],B=a[1],E=a[2],v=a[4],A=a[5],y=a[6],_=a[8],D=a[9],F=a[10];return c[0]=Math.sqrt(l*l+B*B+E*E),c[1]=Math.sqrt(v*v+A*A+y*y),c[2]=Math.sqrt(_*_+D*D+F*F),c}function Ct(a,p,c,l,B){const E=B??new n(16),v=Math.tan(Math.PI*.5-.5*a);if(E[0]=v/p,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=v,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,Number.isFinite(l)){const A=1/(c-l);E[10]=l*A,E[14]=l*c*A}else E[10]=-1,E[14]=-c;return E}function Jt(a,p,c,l=1/0,B){const E=B??new n(16),v=1/Math.tan(a*.5);if(E[0]=v/p,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=v,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,l===1/0)E[10]=0,E[14]=c;else{const A=1/(l-c);E[10]=c*A,E[14]=l*c*A}return E}function kt(a,p,c,l,B,E,v){const A=v??new n(16);return A[0]=2/(p-a),A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=2/(l-c),A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1/(B-E),A[11]=0,A[12]=(p+a)/(a-p),A[13]=(l+c)/(c-l),A[14]=B/(B-E),A[15]=1,A}function Bt(a,p,c,l,B,E,v){const A=v??new n(16),y=p-a,_=l-c,D=B-E;return A[0]=2*B/y,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=2*B/_,A[6]=0,A[7]=0,A[8]=(a+p)/y,A[9]=(l+c)/_,A[10]=E/D,A[11]=-1,A[12]=0,A[13]=0,A[14]=B*E/D,A[15]=0,A}function Yt(a,p,c,l,B,E=1/0,v){const A=v??new n(16),y=p-a,_=l-c;if(A[0]=2*B/y,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=2*B/_,A[6]=0,A[7]=0,A[8]=(a+p)/y,A[9]=(l+c)/_,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,E===1/0)A[10]=0,A[14]=B;else{const D=1/(E-B);A[10]=B*D,A[14]=E*B*D}return A}const tt=t.create(),rt=t.create(),Z=t.create();function ee(a,p,c,l){const B=l??new n(16);return t.normalize(t.subtract(p,a,Z),Z),t.normalize(t.cross(c,Z,tt),tt),t.normalize(t.cross(Z,tt,rt),rt),B[0]=tt[0],B[1]=tt[1],B[2]=tt[2],B[3]=0,B[4]=rt[0],B[5]=rt[1],B[6]=rt[2],B[7]=0,B[8]=Z[0],B[9]=Z[1],B[10]=Z[2],B[11]=0,B[12]=a[0],B[13]=a[1],B[14]=a[2],B[15]=1,B}function Tt(a,p,c,l){const B=l??new n(16);return t.normalize(t.subtract(a,p,Z),Z),t.normalize(t.cross(c,Z,tt),tt),t.normalize(t.cross(Z,tt,rt),rt),B[0]=tt[0],B[1]=tt[1],B[2]=tt[2],B[3]=0,B[4]=rt[0],B[5]=rt[1],B[6]=rt[2],B[7]=0,B[8]=Z[0],B[9]=Z[1],B[10]=Z[2],B[11]=0,B[12]=a[0],B[13]=a[1],B[14]=a[2],B[15]=1,B}function ne(a,p,c,l){const B=l??new n(16);return t.normalize(t.subtract(a,p,Z),Z),t.normalize(t.cross(c,Z,tt),tt),t.normalize(t.cross(Z,tt,rt),rt),B[0]=tt[0],B[1]=rt[0],B[2]=Z[0],B[3]=0,B[4]=tt[1],B[5]=rt[1],B[6]=Z[1],B[7]=0,B[8]=tt[2],B[9]=rt[2],B[10]=Z[2],B[11]=0,B[12]=-(tt[0]*a[0]+tt[1]*a[1]+tt[2]*a[2]),B[13]=-(rt[0]*a[0]+rt[1]*a[1]+rt[2]*a[2]),B[14]=-(Z[0]*a[0]+Z[1]*a[1]+Z[2]*a[2]),B[15]=1,B}function Ft(a,p){const c=p??new n(16);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=a[0],c[13]=a[1],c[14]=a[2],c[15]=1,c}function se(a,p,c){const l=c??new n(16),B=p[0],E=p[1],v=p[2],A=a[0],y=a[1],_=a[2],D=a[3],F=a[1*4+0],R=a[1*4+1],O=a[1*4+2],k=a[1*4+3],K=a[2*4+0],J=a[2*4+1],z=a[2*4+2],$=a[2*4+3],et=a[3*4+0],lt=a[3*4+1],dt=a[3*4+2],pt=a[3*4+3];return a!==l&&(l[0]=A,l[1]=y,l[2]=_,l[3]=D,l[4]=F,l[5]=R,l[6]=O,l[7]=k,l[8]=K,l[9]=J,l[10]=z,l[11]=$),l[12]=A*B+F*E+K*v+et,l[13]=y*B+R*E+J*v+lt,l[14]=_*B+O*E+z*v+dt,l[15]=D*B+k*E+$*v+pt,l}function at(a,p){const c=p??new n(16),l=Math.cos(a),B=Math.sin(a);return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l,c[6]=B,c[7]=0,c[8]=0,c[9]=-B,c[10]=l,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function re(a,p,c){const l=c??new n(16),B=a[4],E=a[5],v=a[6],A=a[7],y=a[8],_=a[9],D=a[10],F=a[11],R=Math.cos(p),O=Math.sin(p);return l[4]=R*B+O*y,l[5]=R*E+O*_,l[6]=R*v+O*D,l[7]=R*A+O*F,l[8]=R*y-O*B,l[9]=R*_-O*E,l[10]=R*D-O*v,l[11]=R*F-O*A,a!==l&&(l[0]=a[0],l[1]=a[1],l[2]=a[2],l[3]=a[3],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]),l}function Ut(a,p){const c=p??new n(16),l=Math.cos(a),B=Math.sin(a);return c[0]=l,c[1]=0,c[2]=-B,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=B,c[9]=0,c[10]=l,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function ie(a,p,c){const l=c??new n(16),B=a[0*4+0],E=a[0*4+1],v=a[0*4+2],A=a[0*4+3],y=a[2*4+0],_=a[2*4+1],D=a[2*4+2],F=a[2*4+3],R=Math.cos(p),O=Math.sin(p);return l[0]=R*B-O*y,l[1]=R*E-O*_,l[2]=R*v-O*D,l[3]=R*A-O*F,l[8]=R*y+O*B,l[9]=R*_+O*E,l[10]=R*D+O*v,l[11]=R*F+O*A,a!==l&&(l[4]=a[4],l[5]=a[5],l[6]=a[6],l[7]=a[7],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]),l}function Lt(a,p){const c=p??new n(16),l=Math.cos(a),B=Math.sin(a);return c[0]=l,c[1]=B,c[2]=0,c[3]=0,c[4]=-B,c[5]=l,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function $t(a,p,c){const l=c??new n(16),B=a[0*4+0],E=a[0*4+1],v=a[0*4+2],A=a[0*4+3],y=a[1*4+0],_=a[1*4+1],D=a[1*4+2],F=a[1*4+3],R=Math.cos(p),O=Math.sin(p);return l[0]=R*B+O*y,l[1]=R*E+O*_,l[2]=R*v+O*D,l[3]=R*A+O*F,l[4]=R*y-O*B,l[5]=R*_-O*E,l[6]=R*D-O*v,l[7]=R*F-O*A,a!==l&&(l[8]=a[8],l[9]=a[9],l[10]=a[10],l[11]=a[11],l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]),l}function zt(a,p,c){const l=c??new n(16);let B=a[0],E=a[1],v=a[2];const A=Math.sqrt(B*B+E*E+v*v);B/=A,E/=A,v/=A;const y=B*B,_=E*E,D=v*v,F=Math.cos(p),R=Math.sin(p),O=1-F;return l[0]=y+(1-y)*F,l[1]=B*E*O+v*R,l[2]=B*v*O-E*R,l[3]=0,l[4]=B*E*O-v*R,l[5]=_+(1-_)*F,l[6]=E*v*O+B*R,l[7]=0,l[8]=B*v*O+E*R,l[9]=E*v*O-B*R,l[10]=D+(1-D)*F,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}const f=zt;function C(a,p,c,l){const B=l??new n(16);let E=p[0],v=p[1],A=p[2];const y=Math.sqrt(E*E+v*v+A*A);E/=y,v/=y,A/=y;const _=E*E,D=v*v,F=A*A,R=Math.cos(c),O=Math.sin(c),k=1-R,K=_+(1-_)*R,J=E*v*k+A*O,z=E*A*k-v*O,$=E*v*k-A*O,et=D+(1-D)*R,lt=v*A*k+E*O,dt=E*A*k+v*O,pt=v*A*k-E*O,yt=F+(1-F)*R,xt=a[0],Mt=a[1],_t=a[2],Et=a[3],Dt=a[4],It=a[5],vt=a[6],Rt=a[7],Gt=a[8],Vt=a[9],jt=a[10],Kt=a[11];return B[0]=K*xt+J*Dt+z*Gt,B[1]=K*Mt+J*It+z*Vt,B[2]=K*_t+J*vt+z*jt,B[3]=K*Et+J*Rt+z*Kt,B[4]=$*xt+et*Dt+lt*Gt,B[5]=$*Mt+et*It+lt*Vt,B[6]=$*_t+et*vt+lt*jt,B[7]=$*Et+et*Rt+lt*Kt,B[8]=dt*xt+pt*Dt+yt*Gt,B[9]=dt*Mt+pt*It+yt*Vt,B[10]=dt*_t+pt*vt+yt*jt,B[11]=dt*Et+pt*Rt+yt*Kt,a!==B&&(B[12]=a[12],B[13]=a[13],B[14]=a[14],B[15]=a[15]),B}const u=C;function d(a,p){const c=p??new n(16);return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function b(a,p,c){const l=c??new n(16),B=p[0],E=p[1],v=p[2];return l[0]=B*a[0*4+0],l[1]=B*a[0*4+1],l[2]=B*a[0*4+2],l[3]=B*a[0*4+3],l[4]=E*a[1*4+0],l[5]=E*a[1*4+1],l[6]=E*a[1*4+2],l[7]=E*a[1*4+3],l[8]=v*a[2*4+0],l[9]=v*a[2*4+1],l[10]=v*a[2*4+2],l[11]=v*a[2*4+3],a!==l&&(l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]),l}function x(a,p){const c=p??new n(16);return c[0]=a,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function I(a,p,c){const l=c??new n(16);return l[0]=p*a[0*4+0],l[1]=p*a[0*4+1],l[2]=p*a[0*4+2],l[3]=p*a[0*4+3],l[4]=p*a[1*4+0],l[5]=p*a[1*4+1],l[6]=p*a[1*4+2],l[7]=p*a[1*4+3],l[8]=p*a[2*4+0],l[9]=p*a[2*4+1],l[10]=p*a[2*4+2],l[11]=p*a[2*4+3],a!==l&&(l[12]=a[12],l[13]=a[13],l[14]=a[14],l[15]=a[15]),l}return{create:e,set:s,fromMat3:r,fromQuat:i,negate:o,copy:h,clone:m,equalsApproximately:g,equals:w,identity:M,transpose:S,inverse:T,determinant:P,invert:H,multiply:N,mul:V,setTranslation:Q,getTranslation:G,getAxis:j,setAxis:ct,getScaling:gt,perspective:Ct,perspectiveReverseZ:Jt,ortho:kt,frustum:Bt,frustumReverseZ:Yt,aim:ee,cameraAim:Tt,lookAt:ne,translation:Ft,translate:se,rotationX:at,rotateX:re,rotationY:Ut,rotateY:ie,rotationZ:Lt,rotateZ:$t,axisRotation:zt,rotation:f,axisRotate:C,rotate:u,scaling:d,scale:b,uniformScaling:x,uniformScale:I}}const tr=new Map;function Ao(n){let t=tr.get(n);return t||(t=po(n),tr.set(n,t)),t}function mo(n){const t=Hn(n);function e(f,C,u,d){const b=new n(4);return f!==void 0&&(b[0]=f,C!==void 0&&(b[1]=C,u!==void 0&&(b[2]=u,d!==void 0&&(b[3]=d)))),b}const s=e;function r(f,C,u,d,b){const x=b??new n(4);return x[0]=f,x[1]=C,x[2]=u,x[3]=d,x}function i(f,C,u){const d=u??new n(4),b=C*.5,x=Math.sin(b);return d[0]=x*f[0],d[1]=x*f[1],d[2]=x*f[2],d[3]=Math.cos(b),d}function o(f,C){const u=C??t.create(3),d=Math.acos(f[3])*2,b=Math.sin(d*.5);return b>Y?(u[0]=f[0]/b,u[1]=f[1]/b,u[2]=f[2]/b):(u[0]=1,u[1]=0,u[2]=0),{angle:d,axis:u}}function h(f,C){const u=Bt(f,C);return Math.acos(2*u*u-1)}function m(f,C,u){const d=u??new n(4),b=f[0],x=f[1],I=f[2],a=f[3],p=C[0],c=C[1],l=C[2],B=C[3];return d[0]=b*B+a*p+x*l-I*c,d[1]=x*B+a*c+I*p-b*l,d[2]=I*B+a*l+b*c-x*p,d[3]=a*B-b*p-x*c-I*l,d}const g=m;function w(f,C,u){const d=u??new n(4),b=C*.5,x=f[0],I=f[1],a=f[2],p=f[3],c=Math.sin(b),l=Math.cos(b);return d[0]=x*l+p*c,d[1]=I*l+a*c,d[2]=a*l-I*c,d[3]=p*l-x*c,d}function M(f,C,u){const d=u??new n(4),b=C*.5,x=f[0],I=f[1],a=f[2],p=f[3],c=Math.sin(b),l=Math.cos(b);return d[0]=x*l-a*c,d[1]=I*l+p*c,d[2]=a*l+x*c,d[3]=p*l-I*c,d}function S(f,C,u){const d=u??new n(4),b=C*.5,x=f[0],I=f[1],a=f[2],p=f[3],c=Math.sin(b),l=Math.cos(b);return d[0]=x*l+I*c,d[1]=I*l-x*c,d[2]=a*l+p*c,d[3]=p*l-a*c,d}function T(f,C,u,d){const b=d??new n(4),x=f[0],I=f[1],a=f[2],p=f[3];let c=C[0],l=C[1],B=C[2],E=C[3],v=x*c+I*l+a*B+p*E;v<0&&(v=-v,c=-c,l=-l,B=-B,E=-E);let A,y;if(1-v>Y){const _=Math.acos(v),D=Math.sin(_);A=Math.sin((1-u)*_)/D,y=Math.sin(u*_)/D}else A=1-u,y=u;return b[0]=A*x+y*c,b[1]=A*I+y*l,b[2]=A*a+y*B,b[3]=A*p+y*E,b}function P(f,C){const u=C??new n(4),d=f[0],b=f[1],x=f[2],I=f[3],a=d*d+b*b+x*x+I*I,p=a?1/a:0;return u[0]=-d*p,u[1]=-b*p,u[2]=-x*p,u[3]=I*p,u}function H(f,C){const u=C??new n(4);return u[0]=-f[0],u[1]=-f[1],u[2]=-f[2],u[3]=f[3],u}function N(f,C){const u=C??new n(4),d=f[0]+f[5]+f[10];if(d>0){const b=Math.sqrt(d+1);u[3]=.5*b;const x=.5/b;u[0]=(f[6]-f[9])*x,u[1]=(f[8]-f[2])*x,u[2]=(f[1]-f[4])*x}else{let b=0;f[5]>f[0]&&(b=1),f[10]>f[b*4+b]&&(b=2);const x=(b+1)%3,I=(b+2)%3,a=Math.sqrt(f[b*4+b]-f[x*4+x]-f[I*4+I]+1);u[b]=.5*a;const p=.5/a;u[3]=(f[x*4+I]-f[I*4+x])*p,u[x]=(f[x*4+b]+f[b*4+x])*p,u[I]=(f[I*4+b]+f[b*4+I])*p}return u}function V(f,C,u,d,b){const x=b??new n(4),I=f*.5,a=C*.5,p=u*.5,c=Math.sin(I),l=Math.cos(I),B=Math.sin(a),E=Math.cos(a),v=Math.sin(p),A=Math.cos(p);switch(d){case"xyz":x[0]=c*E*A+l*B*v,x[1]=l*B*A-c*E*v,x[2]=l*E*v+c*B*A,x[3]=l*E*A-c*B*v;break;case"xzy":x[0]=c*E*A-l*B*v,x[1]=l*B*A-c*E*v,x[2]=l*E*v+c*B*A,x[3]=l*E*A+c*B*v;break;case"yxz":x[0]=c*E*A+l*B*v,x[1]=l*B*A-c*E*v,x[2]=l*E*v-c*B*A,x[3]=l*E*A+c*B*v;break;case"yzx":x[0]=c*E*A+l*B*v,x[1]=l*B*A+c*E*v,x[2]=l*E*v-c*B*A,x[3]=l*E*A-c*B*v;break;case"zxy":x[0]=c*E*A-l*B*v,x[1]=l*B*A+c*E*v,x[2]=l*E*v+c*B*A,x[3]=l*E*A-c*B*v;break;case"zyx":x[0]=c*E*A-l*B*v,x[1]=l*B*A+c*E*v,x[2]=l*E*v-c*B*A,x[3]=l*E*A+c*B*v;break;default:throw new Error(`Unknown rotation order: ${d}`)}return x}function Q(f,C){const u=C??new n(4);return u[0]=f[0],u[1]=f[1],u[2]=f[2],u[3]=f[3],u}const G=Q;function j(f,C,u){const d=u??new n(4);return d[0]=f[0]+C[0],d[1]=f[1]+C[1],d[2]=f[2]+C[2],d[3]=f[3]+C[3],d}function ct(f,C,u){const d=u??new n(4);return d[0]=f[0]-C[0],d[1]=f[1]-C[1],d[2]=f[2]-C[2],d[3]=f[3]-C[3],d}const gt=ct;function Ct(f,C,u){const d=u??new n(4);return d[0]=f[0]*C,d[1]=f[1]*C,d[2]=f[2]*C,d[3]=f[3]*C,d}const Jt=Ct;function kt(f,C,u){const d=u??new n(4);return d[0]=f[0]/C,d[1]=f[1]/C,d[2]=f[2]/C,d[3]=f[3]/C,d}function Bt(f,C){return f[0]*C[0]+f[1]*C[1]+f[2]*C[2]+f[3]*C[3]}function Yt(f,C,u,d){const b=d??new n(4);return b[0]=f[0]+u*(C[0]-f[0]),b[1]=f[1]+u*(C[1]-f[1]),b[2]=f[2]+u*(C[2]-f[2]),b[3]=f[3]+u*(C[3]-f[3]),b}function tt(f){const C=f[0],u=f[1],d=f[2],b=f[3];return Math.sqrt(C*C+u*u+d*d+b*b)}const rt=tt;function Z(f){const C=f[0],u=f[1],d=f[2],b=f[3];return C*C+u*u+d*d+b*b}const ee=Z;function Tt(f,C){const u=C??new n(4),d=f[0],b=f[1],x=f[2],I=f[3],a=Math.sqrt(d*d+b*b+x*x+I*I);return a>1e-5?(u[0]=d/a,u[1]=b/a,u[2]=x/a,u[3]=I/a):(u[0]=0,u[1]=0,u[2]=0,u[3]=1),u}function ne(f,C){return Math.abs(f[0]-C[0])<Y&&Math.abs(f[1]-C[1])<Y&&Math.abs(f[2]-C[2])<Y&&Math.abs(f[3]-C[3])<Y}function Ft(f,C){return f[0]===C[0]&&f[1]===C[1]&&f[2]===C[2]&&f[3]===C[3]}function se(f){const C=f??new n(4);return C[0]=0,C[1]=0,C[2]=0,C[3]=1,C}const at=t.create(),re=t.create(),Ut=t.create();function ie(f,C,u){const d=u??new n(4),b=t.dot(f,C);return b<-.999999?(t.cross(re,f,at),t.len(at)<1e-6&&t.cross(Ut,f,at),t.normalize(at,at),i(at,Math.PI,d),d):b>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(t.cross(f,C,at),d[0]=at[0],d[1]=at[1],d[2]=at[2],d[3]=1+b,Tt(d,d))}const Lt=new n(4),$t=new n(4);function zt(f,C,u,d,b,x){const I=x??new n(4);return T(f,d,b,Lt),T(C,u,b,$t),T(Lt,$t,2*b*(1-b),I),I}return{create:e,fromValues:s,set:r,fromAxisAngle:i,toAxisAngle:o,angle:h,multiply:m,mul:g,rotateX:w,rotateY:M,rotateZ:S,slerp:T,inverse:P,conjugate:H,fromMat:N,fromEuler:V,copy:Q,clone:G,add:j,subtract:ct,sub:gt,mulScalar:Ct,scale:Jt,divScalar:kt,dot:Bt,lerp:Yt,length:tt,len:rt,lengthSq:Z,lenSq:ee,normalize:Tt,equalsApproximately:ne,equals:Ft,identity:se,rotationTo:ie,sqlerp:zt}}const er=new Map;function go(n){let t=er.get(n);return t||(t=mo(n),er.set(n,t)),t}function Bo(n){function t(u,d,b,x){const I=new n(4);return u!==void 0&&(I[0]=u,d!==void 0&&(I[1]=d,b!==void 0&&(I[2]=b,x!==void 0&&(I[3]=x)))),I}const e=t;function s(u,d,b,x,I){const a=I??new n(4);return a[0]=u,a[1]=d,a[2]=b,a[3]=x,a}function r(u,d){const b=d??new n(4);return b[0]=Math.ceil(u[0]),b[1]=Math.ceil(u[1]),b[2]=Math.ceil(u[2]),b[3]=Math.ceil(u[3]),b}function i(u,d){const b=d??new n(4);return b[0]=Math.floor(u[0]),b[1]=Math.floor(u[1]),b[2]=Math.floor(u[2]),b[3]=Math.floor(u[3]),b}function o(u,d){const b=d??new n(4);return b[0]=Math.round(u[0]),b[1]=Math.round(u[1]),b[2]=Math.round(u[2]),b[3]=Math.round(u[3]),b}function h(u,d=0,b=1,x){const I=x??new n(4);return I[0]=Math.min(b,Math.max(d,u[0])),I[1]=Math.min(b,Math.max(d,u[1])),I[2]=Math.min(b,Math.max(d,u[2])),I[3]=Math.min(b,Math.max(d,u[3])),I}function m(u,d,b){const x=b??new n(4);return x[0]=u[0]+d[0],x[1]=u[1]+d[1],x[2]=u[2]+d[2],x[3]=u[3]+d[3],x}function g(u,d,b,x){const I=x??new n(4);return I[0]=u[0]+d[0]*b,I[1]=u[1]+d[1]*b,I[2]=u[2]+d[2]*b,I[3]=u[3]+d[3]*b,I}function w(u,d,b){const x=b??new n(4);return x[0]=u[0]-d[0],x[1]=u[1]-d[1],x[2]=u[2]-d[2],x[3]=u[3]-d[3],x}const M=w;function S(u,d){return Math.abs(u[0]-d[0])<Y&&Math.abs(u[1]-d[1])<Y&&Math.abs(u[2]-d[2])<Y&&Math.abs(u[3]-d[3])<Y}function T(u,d){return u[0]===d[0]&&u[1]===d[1]&&u[2]===d[2]&&u[3]===d[3]}function P(u,d,b,x){const I=x??new n(4);return I[0]=u[0]+b*(d[0]-u[0]),I[1]=u[1]+b*(d[1]-u[1]),I[2]=u[2]+b*(d[2]-u[2]),I[3]=u[3]+b*(d[3]-u[3]),I}function H(u,d,b,x){const I=x??new n(4);return I[0]=u[0]+b[0]*(d[0]-u[0]),I[1]=u[1]+b[1]*(d[1]-u[1]),I[2]=u[2]+b[2]*(d[2]-u[2]),I[3]=u[3]+b[3]*(d[3]-u[3]),I}function N(u,d,b){const x=b??new n(4);return x[0]=Math.max(u[0],d[0]),x[1]=Math.max(u[1],d[1]),x[2]=Math.max(u[2],d[2]),x[3]=Math.max(u[3],d[3]),x}function V(u,d,b){const x=b??new n(4);return x[0]=Math.min(u[0],d[0]),x[1]=Math.min(u[1],d[1]),x[2]=Math.min(u[2],d[2]),x[3]=Math.min(u[3],d[3]),x}function Q(u,d,b){const x=b??new n(4);return x[0]=u[0]*d,x[1]=u[1]*d,x[2]=u[2]*d,x[3]=u[3]*d,x}const G=Q;function j(u,d,b){const x=b??new n(4);return x[0]=u[0]/d,x[1]=u[1]/d,x[2]=u[2]/d,x[3]=u[3]/d,x}function ct(u,d){const b=d??new n(4);return b[0]=1/u[0],b[1]=1/u[1],b[2]=1/u[2],b[3]=1/u[3],b}const gt=ct;function Ct(u,d){return u[0]*d[0]+u[1]*d[1]+u[2]*d[2]+u[3]*d[3]}function Jt(u){const d=u[0],b=u[1],x=u[2],I=u[3];return Math.sqrt(d*d+b*b+x*x+I*I)}const kt=Jt;function Bt(u){const d=u[0],b=u[1],x=u[2],I=u[3];return d*d+b*b+x*x+I*I}const Yt=Bt;function tt(u,d){const b=u[0]-d[0],x=u[1]-d[1],I=u[2]-d[2],a=u[3]-d[3];return Math.sqrt(b*b+x*x+I*I+a*a)}const rt=tt;function Z(u,d){const b=u[0]-d[0],x=u[1]-d[1],I=u[2]-d[2],a=u[3]-d[3];return b*b+x*x+I*I+a*a}const ee=Z;function Tt(u,d){const b=d??new n(4),x=u[0],I=u[1],a=u[2],p=u[3],c=Math.sqrt(x*x+I*I+a*a+p*p);return c>1e-5?(b[0]=x/c,b[1]=I/c,b[2]=a/c,b[3]=p/c):(b[0]=0,b[1]=0,b[2]=0,b[3]=0),b}function ne(u,d){const b=d??new n(4);return b[0]=-u[0],b[1]=-u[1],b[2]=-u[2],b[3]=-u[3],b}function Ft(u,d){const b=d??new n(4);return b[0]=u[0],b[1]=u[1],b[2]=u[2],b[3]=u[3],b}const se=Ft;function at(u,d,b){const x=b??new n(4);return x[0]=u[0]*d[0],x[1]=u[1]*d[1],x[2]=u[2]*d[2],x[3]=u[3]*d[3],x}const re=at;function Ut(u,d,b){const x=b??new n(4);return x[0]=u[0]/d[0],x[1]=u[1]/d[1],x[2]=u[2]/d[2],x[3]=u[3]/d[3],x}const ie=Ut;function Lt(u){const d=u??new n(4);return d[0]=0,d[1]=0,d[2]=0,d[3]=0,d}function $t(u,d,b){const x=b??new n(4),I=u[0],a=u[1],p=u[2],c=u[3];return x[0]=d[0]*I+d[4]*a+d[8]*p+d[12]*c,x[1]=d[1]*I+d[5]*a+d[9]*p+d[13]*c,x[2]=d[2]*I+d[6]*a+d[10]*p+d[14]*c,x[3]=d[3]*I+d[7]*a+d[11]*p+d[15]*c,x}function zt(u,d,b){const x=b??new n(4);return Tt(u,x),Q(x,d,x)}function f(u,d,b){const x=b??new n(4);return Jt(u)>d?zt(u,d,x):Ft(u,x)}function C(u,d,b){const x=b??new n(4);return P(u,d,.5,x)}return{create:t,fromValues:e,set:s,ceil:r,floor:i,round:o,clamp:h,add:m,addScaled:g,subtract:w,sub:M,equalsApproximately:S,equals:T,lerp:P,lerpV:H,max:N,min:V,mulScalar:Q,scale:G,divScalar:j,inverse:ct,invert:gt,dot:Ct,length:Jt,len:kt,lengthSq:Bt,lenSq:Yt,distance:tt,dist:rt,distanceSq:Z,distSq:ee,normalize:Tt,negate:ne,copy:Ft,clone:se,multiply:at,mul:re,divide:Ut,div:ie,zero:Lt,transformMat4:$t,setLength:zt,truncate:f,midpoint:C}}const nr=new Map;function yo(n){let t=nr.get(n);return t||(t=Bo(n),nr.set(n,t)),t}function Ds(n,t,e,s,r,i){return{mat3:fo(n),mat4:Ao(t),quat:go(e),vec2:ni(s),vec3:Hn(r),vec4:yo(i)}}const{mat3:ep,mat4:st,quat:Ot,vec2:wt,vec3:it,vec4:ht}=Ds(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Ds(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Ds(co,Array,Array,Array,Array,Array);var ot;let L=(ot=class{constructor(t=0,e=0,s=0){this.data=new Float32Array([t,e,s]),this.needsUpdate=!1,this.isVector3=!0,it.create(t,e,s,this.data)}get x(){return this.data[0]}set x(t){this.data[0]=t,this._onChangeCallback()}get y(){return this.data[1]}set y(t){this.data[1]=t,this._onChangeCallback()}get z(){return this.data[2]}set z(t){this.data[2]=t,this._onChangeCallback()}print(){return`Vec3 { x: ${this.data[0]}, y: ${this.data[1]}, z: ${this.data[2]} }`}invert(){return it.negate(this.data,this.data),this._onChangeCallback(),this}equals(t){return it.equals(this.data,t.data)}min(t,e,s){return t instanceof ot?it.min(this.data,t.data,this.data):it.min(this.data,[t,e,s],this.data),this._onChangeCallback(),this}max(t,e,s){return t instanceof ot?it.max(this.data,t.data,this.data):it.max(this.data,[t,e,s],this.data),this._onChangeCallback(),this}setFromMatrixColumn(t,e){return this.fromArray(t.data,e*4)}fromArray(t,e=0){return this.data[0]=t[e],this.data[1]=t[e+1],this.data[2]=t[e+2],this._onChangeCallback(),this}setFromMatrixPosition(t){return this.data[0]=t.data[12],this.data[1]=t.data[13],this.data[2]=t.data[14],this._onChangeCallback(),this}divScalar(t){return it.scale(this.data,1/t,this.data),this._onChangeCallback(),this}set(t,e,s){return it.set(t,e,s,this.data),this._onChangeCallback(),this}add(t){return it.add(t.data,this.data,this.data),this}addVectors(t,e){return it.add(t.data,e.data,this.data),this}sub(t){return it.sub(this.data,t.data,this.data),this}subVectors(t,e){return it.sub(t.data,e.data,this.data),this._onChangeCallback(),this}copy(t){return it.copy(t.data,this.data),this._onChangeCallback(),this}clone(){return new ot().copy(this)}distanceTo(t){return it.distance(this.data,t.data)}dot(t){return it.dot(this.data,t.data)}cross(t){return it.cross(this.data,t.data,this.data),this}length(){return it.length(this.data)}normalize(){return it.normalize(this.data,this.data),this}applyMatrix4(t){const e=this.x,s=this.y,r=this.z,i=t.data,o=1/(i[3]*e+i[7]*s+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*s+i[8]*r+i[12])*o,this.y=(i[1]*e+i[5]*s+i[9]*r+i[13])*o,this.z=(i[2]*e+i[6]*s+i[10]*r+i[14])*o,this}applyQuaternion(t){return it.transformQuat(this.data,this.data,t.data),this}multiplyScalar(t){return it.scale(this.data,t,this.data),this}toArray(t=[],e=0){return t[e+0]=this.data[0],t[e+1]=this.data[1],t[e+2]=this.data[2],t}subVectors(t,e){return it.sub(t.data,e.data,this.data),this._onChangeCallback(),this}equalsArray(t,e=0){return this.data[0]===t[e]&&this.data[1]===t[e+1]&&this.data[2]===t[e+2]}lengthSq(){return it.lengthSq(this.data)}crossVectors(t,e){return it.cross(t.data,e.data,this.data),this._onChangeCallback(),this}clampLength(t,e){const s=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,s))/s),this._onChangeCallback(),this}distanceToSquared(t){return it.distanceSq(this.data,t.data)}lerpVectors(t,e,s){return it.lerp(t.data,e.data,s,this.data),this}lerp(t,e){return it.lerp(this.data,t.data,e,this.data),this}random(t,e){return this.x=Math.random()*(e-t)+t,this.y=Math.random()*(e-t)+t,this.z=Math.random()*(e-t)+t,this}setFromAttribute(t,e){return this.data[0]=t.getX(e),this.data[1]=t.getY(e),this.data[2]=t.getZ(e),this}addScaledVector(t,e){return it.addScaled(this.data,t.data,e,this.data),this}clear(){return this.data.fill(0),this._onChangeCallback(),this}onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}static subVectors(t,e){return new ot().subVectors(t,e)}static addVectors(t,e){return new ot().addVectors(t,e)}static crossVectors(t,e){return new ot().crossVectors(t,e)}},U(ot,"byteSize",3*Float32Array.BYTES_PER_ELEMENT),U(ot,"ZERO",new ot(0,0,0)),U(ot,"RIGHT",new ot(1,0,0)),U(ot,"LEFT",new ot(-1,0,0)),U(ot,"UP",new ot(0,1,0)),U(ot,"DOWN",new ot(0,-1,0)),U(ot,"FORWARD",new ot(0,0,-1)),U(ot,"BACKWARD",new ot(0,0,1)),ot);function ft(n,t,e=0,s=0){if(!n||!t)return!1;for(let r=0;r<n.length;r++)if(n[e+r]!==t[s+r])return!1;return!0}window.arraysEqual=ft;const Ln=class Ln{constructor(){this.isMatrix4=!0,this.data=st.identity(),this._lastData=new Float32Array([...this.data]),this._needsUpdate=!1,this.up=new L(0,1,0)}lookAt(t,e,s=this.up){return st.lookAt(t.data,e.data,s.data,this.data),this._onChangeCallback(),this}lookAtRotation(t,e,s=this.up){const r=L.subVectors(e,t).normalize(),i=L.crossVectors(s,r).normalize(),o=L.crossVectors(r,i);return this.set(i.x,o.x,r.x,0,i.y,o.y,r.y,0,i.z,o.z,r.z,0,0,0,0,1),this}identity(){return st.identity(this.data),this._onChangeCallback(),this}print(){return`${this.data[0]} ${this.data[1]} ${this.data[2]} ${this.data[3]}
${this.data[4]} ${this.data[5]} ${this.data[6]} ${this.data[7]}
${this.data[8]} ${this.data[9]} ${this.data[10]} ${this.data[11]}
${this.data[12]} ${this.data[13]} ${this.data[14]} ${this.data[15]}`}copy(t){return st.copy(t.data,this.data),this._onChangeCallback(),this}setFromQuaternion(t){return st.fromQuat(t.data,this.data),this._onChangeCallback(),this}cameraAim(t,e,s=this.up){return st.cameraAim(t.data,e.data,s.data,this.data),this._onChangeCallback(),this}compose(t,e,s){t.isVector3&&(t=t.data),e.isQuaternion&&(e=e.data),s.isVector3&&(s=s.data);const r=this.data,i=e[0],o=e[1],h=e[2],m=e[3],g=i+i,w=o+o,M=h+h,S=i*g,T=i*w,P=i*M,H=o*w,N=o*M,V=h*M,Q=m*g,G=m*w,j=m*M,ct=s[0],gt=s[1],Ct=s[2];return r[0]=(1-(H+V))*ct,r[1]=(T+j)*ct,r[2]=(P-G)*ct,r[3]=0,r[4]=(T-j)*gt,r[5]=(1-(S+V))*gt,r[6]=(N+Q)*gt,r[7]=0,r[8]=(P+G)*Ct,r[9]=(N-Q)*Ct,r[10]=(1-(S+H))*Ct,r[11]=0,r[12]=t[0],r[13]=t[1],r[14]=t[2],r[15]=1,this._onChangeCallback(),this}multiplyMatrices(t,e){return st.multiply(t.data,e.data,this.data),this}multiply(t){return this._lastData.set(this.data),st.multiply(this.data,t.data,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}ortho(t,e,s,r,i,o){return this._lastData.set(this.data),st.ortho(t,e,s,r,i,o,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}perspective(t,e,s,r){return this._lastData.set(this.data),st.perspective(t,e,s,r,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}extractRotation(t){this._lastData.set(this.data);const e=this.data,s=t.data,r=1/Ie.setFromMatrixColumn(t,0).length(),i=1/Ie.setFromMatrixColumn(t,1).length(),o=1/Ie.setFromMatrixColumn(t,2).length();return e[0]=s[0]*r,e[1]=s[1]*r,e[2]=s[2]*r,e[3]=0,e[4]=s[4]*i,e[5]=s[5]*i,e[6]=s[6]*i,e[7]=0,e[8]=s[8]*o,e[9]=s[9]*o,e[10]=s[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}rotate(t,e,s){return this._lastData.set(this.data),st.rotate(t.data,e.data,s,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}transpose(){return this._lastData.set(this.data),st.transpose(this.data,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}frustum(t,e,s,r,i,o){return this._lastData.set(this.data),st.frustum(t,e,s,r,i,o,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}clone(){return new Ln().copy(this)}equals(t){return st.equals(this.data,t.data)}invert(t=this){return this._lastData.set(this.data),st.invert(this.data,t.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}getAxis(t){return st.getAxis(this.data,t)}set(t,e,s,r,i,o,h,m,g,w,M,S,T,P,H,N){return this._lastData.set(this.data),st.set(t,e,s,r,i,o,h,m,g,w,M,S,T,P,H,N,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}scale(t){return this._lastData.set(this.data),st.scale(this.data,t.data,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}getScale(t){return t||(t=new L),t.fromArray(st.getScaling(this.data))}getRotation(t){return t||(t=new fe),t.setFromRotationMatrix(this)}determinant(){return st.determinant(this.data)}getMaxScaleOnAxis(){const t=this.data,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,r))}decompose(t,e,s){const r=this.data;let i=Ie.set(r[0],r[1],r[2]).length();const o=Ie.set(r[4],r[5],r[6]).length(),h=Ie.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],oe.copy(this);const g=1/i,w=1/o,M=1/h;return oe.data[0]*=g,oe.data[1]*=g,oe.data[2]*=g,oe.data[4]*=w,oe.data[5]*=w,oe.data[6]*=w,oe.data[8]*=M,oe.data[9]*=M,oe.data[10]*=M,e.setFromRotationMatrix(oe),s.x=i,s.y=o,s.z=h,this}translate(t,e,s){return t instanceof L?(st.translate(this.data,t.data,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()):typeof t=="number"&&typeof e=="number"&&typeof s=="number"&&(st.translate(this.data,[t,e,s],this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()),this}setPosition(t,e,s){t.isVector3?(this.data[12]=t.data[0],this.data[13]=t.data[1],this.data[14]=t.data[2],this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()):typeof t=="number"&&typeof e=="number"&&typeof s=="number"&&(this.data[12]=t,this.data[13]=e,this.data[14]=s,this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback())}transformPoint(t){const e=t.x,s=t.y,r=t.z,i=this.data;return t.x=i[0]*e+i[4]*s+i[8]*r+i[12],t.y=i[1]*e+i[5]*s+i[9]*r+i[13],t.z=i[2]*e+i[6]*s+i[10]*r+i[14],t}transformDirection(t){const e=t.x,s=t.y,r=t.z,i=this.data;return t.x=i[0]*e+i[4]*s+i[8]*r,t.y=i[1]*e+i[5]*s+i[9]*r,t.z=i[2]*e+i[6]*s+i[10]*r,t}getPosition(){return new L(this.data[12],this.data[13],this.data[14])}rotateX(t){st.rotateX(this.data,t,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()}rotateY(t){st.rotateY(this.data,t,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()}rotateZ(t){st.rotateZ(this.data,t,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()}scale(t,e,s){t instanceof L?(st.scale(this.data,t.data,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()):typeof t=="number"&&e===void 0?(st.uniformScale(this.data,t,this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback()):typeof t=="number"&&typeof e=="number"&&s==="number"&&(st.scale(this.data,[t,e,s],this.data),this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback())}fromArray(t,e=0){for(let s=0;s<16;s++)this.data[s]=t[s+e];return this._needsUpdate=!ft(this.data,this._lastData),this._onChangeCallback(),this}toArray(t=[],e=0){const s=this.data;for(let r=0;r<16;r++)t[e+r]=s[r];return t}static multiply(t,e,s){return st.multiply(t.data,e.data,s.data),s}equalsArray(t,e=0){for(let s=0;s<16;s++)if(this.data[s]!==t[s+e])return!1;return!0}onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}get needsUpdate(){return this._needsUpdate}set needsUpdate(t){this._needsUpdate=t}};U(Ln,"byteSize",16*Float32Array.BYTES_PER_ELEMENT);let W=Ln;const Ie=new L,oe=new W,wo=Math.PI/180,Je=180/Math.PI;function Pt(n,t){return Math.random()*(t-n)+n}function Nn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const t=Math.random()*16|0;return(n==="x"?t:t&3|8).toString(16)})}function we(n,t,e){return Math.max(t,Math.min(e,n))}const sr=new W;class Ve{constructor(t=0,e=0,s=0,r=Ve.DEFAULT_ORDER){this._x=t,this._y=e,this._z=s,this._order=r}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}toArray(t=[],e=0){return t[e+0]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}setFromQuaternion(t,e=this._order,s){return sr.setFromQuaternion(t),s&&this._onChangeCallback(),this.setFromRotationMatrix(sr,e,s)}print(){console.log(`Euler { x: ${this._x*Je}, y: ${this._y*Je}, z: ${this._z*Je} }`)}onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}setFromRotationMatrix(t,e=this._order,s){t=t.data;const r=t[0],i=t[4],o=t[8],h=t[1],m=t[5],g=t[9],w=t[2],M=t[6],S=t[10];switch(e){case"xyz":this._y=Math.asin(we(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-g,S),this._z=Math.atan2(-i,r)):(this._x=Math.atan2(M,m),this._z=0);break;case"yxz":this._x=Math.asin(-we(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(o,S),this._z=Math.atan2(h,m)):(this._y=Math.atan2(-w,r),this._z=0);break;case"zxy":this._x=Math.asin(we(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-w,S),this._z=Math.atan2(-i,m)):(this._y=0,this._z=Math.atan2(h,r));break;case"zyx":this._y=Math.asin(-we(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(M,S),this._z=Math.atan2(h,r)):(this._x=0,this._z=Math.atan2(-i,m));break;case"yzx":this._z=Math.asin(we(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-g,m),this._y=Math.atan2(-w,r)):(this._x=0,this._y=Math.atan2(o,S));break;case"xzy":this._z=Math.asin(-we(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(M,m),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-g,S),this._y=0);break;default:console.warn(".setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return _quaternion.setFromEuler(this),this.setFromQuaternion(_quaternion,t)}set(t,e,s,r=this._order){return this._x=t,this._y=e,this._z=s,this._order=r,this._onChangeCallback(),this}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.order=t.order,this}clone(){return new Ve(this.x,this.y,this.z,this.order)}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.order===this.order}}Ve.DEFAULT_ORDER="xyz";class fe{constructor(t=0,e=0,s=0,r=1){this.isQuaternion=!0,this.data=Ot.create(t,e,s,r),this.needsUpdate=!1}get x(){return this.data[0]}set x(t){this.data[0]=t,this._onChangeCallback()}get y(){return this.data[1]}set y(t){this.data[1]=t,this._onChangeCallback()}get z(){return this.data[2]}set z(t){this.data[2]=t,this._onChangeCallback()}get w(){return this.data[3]}set w(t){this.data[3]=t,this._onChangeCallback()}add(t,e){return Ot.add(t.q,e.q,this.data),this}rotateY(t){return Ot.rotateY(t,this.data),this._onChangeCallback(),this}setFromMatrix(t){return Ot.fromMat(t.data,this.data),this._onChangeCallback(),this}setFromAxisAngle(t,e){return t instanceof L||console.error("Quaternion: setFromAxisAngle expects a Vector3 as the first argument"),Ot.fromAxisAngle(t.toArray(),e,this.data),this._onChangeCallback(),this}set(t,e,s,r){return Ot.set(t,e,s,r,this.data),this._onChangeCallback(),this}getForwardVector(t){const{x:e,y:s,z:r,w:i}=this,o=2*(e*r-i*s),h=2*(s*r+i*e),m=1-2*(e*e+s*s),g=Math.sqrt(o*o+h*h+m*m);if(g===0)return t.set(0,0,0);t.set(o/g,h/g,m/g)}inverse(){return Ot.inverse(this.data,this.data),this}setFromEuler(t,e){return Ot.fromEuler(t.x,t.y,t.z,t.order,this.data),e&&this._onChangeCallback(),this}setFromEulerAngles(t,e,s,r="xyz"){return Ot.fromEuler(t,e,s,r,this.data),this._onChangeCallback(),this}multiply(t,e){return Ot.mul(t.q,e.q,this.data),this}premultiply(t){Ot.mul(t.data,this.data,this.data),this._onChangeCallback()}invert(){return Ot.inverse(this.data,this.data),this._onChangeCallback(),this}setFromRotationMatrix(t){return Ot.fromMat(t.data,this.data),this._onChangeCallback(),this}onChange(t){this._onChangeCallback=t}_onChangeCallback(){}fromArray(t){return this.data.set(t),this._onChangeCallback(),this}equalsArray(t,e=0){return this.x===t[e]&&this.y===t[e+1]&&this.z===t[e+2]&&this.w===t[e+3]}toArray(t=[],e=0){const{x:s,y:r,z:i,w:o}=this;return t[e]=s,t[e+1]=r,t[e+2]=i,t[e+3]=o,t}slerpQuaternions(t,e,s){return Ot.slerp(t.data,e.data,s,this.data),this}copy(t){return Ot.copy(t.data,this.data),this}print(){return`Quat { x: ${this.data[0]}, y: ${this.data[1]}, z: ${this.data[2]}, w: ${this.data[3]} }`}printEuler(){const t=bo.setFromQuaternion(this);return`Euler { x: ${t.x*Je}, y: ${t.y*Je}, z: ${t.z*Je} }`}}const bo=new Ve;class Jn{constructor(){this.globalEvents=new gs,this._listeners={},this._contexts={}}subscribe(t,e,s){this.globalEvents.subscribe(t,e,s)}unsubscibe(t,e){this.globalEvents.unsubscibe(t,e)}broadcast(t,e){this.globalEvents.broadcast(t,e)}on(t,e,s){this._listeners[t]||(this._listeners[t]=[],this._contexts[t]=[]),this._listeners[t].push(e),this._contexts[t].push(s)}off(t,e){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter((s,r)=>s!==e?s:(this._contexts[t].splice(r,1),!1)))}emit(t,e){this._listeners[t]&&this._listeners[t].forEach((s,r)=>{s.call(this._contexts[t][r],e)})}}const Ne=class Ne{constructor(){if(Ne.instance)return Ne.instance;this._listeners={},this._contexts={},Ne.instance=this}subscribe(t,e,s){this._listeners[t]||(this._listeners[t]=[],this._contexts[t]=[]),this._listeners[t].push(e),this._contexts[t].push(s)}unsubscibe(t,e){this._listeners[t]&&(this._listeners[t]=this._listeners[t].filter((s,r)=>s!==e?s:(this._contexts[t].splice(r,1),!1)))}broadcast(t,e){this._listeners[t]&&this._listeners[t].forEach((s,r)=>{s.call(this._contexts[t][r],e)})}};U(Ne,"instance",null);let gs=Ne;const We=new L,Bn=new L;new L;new L;new L;new L;const ue=new W,rr=new fe;class de extends Jn{constructor(){super(),this.children=[],this.childrenMap={},this.static=!1,this.parent=null,this.id=Nn(),this.name="Object",this.type="Object3D",this.isObject3D=!0,this.version=0,this.matrixWorldAutoUpdate=!0,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.position=new L,this.rotation=new Ve,this.quaternion=new fe,this.scale=new L(1,1,1);function t(){this.quaternion.setFromEuler(this.rotation,!1),this.updateWorldMatrix(!1,!0)}function e(){this.rotation.setFromQuaternion(this.quaternion,void 0,!1),this.updateWorldMatrix(!1,!0)}function s(){this.updateWorldMatrix(!1,!0)}this.rotation.onChange(t.bind(this)),this.quaternion.onChange(e.bind(this)),this.position.onChange(s.bind(this)),this.up=new L(0,1,0),this.matrix=new W,this.matrixWorld=new W,this.direction=new L(0,0,-1),this.rotationMatrix=new W}setParent(t){this.parent=t,this.updateMatrixWorld(!0,!1)}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0),t&&this.write(this.matrixWorld.data,"model");const e=this.children;for(let s=0,r=e.length;s<r;s++)e[s].updateMatrixWorld(t);ue.extractRotation(this.matrixWorld),this.direction.set(this.matrixWorld.data[8],this.matrixWorld.data[9],this.matrixWorld.data[10]).normalize()}translate(t,e,s){this.position.add(t,e,s)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateMatrixWorld(!0,!1),t.applyMatrix4(ue.copy(this.matrixWorld).invert())}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):W.multiply(this.parent.matrixWorld,this.matrix,this.matrixWorld)),e===!0){const r=this.children;for(let i=0,o=r.length;i<o;i++)r[i].updateWorldMatrix(!1,!0)}ue.extractRotation(this.matrixWorld),this.write(this.matrixWorld.data,"model"),this.direction.set(this.matrixWorld.data[8],this.matrixWorld.data[9],this.matrixWorld.data[10]).normalize()}traverse(t){for(let e=0;e<this.children.length;e++)t(this.children[e]),this.children[e].traverse(t)}write(t,e,s=0){this.emit("write",{data:t,name:e,byteOffset:s})}setScale(t,e,s){e===void 0&&(e=t),s===void 0&&(s=t),this.scale.set(t,e,s)}setPosition(t=0,e=0,s=0){return t.isVector3?this.position.copy(t):this.position.set(t,e,s),this}add(t){t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),this.childrenMap[t.name]=t,this.updateMatrixWorld(!0,!0)}getHeightAt(t,e){const s=this.find(i=>i.isMesh);let r=-1/0;for(let i=0;i<s.length;i++){const h=s[i].getHeightAt(t,e);h>r&&(r=h)}return r===-1/0?0:r}remove(t){const e=this.children.indexOf(t);this.children.splice(e,1),delete this.childrenMap[t.name]}findByName(t){for(let e=0;e<this.children.length;e++){if(this.children[e].name===t)return this.children[e];if(this.children[e].children.length>0){const s=this.children[e].findByName(t);if(s)return s}}return null}lookAt(t,e,s){t.isVector3?We.copy(t):We.set(t,e,s);const r=this.parent;Bn.setFromMatrixPosition(this.matrixWorld),ue.lookAt(We,Bn,this.up),this.isCamera||this.isLight?ue.lookAt(Bn,We,this.up):ue.lookAt(We,Bn,this.up),this.quaternion.setFromRotationMatrix(ue).invert(),r&&(ue.extractRotation(r.matrixWorld),rr.setFromRotationMatrix(ue),this.quaternion.premultiply(rr.invert()))}printHierarchy(t=0){let e=this.name+`:
`;return this.children.forEach(s=>{e+="----".repeat(t)+s.printHierarchy(t+1)}),e}getWorldDirection(){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.data;return new L(t[8],t[9],t[10]).normalize()}getWorldRight(){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.data;return new L(t[0],t[1],t[2]).normalize()}getLocalPosition(){}setLocalPosition(t,e,s){}find(t){const e=[];for(let s=0;s<this.children.length;s++)t(this.children[s])&&e.push(this.children[s]),this.children[s].children.length>0&&e.push(this.children[s].find(t));return e.flat()}findOne(t){for(let e=0;e<this.children.length;e++){if(t(this.children[e]))return this.children[e];if(this.children[e].children.length>0){const s=this.children[e].findOne(t);if(s)return s}}}clone(){const t=new de;return t.position.copy(this.position),t.rotation.copy(this.rotation),t.quaternion.copy(this.quaternion),t.scale.copy(this.scale),t}}var _e;let Qt=(_e=class{constructor(t=1,e,s,r=1){U(this,"gpuType","vec4f");if(this._data=new Float32Array(4),typeof t=="string"){t[0]==="#"?this.fromString(t):this.fromHex(parseInt(t));return}if(typeof t=="number"&&e===void 0){this.fromHex(t);return}this._r=t,this._g=e,this._b=s,this._a=r||1,this._data.set([this._r,this._g,this._b,this._a]),this.byteSize=this._data.byteLength}get r(){return this._r}set r(t){this._r=t,this._data[0]=t,this.onChangeCallback()}get g(){return this._g}set g(t){this._g=t,this._data[1]=t,this.onChangeCallback()}get b(){return this._b}set b(t){this._b=t,this._data[2]=t,this.onChangeCallback()}get a(){return this._a}set a(t){this._a=t,this._data[3]=t,this.onChangeCallback()}get data(){return this._data}fromHex(t){return this._r=(t>>16&255)/255,this._g=(t>>8&255)/255,this._b=(t&255)/255,this._a=1,this._data.set([this._r,this._g,this._b,this._a]),this.onChangeCallback(),this}fromString(t){const e=parseInt(t.slice(1),16);return this._r=(e>>16&255)/255,this._g=(e>>8&255)/255,this._b=(e&255)/255,this._a=1,this._data.set([this._r,this._g,this._b,this._a]),this.onChangeCallback(),this}set(t,e,s,r=1){return typeof t=="string"?t[0]==="#"?this.fromString(t):this.fromHex(parseInt(t)):typeof t=="number"&&e===void 0?this.fromHex(t):(this._r=t,this._g=e,this._b=s,this._a=r||1,this._data.set([this._r,this._g,this._b,this._a]),this.onChangeCallback(),this)}copy(t){return this._r=t.r,this._g=t.g,this._b=t.b,this._a=t.a,this._data.set([this._r,this._g,this._b,this._a]),this.onChangeCallback(),this}clone(){return new _e(this._r,this._g,this._b,this._a)}printRGBA(){return`rgba(${this._r}, ${this._g}, ${this._b}, ${this._a})`}printHex(){return`#${(this._r*255<<16|this._g*255<<8|this._b*255).toString(16)}`}onChange(t){this.onChangeCallback=t}onChangeCallback(){}},U(_e,"byteSize",16),_e);class ve{constructor(t=new L,e=0){this.normal=t,this.constant=e,this.data=new Float32Array([t.x,t.y,t.z,e])}setComponents(t,e,s,r){return this.normal.set(t,e,s),this.constant=r,this.data.set([t,e,s,r]),this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this.data.set(this.normal.data,0),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}}const Xe=new L;class Ss{constructor(t=new L,e=0){this._center=t,this._radius=e,this.data=new Float32Array([t.x,t.y,t.z,e])}get radius(){return this._radius}set radius(t){this._radius=t,this.data[3]=t}get center(){return this._center}set center(t){this._center=t,this.data[0]=t.x,this.data[1]=t.y,this.data[2]=t.z}set(t,e){return this.center.copy(t),this.radius=e,this.data.set([t.x,t.y,t.z,e]),this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):_box.setFromPoints(t).getCenter(s);let r=0;for(let i=0,o=t.length;i<o;i++)r=Math.max(r,s.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this.data.set([s.x,s.y,s.z,this.radius]),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this.data.set([this.center.x,this.center.y,this.center.z,this.radius]),this}translate(t){return this.center.add(t),this.data.set([this.center.x,this.center.y,this.center.z,this.radius]),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Xe.subVectors(t,this.center);const e=Xe.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),r=(s-this.radius)*.5;this.center.addScaledVector(Xe,r/s),this.radius+=r}return this.data.set([this.center.x,this.center.y,this.center.z,this.radius]),this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(_v2.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Xe.copy(t.center).add(_v2)),this.expandByPoint(Xe.copy(t.center).sub(_v2))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const $n=new Ss;new L;class Co{constructor(t=new ve,e=new ve,s=new ve,r=new ve,i=new ve,o=new ve){this.planes=[t,e,s,r,i,o],this.data=new Float32Array(6*4)}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),$n.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),$n.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere($n)}setFromProjectionMatrix(t){const e=this.planes,s=t.data,r=s[0],i=s[1],o=s[2],h=s[3],m=s[4],g=s[5],w=s[6],M=s[7],S=s[8],T=s[9],P=s[10],H=s[11],N=s[12],V=s[13],Q=s[14],G=s[15];e[0].setComponents(h-r,M-m,H-S,G-N).normalize(),e[1].setComponents(h+r,M+m,H+S,G+N).normalize(),e[2].setComponents(h+i,M+g,H+T,G+V).normalize(),e[3].setComponents(h-i,M-g,H-T,G-V).normalize(),e[4].setComponents(h-o,M-w,H-P,G-Q).normalize(),e[5].setComponents(o,w,P,Q).normalize();for(let j=0;j<6;j++){const ct=e[j];this.data.set(ct.data,j*4)}return this}intersectsSphere(t){const e=t.center,s=-t.radius;for(let r=0;r<6;r++)if(this.planes[r].distanceToPoint(e)<s)return!1;return!0}containsPoint(t){for(let e=0;e<6;e++)if(this.planes[e].distanceToPoint(t)<0)return!1;return!0}}const ir=new W,or=new L;class kn extends de{constructor(){super(),this.isCamera=!0,this.type="camera",this.name="Camera",this.target=new L(0,0,0),this.matrixWorldInverse=new W,this.projectionMatrix=new W,this.viewMatrix=new W,this.projectionMatrixInverse=new W,this.projectionViewMatrix=new W,this.rightDirection=new L,this.frustum=new Co;let t=160;t=Math.ceil(t/16)*16,this._data=new Float32Array(t/Float32Array.BYTES_PER_ELEMENT),this.offsets=new Map,this.offsets.set(this.projectionMatrix,0),this.offsets.set(this.viewMatrix,16),this.offsets.set(this.position,32),this.offsets.set(this.direction,36),this.subscribe("resize",this._onResize,this)}updateFrustum(t=!1){ir.multiplyMatrices(this.projectionMatrix,this.matrixWorld.invert()),this.frustum.setFromProjectionMatrix(ir)}_onResize({aspect:t}){this.aspect!==t&&(this.aspect=t,this.updateProjectionMatrix())}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this._data.set(t._data),this}setPosition(t,e,s){if(t.isVector3)this.target.add(or.copy(t).sub(this.position));else{const r=or.set(t-this.position.x,e-this.position.y,s-this.position.z);this.target.add(r)}super.setPosition(t,e,s)}updateViewMatrix(){this.viewMatrix.lookAt(this.position,this.target,this.up),this.rightDirection.set(this.viewMatrix.data[0],this.viewMatrix.data[1],this.viewMatrix.data[2]),this._data.set(this.viewMatrix.data,this.offsets.get(this.viewMatrix)),this._data.set(this.position.data,this.offsets.get(this.position)),this._data.set(this.direction.data,this.offsets.get(this.direction)),this.projectionViewMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.write(this._data,"camera")}updateProjectionMatrix(){}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.updateViewMatrix()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.updateViewMatrix()}clone(){return new this.constructor().copy(this)}onChange(t){this._onChangeCallback=t}_onChangeCallback(){}get data(){return this._data}}U(kn,"struct",{projection:"mat4x4f",view:"mat4x4f",position:"vec3f",_padding:"f32",direction:"vec3f",_padding2:"f32"});class xo extends kn{constructor(t=-1,e=1,s=-1,r=1,i=.1,o=1e3){super(),this.left=t,this.right=e,this.bottom=s,this.top=r,this.near=i,this.far=o,this.aspect=1,this.viewMatrix=new W,this.projectionMatrix=new W,this.up=new L(0,1,0),this.projectionViewMatrix=new W}updateProjectionMatrix(){this.projectionMatrix.ortho(this.left*this.aspect,this.right*this.aspect,this.bottom,this.top,this.near,this.far),this._data.set(this.projectionMatrix.data),this._onChangeCallback()}}class Mo extends de{constructor({color:t="#ffffff",intensity:e=1}={}){super(),this.isLight=!0,this.bufferOffset=0,this.type="Light",this.target=new L,this._color=t.isColor?t:new Qt(t),this._intensity=e,this._castShadow=!1}set intensity(t){this.intensity=t,this.data.set([this.intensity],12),this.needsUpdate=!0}get intensity(){return this._intensity}set color(t){this.color.set(t),this.data.set(this.color.data,0),this.needsUpdate=!0}get color(){return this._color}setColor(t){this.color.set(t)}lookAt(t,e,s){var r;super.lookAt(t,e,s),this.target.set(t,e,s),(r=this.shadow)==null||r.updateMatrices(this)}}const bt=class bt{constructor(t=0,e=0){this.data=new Float32Array(2),wt.create(t,e,this.data)}get x(){return this.data[0]}set x(t){this.data[0]=t}get y(){return this.data[1]}set y(t){this.data[1]=t}set(t,e){return wt.set(t,e,this.data),this}add(t){return wt.add(t.data,this.data,this.data),this}sub(t,e){return wt.sub(t.data,e.data,this.data),this}copy(t){return wt.copy(t.data,this.data),this}clone(){return new bt().copy(this)}distanceTo(t){return wt.distance(this.data,t.data)}length(){return wt.length(this.data)}normalize(){return wt.normalize(this.data,this.data),this}mul(t){return wt.scale(this.data,t,this.data),this}dot(t){return wt.dot(this.data,t.data)}cross(t){return wt.cross(this.data,t.data,this.data),this}lerp(t,e){return wt.lerp(this.data,t.data,e,this.data),this}equals(t){return wt.equals(this.data,t.data)}toString(){return`Vector2(${this.x}, ${this.y})`}static get ZERO(){return new bt}static get ONE(){return new bt(1,1)}static get UP(){return new bt(0,1)}static get DOWN(){return new bt(0,-1)}static get LEFT(){return new bt(-1,0)}static get RIGHT(){return new bt(1,0)}static add(t,e){return new bt().add(t,e)}static sub(t,e){return new bt().sub(t,e)}static copy(t){return new bt().copy(t)}static distance(t,e){return wt.distance(t.data,e.data)}static length(t){return wt.length(t.data)}static normalize(t){return new bt().copy(t).normalize()}static dot(t,e){return wt.dot(t.data,e.data)}static cross(t,e){return new bt().cross(t,e)}static lerp(t,e,s){return new bt().lerp(t,e,s)}static equals(t,e){return wt.equals(t.data,e.data)}static mul(t,e){return new bt().copy(t).mul(e)}};U(bt,"byteSize",2*Float32Array.BYTES_PER_ELEMENT);let Ce=bt;class Ts extends Jn{constructor(t){super(),this.camera=t,this.bias=0,this.radius=1,this.mapSize=2048,this.blurSamples=8,this.map=null,this.mapPass=null,this.autoUpdate=!0,this.needsUpdate=!1,this.matrix=new W,this.projectionViewMatrix=new W,this.projectionMatrixInverse=new W,this.camera.updateProjectionMatrix(),this._shadowIntensity=1,this._shadowBias=.001,this._shadowNormalBias=0,this._shadowRadius=1,this._shadowMapOffsetTextureSize=4,this._shadowMapOffsetFilterSize=3,this._shadowMapRandomRadius=10,this.camera.isShadowCamera=!0,this._data=new Float32Array([this._shadowIntensity,this._shadowBias,this._shadowNormalBias,this._shadowMapOffsetTextureSize,this._shadowMapOffsetFilterSize,this._shadowMapRandomRadius,this.mapSize,this.blurSamples])}updateMatrices(t,e){const s=this.camera;e&&e!==s.aspect&&(s.aspect=e,s.updateProjectionMatrix()),t.matrixWorld.needsUpdate&&(s.position.copy(t.position),s.updateWorldMatrix(!0,!1),s.updateViewMatrix()),this.projectionViewMatrix.multiplyMatrices(s.projectionMatrix,s.viewMatrix)}get data(){return this._data}}U(Ts,"struct",{shadowIntensity:"f32",shadowBias:"f32",shadowNormalBias:"f32",shadowMapOffsetTextureSize:"f32",shadowMapOffsetFilterSize:"f32",shadowMapRandomRadius:"f32",shadowMapSize:"f32",shadowBlurSamples:"f32"});class _o extends Ts{constructor(){super(new xo(-400,400,-400,400,-400,200)),this.isDirectionalLightShadow=!0}updateMatrices(t,e){const s=this.camera;e&&e!==s.aspect&&(s.aspect=e,s.updateProjectionMatrix());const r=t.direction,i=new L;i.copy(r).multiplyScalar(-1),s.target.copy(i),s.updateMatrixWorld(),this.projectionViewMatrix.multiplyMatrices(s.projectionMatrix,s.viewMatrix)}}const ar=new L(0,0,0);class Fs extends Mo{constructor(...t){super(...t),this.isDirectionalLight=!0,this.lightType="DirectionalLight",this.buffer="scene",this.shadow=new _o,this.offsets=new Map,this.offsets.set(this.color,0),this.offsets.set(this.direction,4),this.offsets.set(this.intensity,7),this._data=new Float32Array([...this.color.data,...this.direction.data,this.intensity]),this.byteSize=this._data.byteLength}updateMatrix(){super.updateMatrix(),this.shadow.updateMatrices(this)}setPosition(t,e,s){super.setPosition(t,e,s)}updateMatrixWorld(t){super.updateMatrixWorld(t),this.position.length()&&this.direction.subVectors(this.position,ar).normalize(),this.shadow.updateMatrices(this),this.direction.equalsArray(this._data,this.offsets.get(this.direction))||(this._data.set(this.direction.data,this.offsets.get(this.direction)),this.write(this._data,"directionalLights"))}updateWorldMatrix(t){super.updateWorldMatrix(t),this.position.length()&&this.direction.subVectors(this.position,ar).normalize(),this.shadow.updateMatrices(this),this.direction.equalsArray(this._data,this.offsets.get(this.direction))||(this._data.set(this.direction.data,this.offsets.get(this.direction)),this.write(this._data,"directionalLights"))}lookAt(t,e,s){super.lookAt(t,e,s),this.quaternion.getForwardVector(this.direction),this._data.set(this.direction.data,4),this.direction.equalsArray(this._data,4)||(this._data.set(this.direction.data,4),this.write(this._data,"directionalLights"))}get data(){return this._data}}U(Fs,"struct",{color:"vec4f",direction:"vec3f",intensity:"f32"});const Eo=`const PI : f32 = 3.14159265359;\r
const PI2 : f32 = 6.28318530718;\r
const PI_HALF : f32 = 1.57079632679;\r
const EPSILON : f32 = 0.0001;\r
const m = mat3x3f( 0.00,  0.80,  0.60,\r
              -0.80,  0.36, -0.48,\r
              -0.60, -0.48,  0.64 );\r
\r
fn noise1D(x: f32) -> f32 {\r
    return fract(sin(x) * 43758.5453);\r
}\r
\r
fn mod289_3(x: vec3<f32>) -> vec3<f32> {\r
    return x - floor(x * (1. / 289.)) * 289.;\r
}\r
\r
fn mod289_2(x: vec2<f32>) -> vec2<f32> {\r
    return x - floor(x * (1. / 289.)) * 289.;\r
}\r
\r
fn permute(x: vec3<f32>) -> vec3<f32> {\r
    return mod289_3(((x * 34.) + 1.) * x);\r
}\r
\r
fn bezier(t: f32, p0: vec3f, p1: vec3f, p2: vec3f) -> vec3f {\r
    let u = 1.0 - t;\r
    return u * u * p0 + 2.0 * u * t * p1 + t * t * p2;\r
}\r
\r
fn noise2D(v: vec2<f32>) -> f32 {\r
  // Precompute values for skewed triangular grid\r
  let C = vec4<f32>(\r
    .211324865405187,\r
    // (3.0-sqrt(3.0))/6.0\r
    .366025403784439,\r
    // 0.5*(sqrt(3.0)-1.0)\r
    -.577350269189626,\r
    // -1.0 + 2.0 * C.x\r
    0.024390243902439);\r
    // 1.0 / 41.0\r
\r
    // First corner (x0)\r
    var i = floor(v + dot(v, C.yy));\r
    let x0 = v - i + dot(i, C.xx);\r
\r
    // Other two corners (x1, x2)\r
    let i1 = select(\r
        vec2<f32>(0., 1.),\r
        vec2<f32>(1., 0.),\r
        x0.x > x0.y);\r
    let x1 = x0.xy + C.xx - i1;\r
    let x2 = x0.xy + C.zz;\r
\r
    // Do some permutations to avoid\r
    // truncation effects in permutation\r
    i = mod289_2(i);\r
    let p = permute(\r
        permute(i.y + vec3<f32>(0., i1.y, 1.)) + i.x + vec3<f32>(0., i1.x, 1.));\r
    var m = max(0.5 - vec3<f32>(\r
        dot(x0, x0),\r
        dot(x1, x1),\r
        dot(x2, x2)\r
    ), vec3<f32>(0.));\r
\r
    m = m * m;\r
    m = m * m;\r
\r
    // Gradients:\r
    //  41 pts uniformly over a line, mapped onto a diamond\r
    //  The ring size 17*17 = 289 is close to a multiple\r
    //      of 41 (41*7 = 287)\r
\r
    let x = 2. * fract(p * C.www) - 1.;\r
    let h = abs(x) - .5;\r
    let ox = floor(x + .5);\r
    let a0 = x - ox;\r
\r
    // Normalise gradients implicitly by scaling m\r
    // Approximation of: m *= inversesqrt(a0*a0 + h*h);\r
    m = m * (1.79284291400159 - .85373472095314 * (a0 * a0 + h * h));\r
\r
    // Compute final noise value at P\r
    let g = vec3<f32>(\r
        a0.x * x0.x + h.x * x0.y,\r
        a0.yz * vec2<f32>(x1.x, x2.x) + h.yz * vec2<f32>(x1.y, x2.y)\r
    );\r
\r
    return 130. * dot(m, g);\r
}\r
\r
\r
fn saturate(x: f32) -> f32 {\r
    return clamp(x, 0.0, 1.0);\r
}\r
\r
fn saturate3(x: vec3<f32>) -> vec3<f32> {\r
    return clamp(x, vec3(0.0), vec3(1.0));\r
}\r
\r
fn linearstep(minValue: f32, maxValue: f32, v: f32) -> f32 {\r
    return clamp((v - minValue) / (maxValue - minValue), 0.0, 1.0);\r
}\r
\r
fn inverseLerp(minValue: f32, maxValue: f32, v: f32) -> f32 {\r
    return (v - minValue) / (maxValue - minValue);\r
}\r
\r
fn inverseLerpSat(minValue: f32, maxValue: f32, v: f32) -> f32 {\r
    return saturate((v - minValue) / (maxValue - minValue));\r
}\r
\r
fn remap(v: f32, inMin: f32, inMax: f32, outMin: f32, outMax: f32) -> f32 {\r
    let t = inverseLerp(inMin, inMax, v);\r
    return mix(outMin, outMax, t);\r
}\r
\r
fn smootherstep(edge0: f32, edge1: f32, x: f32) -> f32 {\r
    let t = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\r
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\r
}\r
\r
fn smootherstep2(edge0: vec2<f32>, edge1: vec2<f32>, x: vec2<f32>) -> vec2<f32> {\r
    let t = clamp((x - edge0) / (edge1 - edge0), vec2(0.0), vec2(1.0));\r
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\r
}\r
\r
fn smootherstep3(edge0: vec3<f32>, edge1: vec3<f32>, x: vec3<f32>) -> vec3<f32> {\r
    let t = clamp((x - edge0) / (edge1 - edge0), vec3(0.0), vec3(1.0));\r
    return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);\r
}\r
\r
fn circularOut(t: f32) -> f32 {\r
    return sqrt((2.0 - t) * t);\r
}\r
\r
fn random(vec2f: vec2<f32>) -> f32 {\r
    return fract(sin(dot(vec2f, vec2<f32>(12.9898, 78.233)) * 43758.5453));\r
}\r
fn getScaleFromMatrix(matrix: mat4x4f) -> vec3f {\r
    // Each column vector's length represents the scale in that axis\r
    let scaleX = length(matrix[0].xyz);\r
    let scaleY = length(matrix[1].xyz);\r
    let scaleZ = length(matrix[2].xyz);\r
    \r
    return vec3f(scaleX, scaleY, scaleZ);\r
}\r
\r
const MAX_LIGHTS = 4;\r
const MAX_SAMPLES = 32; \r
\r
fn inverse3x3(m: mat3x3<f32>) -> mat3x3<f32> {\r
    let a00 = m[0][0]; let a01 = m[0][1]; let a02 = m[0][2];\r
    let a10 = m[1][0]; let a11 = m[1][1]; let a12 = m[1][2];\r
    let a20 = m[2][0]; let a21 = m[2][1]; let a22 = m[2][2];\r
\r
    let b01 = a22 * a11 - a12 * a21;\r
    let b11 = -a22 * a10 + a12 * a20;\r
    let b21 = a21 * a10 - a11 * a20;\r
\r
    let det = a00 * b01 + a01 * b11 + a02 * b21;\r
    let invDet = 1.0 / det;\r
\r
    let result = mat3x3<f32>(\r
        vec3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11)) * invDet,\r
        vec3(b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10)) * invDet,\r
        vec3(b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) * invDet\r
    );\r
\r
    return result;\r
}`,Do=`output.position = projectionView * worldPosition;\r
output.vPosition = input.position;\r
output.vPositionW = worldPosition.xyz;\r
output.vNormal = input.normal;\r
output.vNormalW = normalize(worldNormal);`,So="let projectionView = camera.projection * camera.view;",To="let projectionView = lightProjViewMatrix;",Fo=`let modelMatrix = model;\r
var worldPosition = modelMatrix * vec4f(input.position, 1.0);\r
var worldNormal = normalize((modelMatrix * vec4f(input.normal, 0.0)).xyz);`,Io=`let modelMatrix = instances[input.instanceIndex];\r
var worldPosition = modelMatrix * vec4f(input.position, 1.0);\r
var worldNormal = normalize((modelMatrix * vec4f(input.normal, 0.0)).xyz);`,vo=`let skinMatrix = \r
    (joint_matrices[u32(input.joints[0])] * inverse_bind_matrices[u32(input.joints[0])]) * input.weights[0] +\r
    (joint_matrices[u32(input.joints[1])] * inverse_bind_matrices[u32(input.joints[1])]) * input.weights[1] +\r
    (joint_matrices[u32(input.joints[2])] * inverse_bind_matrices[u32(input.joints[2])]) * input.weights[2] +\r
    (joint_matrices[u32(input.joints[3])] * inverse_bind_matrices[u32(input.joints[3])]) * input.weights[3];\r
\r
var worldPosition = model * skinMatrix * vec4f(input.position, 1.0);\r
var modelMatrix = model;\r
\r
let skinNormalMatrix = mat3x3<f32>(skinMatrix[0].xyz, skinMatrix[1].xyz, skinMatrix[2].xyz);\r
let modelNormalMatrix = transpose(inverse3x3(mat3x3<f32>(model[0].xyz, model[1].xyz, model[2].xyz)));\r
var worldNormal = normalize(modelNormalMatrix * skinNormalMatrix * input.normal);`,Ro="output.vUv = input.uv;",Go="output.vFogDistance = length(worldPosition.xyz - camera.position);",Oo=`for (var i = 0; i < scene.directionalLightsNum; i++) {\r
    output.vShadowCoord = vec3f(\r
        posFromLight.xy * vec2f(0.5, -0.5) + vec2f(0.5, 0.5), \r
        posFromLight.z\r
    );\r
}`,Po=`  if (material.useWind == 1.0) {\r
  // Transform wind direction from world space to model space\r
    let worldToModelRotation = transpose(mat3x3<f32>(modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz));\r
    let windDirectionModelSpace = normalize(worldToModelRotation * material.windDirection.xyz);\r
    \r
    let normalizedHeight = input.position.y / material.windHeight;\r
    \r
    // Coherent wind calculation using world position\r
    let worldNoiseScale = 0.01; // Adjust for desired world noise frequency\r
    let worldTimeScale = material.windSpeed;\r
    let worldNoise = noise2D(vec2f(\r
        dot(worldPosition.xz, windDirectionModelSpace.xz) * worldNoiseScale + time * worldTimeScale,\r
        worldPosition.y * worldNoiseScale\r
    ));\r
    \r
    let baseWindStrength = material.windStrength * (0.8 + worldNoise * 0.4);\r
    let windStrength = baseWindStrength * pow(normalizedHeight, 2.0) * sin(time) * worldNoise;\r
    \r
    // Calculate primary bending\r
    let bendFactor = windStrength;\r
    let xzOffset = windDirectionModelSpace.xz * bendFactor * pow(normalizedHeight, 2.0);\r
    let yOffset = bendFactor * normalizedHeight * (1.0 - normalizedHeight);\r
    \r
    // Apply primary bending/\r
    let bentPosition = vec3f(\r
        input.position.x + xzOffset.x,\r
        input.position.y,\r
        input.position.z + xzOffset.y\r
    );\r
    \r
    // Individual branch movement (local noise)\r
    let localNoiseScale = normalizedHeight * 0.1;\r
    let localTimeScale = material.windSpeed;  // Adjust for desired local movement speed\r
    let localNoise = noise2D(vec2f(\r
        input.position.xz * localNoiseScale + time * localTimeScale\r
    ));\r
    \r
    let branchAmplitude =  normalizedHeight; // More movement higher up;\r
    \r
    // Calculate distance from x=0, z=0\r
    let distanceFromOrigin = length(input.position.xz);\r
    \r
    // Scale branch movement based on distance from origin\r
    let scaledBranchAmplitude = branchAmplitude * distanceFromOrigin * 0.05;\r
    \r
    // move vertices more when further from center axis\r
    let branchMovement = vec3f(\r
        localNoise * scaledBranchAmplitude,\r
        abs(localNoise) * scaledBranchAmplitude,\r
        localNoise * scaledBranchAmplitude,\r
    );\r
    \r
    // Combine coherent bending with individual branch movement\r
    let finalPosition = bentPosition + branchMovement;\r
    \r
    // Apply final position\r
    worldPosition = modelMatrix * vec4f(finalPosition, 1.0);\r
  }`,Uo=`if (textureDimensions(diffuseMap).x > 1) {\r
    let wrappedUV = fract(input.vUv);\r
    color *= textureSample(diffuseMap, sampler2D, wrappedUV);\r
    if (color.a < material.alphaTest) {\r
        discard;\r
    }\r
}\r
\r
color = vec4f(material.color.rgb * color.rgb, material.color.a);`,Lo=`if (material.useFog == 1) {\r
    let fogStart = scene.fog.start;\r
    let fogEnd = scene.fog.end;\r
    let fogDensity = scene.fog.density;\r
    let fogType = scene.fog.fogType;\r
    let fogDistance = input.vFogDistance;\r
\r
    var fogFactor = 1.0;\r
\r
    if (fogType == 0) {\r
        // Linear fog\r
        fogFactor = 1.0 - clamp((fogEnd - fogDistance) / (fogEnd - fogStart), 0.0, 1.0);\r
    } else if (fogType == 1) {\r
        // Exponential fog\r
        fogFactor = 1.0 - exp2(-fogDensity * fogDensity * fogDistance * fogDistance);\r
    } else if (fogType == 2) {\r
        // Exponential squared fog\r
        fogFactor = 1.0 - exp2(-fogDensity * fogDensity * fogDensity * fogDistance * fogDistance * fogDistance);\r
    }\r
\r
    let fogColor = scene.fog.color;\r
\r
    color = mix(color, fogColor, fogFactor);\r
}`,Ho=`let DIR_NUM : u32 = u32(scene.directionalLightsNum);\r
\r
// Apply ambient light separately from the directional light loop\r
var finalColor = color.rgb * scene.ambientLight.color.rgb * scene.ambientLight.intensity * material.ambientIntensity;\r
\r
\r
for (var i = 0u; i < DIR_NUM; i = i + 1u) {\r
    let light = scene.directionalLights[i];\r
    var lightDirection = light.direction;\r
    let lightDot = dot(normal, lightDirection);\r
    let lightColor = vec3f(light.color.rgb * light.intensity);\r
    let diffuseFactor = max(lightDot, 0.0);\r
\r
    \r
    // Phong Specular Calculation\r
    var finalSpecular = vec3f(0);\r
    if (material.shininess > 0) {\r
        let viewDir = camera.direction;\r
        let reflectDir = reflect(-lightDirection, normal);\r
        let spec = pow(max(dot(viewDir, reflectDir), 0.0), material.shininess);\r
        let phongSpecular = material.specularColor.rgb * spec * light.intensity;\r
        finalSpecular = phongSpecular;\r
    }\r
    \r
    // Add directional light contribution\r
    finalColor += color.rgb * diffuseFactor * lightColor + finalSpecular;\r
}\r
\r
// Ensure the final color doesn't exceed (1, 1, 1)\r
finalColor = min(finalColor, vec3f(1.0));\r
\r
color = vec4f(finalColor, material.alpha);`,No=`let shadowMapSize = f32(textureDimensions(shadowMap).x);\r
let DIR_LIGHT_NUM = u32(scene.directionalLightsNum);\r
\r
for (var i = 0u; i < MAX_LIGHTS; i++) {\r
    var visibility = 0.0;\r
    var lightingFactor = 0.0;\r
    var shadowPos = vec3<f32>(0.0);\r
\r
    if (i < DIR_LIGHT_NUM) {\r
        let light = scene.directionalLights[i];\r
        let shadowConfig = scene.directionalLightShadows[i];\r
        let matrix = scene.directionalLightMatrices[i];\r
        let shadowBias = shadowConfig.shadowBias;\r
        let lightPos = light.direction * -500.0;\r
        let distToLight = length(lightPos - input.vPositionW);\r
\r
        let posFromLight = matrix * vec4f(input.vPositionW, 1.0);\r
        shadowPos = vec3f(\r
            posFromLight.xy * vec2f(0.5, -0.5) + vec2f(0.5, 0.5), \r
            posFromLight.z\r
        );\r
\r
        // Implement PCF directly in the loop\r
        let pcfScale = 1.0; // Adjust for shadow softness\r
        let texelSize = 0.2 / shadowMapSize;\r
        var totalSamples = 0.0;\r
        \r
        for (var x = -pcfScale; x <= pcfScale; x += 1.0) {\r
            for (var y = -pcfScale; y <= pcfScale; y += 1.0) {\r
                let offset = vec2<f32>(x, y) * texelSize * shadowConfig.shadowMapRandomRadius;\r
                visibility += textureSampleCompare(\r
                    shadowMap,\r
                    samplerComparison,\r
                    shadowPos.xy + offset,\r
                    shadowPos.z - shadowBias\r
                );\r
                totalSamples += 1.0;\r
            }\r
        }\r
        \r
        visibility = visibility / totalSamples;\r
\r
        let lambertFactor = max(dot(normalize(light.direction), normalize(normal)), 0.0);\r
        lightingFactor = min(scene.ambientLight.intensity + visibility * lambertFactor * light.intensity, 1.0);\r
    }\r
\r
    if (all(shadowPos.xy > vec2f(0.0)) && all(shadowPos.xy < vec2f(1.0))) {\r
        color = vec4(color.rgb * lightingFactor, material.alpha);\r
    }\r
}`,Jo="color = vec4f(mix(color.rgb, material.emissionColor.rgb, material.emissionIntensity), material.alpha);",ko=`@group(0) @binding(2) var diffuseMap: texture_2d<f32>;\r
@group(0) @binding(3) var sampler2D: sampler;\r
\r
struct FragmentInput {\r
    @builtin(position) position: vec4f,\r
    @location(0) vUv: vec2f,\r
}\r
\r
@fragment\r
fn main(input: FragmentInput) -> @location(0) f32 {\r
    return input.position.z / input.position.w;\r
}`,zo=`var normal = input.vNormalW;\r
if (textureDimensions(normalMap).x > 1) {\r
    let dp1 = dpdx(input.vPositionW);\r
    let dp2 = dpdy(input.vPositionW);\r
    let duv1 = dpdx(input.vUv);\r
    let duv2 = dpdy(input.vUv);\r
\r
    // Calculate tangent and bitangent\r
    let r = 1.0 / (duv1.x * duv2.y - duv1.y * duv2.x);\r
    let tangent = (dp1 * duv2.y - dp2 * duv1.y) * r;\r
    let bitangent = (dp2 * duv1.x - dp1 * duv2.x) * r;\r
\r
    // Rest is same as before\r
    let normal_map_value = textureSample(normalMap, sampler2D, input.vUv).xyz;\r
    let normal_from_map = normal_map_value * 2.0 - 1.0;\r
\r
    let tbn = mat3x3<f32>(\r
        normalize(tangent),\r
        normalize(bitangent),\r
        normalize(normal)\r
    );\r
\r
    normal = normalize(tbn * normal_from_map);\r
}`,Vo=`var height_uv = input.vUv;\r
\r
if (textureDimensions(heightMap).x > 1) {\r
    let dp1 = dpdx(input.vPositionW);\r
    let dp2 = dpdy(input.vPositionW);\r
    let duv1 = dpdx(input.vUv);\r
    let duv2 = dpdy(input.vUv);\r
    color = vec4(1, 0, 0, 1);\r
\r
    // Calculate tangent and bitangent\r
    let r = 1.0 / (duv1.x * duv2.y - duv1.y * duv2.x);\r
    let tangent = (dp1 * duv2.y - dp2 * duv1.y) * r;\r
    let bitangent = (dp2 * duv1.x - dp1 * duv2.x) * r;\r
    let view_dir = camera.direction;\r
    var tbn = mat3x3<f32>(\r
        normalize(tangent),\r
        normalize(bitangent),\r
        normalize(input.vNormalW)\r
    );\r
    \r
    let view_dir_tangent = normalize(tbn * view_dir);\r
\r
    // Parallax mapping parameters\r
    let height_scale = 0.1;  // Adjust this for stronger/weaker effect\r
    let num_layers = 2.0;    // More layers = better quality but slower\r
    \r
    // Calculate step size\r
    let layer_depth = 1.0 / num_layers;\r
    var current_layer_depth = 0.0;\r
    \r
    // Calculate initial UV offset per layer\r
    let delta_uv = (view_dir_tangent.xy * height_scale) / (view_dir_tangent.z * num_layers);\r
    \r
    var current_uv = input.vUv;\r
    var current_depth = textureSample(heightMap, sampler2D, current_uv).r;\r
    \r
    // While the current depth is less than the layer depth, move to next layer\r
    for (var i = 0u; i < 2u; i = i + 1u) {\r
        if (current_layer_depth >= 1.0) {\r
            break;\r
        }\r
        \r
        current_uv -= delta_uv;\r
        current_depth = textureSample(heightMap, sampler2D, current_uv).r;\r
        current_layer_depth += layer_depth;\r
    }\r
    \r
    // Get previous values for interpolation\r
    let prev_uv = current_uv + delta_uv;\r
    let prev_depth = textureSample(heightMap, sampler2D, prev_uv).r - \r
                    (current_layer_depth - layer_depth);\r
    \r
    // Get depth after current layer\r
    let after_depth = current_depth - current_layer_depth;\r
    \r
    // Interpolate UVs based on depth difference\r
    let weight = after_depth / (after_depth - prev_depth);\r
    let final_uv = prev_uv * weight + current_uv * (1.0 - weight);\r
    \r
    if (textureDimensions(diffuseMap).x > 1) {\r
        color = textureSample(diffuseMap, sampler2D, final_uv);\r
    }\r
}`,jo=`fn getDepthOffset(worldPos: vec3f) -> f32 {\r
    let h = dot(worldPos, vec3f(0.8191725, 0.6710726, 0.9497474));\r
    return fract(h * 1677.0) * 0.0001;\r
}\r
\r
fn getScaleFromMatrix(matrix: mat4x4f) -> vec3f {\r
    // Each column vector's length represents the scale in that axis\r
    let scaleX = length(matrix[0].xyz);\r
    let scaleY = length(matrix[1].xyz);\r
    let scaleZ = length(matrix[2].xyz);\r
    \r
    return vec3f(scaleX, scaleY, scaleZ);\r
}\r
\r
fn isOccluded(worldPos: vec3f, radius: f32, viewProj: mat4x4f) -> bool {\r
    let projected = viewProj * vec4f(worldPos, 1.0);\r
    \r
    // Early out if behind camera\r
    if (projected.w <= 0.0) {\r
        return true;\r
    }\r
    \r
    let ndc = projected.xyz / projected.w;\r
    \r
    // Convert NDC depth to 0-1 range\r
    let depthNorm = (ndc.z + 1.0) * 0.5 + getDepthOffset(worldPos);\r
    \r
    // Apply radius in view space (before projection)\r
    // This is a simplified approach - ideally radius should be projected properly\r
    let radiusInDepth = radius / projected.w;\r
    let depth = depthNorm - radiusInDepth;\r
    \r
    // Convert to UV space (handle Y-flip if needed based on API)\r
    let uv = vec2f(ndc.x * 0.5 + 0.5, ndc.y * -0.5 + 0.5); // Flip Y for Vulkan\r
    let uvSize = vec2f(textureDimensions(depthTexture));\r
    let pixelCoord = vec2u(uv * uvSize);\r
    \r
    // Sample depth\r
    let storedDepth = textureLoad(depthTexture, pixelCoord, 0);\r
    \r
    // Compare with bias to avoid z-fighting\r
    let bias = 0.0001;\r
    return depth > (storedDepth + bias);\r
}\r
\r
struct Camera {\r
  viewProjection: mat4x4f,\r
  frustumPlanes: array<vec4f, 6>,\r
  position: vec3f,\r
}\r
\r
struct BoundingSphere {\r
  center: vec3f,\r
  radius: f32,\r
}\r
\r
struct Instance {\r
  modelMatrix: mat4x4f,\r
}\r
\r
struct DrawCommand {\r
  vertexCount: u32,\r
  instanceCount: atomic<u32>,\r
  firstVertex: u32,\r
  firstInstance: u32,\r
}\r
\r
struct VisibleInstance {\r
  modelMatrix: mat4x4f,\r
}\r
\r
@group(0) @binding(0) var<uniform> camera: Camera;\r
@group(0) @binding(1) var<uniform> boundingSphere: BoundingSphere;\r
@group(0) @binding(2) var<storage, read> instances: array<Instance>;\r
@group(0) @binding(3) var depthTexture: texture_depth_2d;\r
@group(0) @binding(4) var<storage, read_write> drawCommands: array<DrawCommand>;\r
@group(0) @binding(5) var<storage, read_write> visibleInstances: array<mat4x4f>;\r
\r
fn inFrustum(worldPos: vec3f, radius: f32, frustumPlanes: array<vec4f, 6>) -> bool {\r
  for (var i = 0u; i < 6u; i++) {\r
    let plane = frustumPlanes[i];\r
    let distance = dot(vec4f(worldPos, 1.0), plane);\r
    if (distance < -radius) {\r
      return false;\r
    }\r
  }\r
  return true;\r
}\r
\r
\r
\r
@compute @workgroup_size(64)\r
fn main(@builtin(global_invocation_id) global_id: vec3u) {\r
    let index = global_id.x;\r
    if (index >= arrayLength(&instances)) {\r
        return;\r
    }\r
\r
    let instance = instances[index];\r
    let sphere = boundingSphere;\r
    let scale = getScaleFromMatrix(instance.modelMatrix);\r
    let radius = sphere.radius * max(max(scale.x, scale.y), scale.z);\r
    let worldCenter = (instance.modelMatrix * vec4f(sphere.center, 1.0)).xyz;\r
    let cameraPos = camera.position;\r
    var isInsideSphere = distance(worldCenter, cameraPos) < radius * scale.x;\r
    var isVisible = true;\r
\r
    var isFar = distance(worldCenter, cameraPos) > 200.0;\r
    if (isFar && radius < 10.0) {\r
        isVisible = false;\r
    }\r
    \r
    if (!isInsideSphere) {\r
        if (!inFrustum(worldCenter, radius, camera.frustumPlanes)) {\r
            isVisible = false;\r
        }\r
        \r
        if (isVisible && isOccluded(worldCenter, radius, camera.viewProjection)) {\r
            isVisible = false;\r
        }\r
    }\r
\r
\r
    // If visible, append to visible instances array and increment count\r
    if (isVisible) {\r
        let visibleIndex = atomicAdd(&drawCommands[0].instanceCount, 1u);\r
        visibleInstances[visibleIndex] = instance.modelMatrix;\r
    } \r
}`;class Be{constructor(t,e,s="perspective"){this.name=t,this.type=e,this.interpolation=s}toString(t){return`@location(${t}) @interpolate(${this.interpolation}) ${this.name}: ${this.type}`}}const qn={mat2x2f:16,mat3x3f:36,mat4x4f:64,vec2f:8,vec3f:12,vec4f:16,f32:4,i32:4,u32:4},si={mat2x2f:4,mat3x3f:9,mat4x4f:16,vec2f:2,vec3f:3,vec4f:4,f32:1,i32:1,u32:1},X={RENDER:1,SHADOW:2,COMPUTE:4};class zn{constructor(t,e,s){this.name=t,this.code=e,this.use=X.RENDER|X.SHADOW,this.varyings=s}setUse(t){return this.use=t,this}get useRender(){return this.use&X.RENDER}get useShadow(){return this.use&X.SHADOW}get useCompute(){return this.use&X.COMPUTE}}class ce extends zn{constructor(t,e,s=[]){super(t,e,s),this.isVertexChunk=!0}}class le extends zn{constructor(t,e,s){super(t,e,s),this.isFragmentChunk=!0}}class Ko extends zn{constructor(t,e){super(t,e),this.isComputeChunk=!0}}class ut{}U(ut,"common",new zn("common",Eo)),U(ut,"vertex",{model:new ce("vertex_model",Fo),model_instanced:new ce("vertex_model_instanced",Io),model_skinned:new ce("vertex_model_skinned",vo),position:new ce("vertex_position",Do,[new Be("vPosition","vec3f"),new Be("vPositionW","vec3f"),new Be("vNormal","vec3f"),new Be("vNormalW","vec3f")]),projection_camera:new ce("vertex_projection_camera",So).setUse(X.RENDER),projection_shadow:new ce("vertex_projection_light",To).setUse(X.SHADOW),uv:new ce("vertex_uv",Ro,[new Be("vUv","vec2f")]),fog:new ce("vertex_fog",Go,[new Be("vFogDistance","f32")]).setUse(X.RENDER),shadowmap:new ce("vertex_shadowmap",Oo,[new Be("vShadowCoord","vec4f")]).setUse(X.RENDER),wind:new ce("vertex_wind",Po)}),U(ut,"fragment",{shadow_depth:new le("fragment_shadow_depth",ko).setUse(X.SHADOW),diffuse_map:new le("fragment_diffuse_map",Uo),emission:new le("fragment_light_phong",Jo).setUse(X.RENDER),fog:new le("fragment_fog",Lo).setUse(X.RENDER),light_phong:new le("fragment_light_phong",Ho).setUse(X.RENDER),shadowmap:new le("fragment_shadowmap",No).setUse(X.RENDER),normal_map:new le("fragment_normal_map",zo).setUse(X.RENDER),height_map:new le("fragment_height_map",Vo).setUse(X.RENDER)}),U(ut,"compute",{culling:new Ko("culling",jo)});class Ee{static capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}static structToString(t,e){let s=`struct ${Ee.capitalize(t)} {
`;return Object.entries(e).forEach(([r,i])=>{s+=`    ${r}: ${i},
`}),s+=`}
`,s}}class He{constructor(t,e,s,r=X.RENDER|X.SHADOW,i=GPUShaderStage.FRAGMENT){this.name=t,this.type=e,this.use=r,this.texture=s,this.layout=this.getLayoutByType(e),this.visibility=i}setTexture(t){return this.texture=t,this}getLayoutByType(t){if(t==="texture_2d<f32>")return{};if(t==="texture_depth_2d")return{sampleType:"depth"};if(t==="texture_3d<f32>")return{viewDimension:"3d",sampleType:"unfilterable-float"}}getBindGroupString(t=0,e=0){return`
@group(${t}) @binding(${e}) var ${this.name}: ${this.type};`}get useRender(){return this.use&X.RENDER}get useShadow(){return this.use&X.SHADOW}get useCompute(){return this.use&X.COMPUTE}}const Wo=/^(f32|i32|u32|vec[2-4](f|i|u)|mat[2-4]x[2-4]f)$/;class En{constructor(t,e){this.device=t,this.renderer=e}static getFormat(t){if(!t)throw new Error("Utils.getFormat: value is undefined");if(typeof t=="number")return"f32";if(t instanceof He)return t.format;if(t instanceof Color)return"vec4f";if(t instanceof Float32Array)return`array<f32, ${t.length}>`;if(t instanceof Int32Array)return`array<i32, ${t.length}>`}arraysEqual(t,e,s=0,r=0,i=t.length){for(let o=0;o<i;o++)if(t[s+o]!==e[r+o])return!1;return!0}static isType(t){return Wo.test(t)}static align16(t){return Math.ceil(t/16)*16}static getTypeByteSize(t){if(!this.isType(t))throw new Error("Utils.getSize: type is not a valid type");if(t.includes("32"))return 4;if(t==="vec2f")return 8;if(t==="vec3f")return 12;if(t==="vec4f"||t==="mat2x2f")return 16;if(t==="mat3x3f")return 36;if(t==="mat4x4f")return 64}static getStructByteSize(t){let e=0;for(let s in t)e+=this.getTypeByteSize(t[s]);return e}static getTypeCount(t){if(!this.isType(t))throw new Error("Utils.getTypeCount: type is not a valid type");if(t.includes("32"))return 1;if(t==="vec2f")return 2;if(t==="vec3f")return 3;if(t==="vec4f"||t==="mat2x2f")return 4;if(t==="mat3x3f")return 9;if(t==="mat4x4f")return 16}static getSamplerLayoutByType(t){switch(t){case"sampler":return{};case"sampler_comparison":return{type:"comparison"};default:throw new Error("Utils.getSamplerLayoutByType: type is not a valid type")}}static getValueSize(t){if(!t)throw new Error("Utils.getSize: value is undefined");if(t instanceof He||t instanceof Color)return t.byteSize;if(t instanceof Float32Array||t instanceof Int32Array)return t.byteLength;if(typeof t=="number")return 4}static getPreferredCanvasFormat(){return navigator.gpu.getPreferredCanvasFormat()}static getPrimitiveTopology(t,e){if(t.isMesh)return GPUPrimitiveTopology.TriangleList;if(t.isLine)return GPUPrimitiveTopology.LineStrip;if(t.isPoints)return GPUPrimitiveTopology.PointList}}class ae{constructor({name:t,uniforms:e,bindGroup:s=0,perMesh:r=!1,isMaterial:i=!1,type:o="uniform",use:h=X.RENDER|X.SHADOW,storageOp:m="read",bufferType:g="uniform",visibility:w=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT}){this.name=t,this.uniforms=e,this.visibility=w,this.perMesh=r,this.isMaterial=i,this.type=o,this.use=h,this.bindGroup=s,this.storageOp=m,this.bufferType=g,this.calculateGroupByteSize(),this._data=new Float32Array(this.byteSize/Float32Array.BYTES_PER_ELEMENT),this.offsets={},this.byteOffsets={};let M=0,S=0;this.bufferLayout=this.bufferType==="uniform"?"uniform":this.storageOp==="read"?"read-only-storage":"storage",this.bufferTypeString=this.bufferType==="uniform"?"uniform":`storage, ${this.storageOp}`,this.uniforms.forEach(T=>{T.bufferOffset=M,this.offsets[T.name]=M,M+=T.byteSize/Float32Array.BYTES_PER_ELEMENT,this.byteOffsets[T.name]=S,S+=T.byteSize})}mergeData(){let t=0;this.uniforms.forEach(e=>{e.bufferOffset=t,this._data.set(e.data,t),t+=e.data.length})}calculateGroupByteSize(){const t=this.uniforms.reduce((e,s)=>e+s.byteSize,0);return this.byteSize=En.align16(t),this.byteSize}getStructsString(){let t="";return this.uniforms.length>1&&this.uniforms.forEach(e=>{(e.isStruct||e.isStructArray)&&(t+=e.structString)}),t}getByName(t){return this.uniforms.find(e=>e.name===t)}getMainStructString(){let t="";return this.uniforms.length>1&&(t=`struct ${Ee.capitalize(this.name)} {
`,this.uniforms.forEach(e=>{t+=`    ${e.getString()}`}),t+=`}
`),this.uniforms.length===1&&(t=this.uniforms[0].structString),t}get(t){return this.uniforms.find(e=>e.name===t)}set(t,e){const s=this.uniforms.find(r=>r.name===t);s&&s.set(e)}getBindGroupString(t=0,e=0){const r=this.uniforms.length>1||this.uniforms[0].isStruct||this.uniforms[0].isStructArray?Ee.capitalize(this.name):this.uniforms[0].type;return`@group(${t}) @binding(${e}) var<${this.bufferTypeString}> ${this.name}: ${r};
`}clone(){return new ae({name:this.name,uniforms:this.uniforms.map(t=>t.clone()),bindGroup:this.bindGroup,perMesh:this.perMesh,visibility:this.visibility})}has(t){return this.uniforms.some(e=>e.name===t)}get useShadow(){return this.use&X.SHADOW}get useRender(){return this.use&X.RENDER}get useCompute(){return this.use&X.COMPUTE}get data(){return this._data}}class At{constructor(t){this.name=t,this.isUniform=!0,this.byteSize=0,this.bufferOffset=0,this._needsUpdate=!0,this._data=new Float32Array([])}recalculateByteSize(t){return this}setBuffer(t){return this.buffer=t,this}uint(t){return this.value=t||0,this.isUint=!0,this.type="u32",this.byteSize=4,this._data=new Float32Array([t]),this}color(t){return this.value=t||new Qt,this.isColor=!0,this.type="vec4f",this.byteSize=Qt.byteSize,this._data=this.value.data,this}vec2(t){return this.value=t||[0,0],this.isVector2=!0,this.type="vec2f",this.byteSize=8,this._data=new Float32Array(this.value),this}vec3(t){return this.value=t||[0,0,0],this.isVector3=!0,this.type="vec3f",this.byteSize=12,this._data=new Float32Array(this.value),this}vec4(t){return this.value=t||[0,0,0,0],this.isVector4=!0,this.type="vec4f",this.byteSize=16,this._data=new Float32Array(this.value.data),this}float(t){return this.value=t,this.byteSize=4,this.type="f32",this.isFloat=!0,this._data=new Float32Array([t]),this}int(t){return this.value=t,this.byteSize=4,this.isInt=!0,this.type="i32",this._data=new Float32Array([t]),this}mat4(t){return this.value=t||new W().identity(),this.byteSize=W.byteSize,this.isMat4=!0,this.type="mat4x4f",this._data=this.value.data,this}storage(t,e=1){return this.isStorage=!0,this.type=`array<${t}>`,this.byteSize=e*qn[t],this._data=new Float32Array(e*si[t]),this}mat4Array(t){return this.value=[],this.byteSize=W.byteSize*t,this.isMat4Array=!0,this.type=`array<mat4x4f, ${t}>`,this._data=new Float32Array(this.byteSize/Float32Array.BYTES_PER_ELEMENT),this}mat3(t){return this.value=t,this.byteSize=64,this.isMat3=!0,this.type="mat3x3f",this._data=new Float32Array(t.data),this}storageStruct(t,e,s=1){this.isStorageStruct=!0,this.structString=Ee.structToString(t,e),this.type=`array<${t}, ${s}>`;const r=Object.values(e).reduce((i,o)=>i+qn[o],0);this.byteSize=En.align16(r*s),this._data=new Float32Array(this.byteSize/Float32Array.BYTES_PER_ELEMENT)}struct(t,e){this.isStruct=!0,this.structString=Ee.structToString(t,e),this.type=t;const s=Object.values(e).reduce((r,i)=>r+qn[i],0);return this.byteSize=En.align16(s),this._data=new Float32Array(this.byteSize/Float32Array.BYTES_PER_ELEMENT),this}structArray(t,e,s=1){this.isStructArray=!0,this.structString=Ee.structToString(t,e);const r=En.getStructByteSize(e)*s;return this.byteSize=Math.ceil(r/16)*16,this.type=`array<${t}, ${s}>`,this._data=new Float32Array(this.byteSize/Float32Array.BYTES_PER_ELEMENT),this}set(t){if(this.value=t,t.data&&this._data.set(t.data),typeof t=="number"&&(this._data[0]=t),Array.isArray(t)&&t[0].data){let e=0;for(let s=0;s<t.length;s++)this._data.set(t[s].data,e),e+=t[s].data.length}return this}get data(){return this._data}get needsUpdate(){return this._needsUpdate}getString(){return`${this.name}: ${this.type},
`}clone(){const t=new At(this.name);return Object.assign(t,this),t._data=new Float32Array(this._data),t}}const tn=class tn{constructor(t){t={color:16777215,type:tn.LINEAR,density:25e-5,start:10,end:100,...t},this._color=t.color instanceof Qt?t.color:new Qt(t.color),this._start=t.start,this._end=t.end,this._density=t.density,this._type=t.type,this.byteSize=32,this.isFog=!0,this._data=new Float32Array([this._color.r,this._color.g,this._color.b,this._color.a,this._density,this._start,this._end,this._type])}set color(t){this._color=t,this._data.set(this._color.data,0)}get color(){return this._color}set start(t){this._start=t,this._data[4]=t}get start(){return this._start}set end(t){this._end=t,this._data[5]=t}get end(){return this._end}set density(t){this._density=t,this._data[6]=t}get density(){return this._density}set type(t){this._type=t,this._data[7]=t}get type(){return this._type}set data(t){this._data=t}get data(){return this._data}};U(tn,"byteSize",32),U(tn,"struct",{color:"vec4f",density:"f32",start:"f32",end:"f32",fogType:"f32"});let ge=tn;ge.LINEAR=0;ge.EXPONENTIAL=1;ge.EXPONENTIAL_SQUARED=2;class Nt{static compose(t){const e=t.uniforms;let s="",r="",i=0;for(const{name:h,uniforms:m}of Object.values(e)){s+=`struct ${h} {
`,r+=`@group(1) @binding(${i}) var<uniform> ${h.toLowerCase()}: ${h};
`;for(const g in m){const w=m[g];w.value&&(s+=`    ${g}: ${w.type},
`)}s+=`}
`,i++}return`${s}${r}`}}U(Nt,"model",new ae({name:"model",bindGroup:0,perMesh:!0,visibility:GPUShaderStage.VERTEX,uniforms:[new At("model").mat4()]})),U(Nt,"instances",()=>new ae({name:"instances",bindGroup:0,perMesh:!0,visibility:GPUShaderStage.VERTEX,type:"storage",bufferType:"storage",uniforms:[new At("instances").storage("mat4x4f",1)]})),U(Nt,"lightProjViewMatrix",new ae({name:"lightProjViewMatrix",bindGroup:0,visibility:GPUShaderStage.VERTEX,perMesh:!1,use:X.SHADOW,uniforms:[new At("lightProjViewMatrix").mat4()]})),U(Nt,"camera",new ae({name:"camera",use:X.RENDER,bindGroup:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,perMesh:!1,uniforms:[new At("camera").struct("Camera",kn.struct)]})),U(Nt,"time",new ae({name:"time",bindGroup:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,perMesh:!1,uniforms:[new At("time").float(0)]})),U(Nt,"scene",new ae({name:"scene",bindGroup:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,perMesh:!1,use:X.RENDER,uniforms:[new At("fog").struct("Fog",ge.struct),new At("ambientLight").struct("AmbientLight",{color:"vec4f",intensity:"f32",_pad:"f32",_pad2:"f32",_pad3:"f32"}),new At("directionalLights").structArray("DirectionalLight",Fs.struct,4),new At("directionalLightShadows").structArray("DirectionalLightShadow",Ts.struct,4),new At("directionalLightMatrices").mat4Array(4),new At("directionalLightsNum").float(0),new At("pointLightsNum").float(0),new At("pad2").float(0)]}));class xe{constructor(){}static getAttributeType(t){switch(t.name){case"position":case"normal":case"color":return"vec3f";case"uv":return"vec2f";case"joints":return"vec4f";case"weights":return"vec4f"}}static formatShaderCode(t){return t.replace(/\n\s{12}/g,`
`).replace(/ {4,}(?=(const|struct|@group))/g,"").replace(/ {1,}(?=(const|struct|@group))/g,"").replace(/\n\s{1,}@location/g,`
    @location`).replace(/;\r\n/g,`;
    `)}static composeShadow(t){const{geometry:e,material:s}=t;let r=0;const i=e.getVertexAttributesLayout(),o=s.uniforms.filter(G=>G.useShadow),h=s.textures.filter(G=>G.useShadow),m=s.samplers.filter(G=>G.useShadow);let g=o.map((G,j)=>G.getBindGroupString(0,r++)).join(`
`);g+=h.map((G,j)=>G.getBindGroupString(0,r++)).join(`
`),g+=m.map((G,j)=>G.getBindGroupString(0,r++)).join(`
`);const w=o.map(G=>G.getStructsString()).join(`
`),M=o.map(G=>G.getMainStructString()).join(`
`),S=i.attributes.map(G=>`@location(${G.shaderLocation}) ${G.name}: ${xe.getAttributeType(G)},`).join(`
   `),T=s.chunks.vertex.filter(G=>{var j;return G.useShadow||((j=G[t.type])==null?void 0:j.useShadow)}).map(G=>G.code?G:G[t.type]),P=T.map(G=>G.code).join(`
    `),H=T.map(G=>G.varyings).flat().map((G,j)=>G.toString(j)+",").join(`
   `),N=s.chunks.fragment.filter(G=>G.useShadow).map(G=>G.code||G[t.type].code).join(`
    `),V=xe.formatShaderCode(`
            ${ut.common.code}

            ${w}

            ${M}
            
            ${g}
            
            struct VertexInput { 
                @builtin(instance_index) instanceIndex: u32,
                ${S} 
            } 
            struct VertexOutput {
                @builtin(position) position: vec4f,
                ${H}
            }
            
            @vertex
            fn main(input: VertexInput) -> VertexOutput {
                var output: VertexOutput;
                ${P}
                return output;
            }
        `),Q=`
            ${ut.common.code}
            
            ${w}

            ${M}

            ${g}

            struct FragmentInput {
                @builtin(position) position: vec4f,
                ${H}
            }
            
            @fragment
            fn main(input: FragmentInput) -> @location(0) f32 {
                var color = vec4f(1.0);
                ${N}
                return input.position.z / input.position.w;
            }
        `;return{vertexShader:V,fragmentShader:Q}}static compose(t){const{geometry:e,material:s}=t;let r=0;const i=e.getVertexAttributesLayout(),o=s.uniforms.filter(G=>G.useRender),h=s.textures.filter(G=>G.useRender),m=s.samplers.filter(G=>G.useRender);let g=o.map((G,j)=>G.getBindGroupString(0,r++)).join(`
`);g+=h.map((G,j)=>G.getBindGroupString(0,r++)).join(`
`),g+=m.map((G,j)=>G.getBindGroupString(0,r++)).join(`
`);const w=o.map(G=>G.getStructsString()).join(`
`),M=o.map(G=>G.getMainStructString()).join(`
`),S=i.attributes.map(G=>`@location(${G.shaderLocation}) ${G.name}: ${xe.getAttributeType(G)},`).join(`
   `),T=s.chunks.vertex.filter(G=>{var j;return G.useRender||((j=G[t.type])==null?void 0:j.useRender)}).map(G=>G.code?G:G[t.type]),P=T.map(G=>G.code).join(`
    `),H=T.map(G=>G.varyings).flat().map((G,j)=>G.toString(j)+",").join(`
   `),N=s.chunks.fragment.filter(G=>G.useRender).map(G=>G.code||G[t.type].code).join(`
    `),V=xe.formatShaderCode(`
            ${ut.common.code}

            ${w}

            ${M}
            
            ${g}
            
            struct VertexInput { 
                @builtin(instance_index) instanceIndex: u32,
                ${S} 
            } 
            struct VertexOutput {
                @builtin(position) position: vec4f,
                ${H}
            }
            
            @vertex
            fn main(input: VertexInput) -> VertexOutput {
                var output: VertexOutput;
                ${P}
                return output;
            }
        `),Q=`
            ${ut.common.code}
            
            ${w}

            ${M}

            ${g}

            struct FragmentInput {
                @builtin(position) position: vec4f,
                ${H}
            }
            
            struct FragmentOutput {
                @location(0) color: vec4f
            }
            
            @fragment
            fn main(input: FragmentInput) -> FragmentOutput {
                var output: FragmentOutput;
                var color = material.color;
                ${N}
                output.color = color;
                return output;
            }
        `;return{vertexShader:V,fragmentShader:Q}}}class Xo{constructor(t,e){this.device=t,this.renderer=e,this.layoutCache=new Map,this.groupCache=new Map}createRenderBindGroupLayout(t){const s=t.mesh.material,r=[];let i=0;for(const h of s.uniforms){if(!h.useRender)continue;const m={label:h.name,binding:i++,visibility:h.visibility,buffer:{type:h.bufferLayout}};r.push(m)}for(const h of s.textures){if(!h.useRender)continue;const m={label:h.name,binding:i++,visibility:h.visibility,texture:h.layout};r.push(m)}for(const h of s.samplers){if(!h.useRender)continue;const m={label:h.name,binding:i++,visibility:h.visibility,sampler:h.layout};r.push(m)}const o=this.device.createBindGroupLayout({label:`${s.type} Render Bind Group Layout`,entries:r});return this.layoutCache.set(s,o),o}createRenderBindGroup(t,e){let s=0;const r=t.mesh,i=[],o=r.material.uniforms.filter(M=>M.useRender).map((M,S)=>{let T=null;return M.perMesh?T=this.renderer.buffers.createUniformBuffer(M,r):M.isMaterial?T=this.renderer.buffers.createUniformBuffer(M,r.material):T=this.renderer.buffers.createUniformBuffer(M),t.setUniformBuffer(M.name,T),{label:M.name,binding:s++,resource:{buffer:T}}}),h=r.material.textures.filter(M=>M.useRender).map(M=>{var T;let S=((T=M.texture)==null?void 0:T.createView({label:M.name}))||this.renderer.textures.getView(M.name)||this.renderer.textures.getView("default");return{binding:s++,resource:S}}),m=r.material.samplers.filter(M=>M.useRender).map(M=>({binding:s++,resource:this.renderer.samplers.get(M.type)})),g={label:`${r.material.type} Render Bind Group`,layout:e,entries:[...o,...i,...h,...m]};return this.device.createBindGroup(g)}createShadowBindGroupLayout(t){const s=t.mesh.material,r=[];let i=0;for(const h of s.uniforms){if(!h.useShadow)continue;const m={label:h.name,binding:i++,visibility:h.visibility,buffer:{type:h.bufferLayout}};r.push(m)}for(const h of s.textures){if(!h.useShadow)continue;const m={label:h.name,binding:i++,visibility:h.visibility,texture:h.layout};r.push(m)}for(const h of s.samplers){if(!h.useShadow)continue;const m={label:h.name,binding:i++,visibility:h.visibility,sampler:h.layout};r.push(m)}const o=this.device.createBindGroupLayout({label:`${s.type} Shadow Bind Group Layout`,entries:r});return this.layoutCache.set(s,o),o}createShadowBindGroup(t,e){const s=t.mesh;let r=0;const i=[],o=s.material.uniforms.filter(M=>M.useShadow).map((M,S)=>{let T=null;return M.perMesh?T=this.renderer.buffers.createUniformBuffer(M,s):M.isMaterial?T=this.renderer.buffers.createUniformBuffer(M,s.material):T=this.renderer.buffers.createUniformBuffer(M),t.setUniformBuffer(M.name,T),{label:M.name,binding:r++,resource:{buffer:T}}}),h=s.material.textures.filter(M=>M.useShadow).map(M=>{var T;let S=((T=M.texture)==null?void 0:T.createView())||this.renderer.textures.getView(M.name)||this.renderer.textures.getView("default");return{binding:r++,resource:S}}),m=s.material.samplers.filter(M=>M.useShadow).map(M=>({binding:r++,resource:this.renderer.samplers.get(M.type)})),g={label:`${s.material.type} Shadow Bind Group`,layout:e,entries:[...o,...i,...h,...m]};return this.device.createBindGroup(g)}updateBinding(t){const{buffer:e}=t,s=this.renderer.get(t).buffer;this.device.queue.writeBuffer(s,0,e,0)}}const en=class en extends Jn{constructor(t={}){super(),this.id=Nn(),this.isMaterial=!0,this.type="Material",this.cullMode="back",this.blending=t.alpha<1?en.BLEND.PREMULTIPLIED:en.BLEND.DEFAULT}get diffuseMap(){return this._diffuseMap}set diffuseMap(t){var e,s;this._diffuseMap=t,(s=(e=this.textures)==null?void 0:e.find(r=>r.name==="diffuseMap"))==null||s.setTexture(t),this.emit("update")}write(t,e=0){this.emit("write",{data:t,offset:e})}};U(en,"BLEND",{DEFAULT:{color:{operation:"add",srcFactor:"one",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"one",dstFactor:"zero"}},PREMULTIPLIED:{color:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"}},UNMULTIPLIED:{color:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha"}},DEST_OVER:{color:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"one"},alpha:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"one"}},SOURCE_IN:{color:{operation:"add",srcFactor:"dst-alpha",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"dst-alpha",dstFactor:"zero"}},DEST_IN:{color:{operation:"add",srcFactor:"zero",dstFactor:"src-alpha"},alpha:{operation:"add",srcFactor:"zero",dstFactor:"src-alpha"}},SOURCE_OUT:{color:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"zero"},alpha:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"zero"}},DEST_OUT:{color:{operation:"add",srcFactor:"zero",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"zero",dstFactor:"one-minus-src-alpha"}},SOURCE_ATOP:{color:{operation:"add",srcFactor:"dst-alpha",dstFactor:"one-minus-src-alpha"},alpha:{operation:"add",srcFactor:"dst-alpha",dstFactor:"one-minus-src-alpha"}},DEST_ATOP:{color:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"src-alpha"},alpha:{operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"src-alpha"}},ADDITIVE:{color:{operation:"add",srcFactor:"one",dstFactor:"one"},alpha:{operation:"add",srcFactor:"one",dstFactor:"one"}}});let Sn=en;class Qo{constructor(t,e){this.device=t,this.renderer=e,this.pipelines=new Map}createShadowPipeline(t,e){const{vertexShader:s,fragmentShader:r}=xe.composeShadow(t.mesh),i={label:"Shadow Depth Pipline",layout:this.device.createPipelineLayout({bindGroupLayouts:[e]}),vertex:{module:this.device.createShaderModule({code:s}),buffers:[t.mesh.geometry.getVertexAttributesLayout()]},primitive:{topology:"triangle-list",cullMode:t.mesh.material.cullMode},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}};return t.mesh.material.diffuseMap&&(i.fragment={module:this.device.createShaderModule({code:r}),targets:[]}),this.shadowDepthPipeline=this.device.createRenderPipeline(i),this.shadowDepthPipeline}createFrustumPipeline(){}createOcclusionPipeline(){}createRenderPipeline(t,e){const s=t.mesh.material,{vertexShader:r,fragmentShader:i}=xe.compose(t.mesh),o=this.device.createPipelineLayout({bindGroupLayouts:[e]}),h={label:`${t.name} Render Pipeline`,layout:o,vertex:{module:this.device.createShaderModule({label:`${t.name} Vertex Module`,code:r}),buffers:[t.mesh.geometry.getVertexAttributesLayout()]},fragment:{module:this.device.createShaderModule({label:`${t.name} Fragment Module`,code:i}),targets:[{format:this.renderer.context.getCurrentTexture().format,blend:Sn.BLEND.SOURCE_ATOP}]},primitive:{topology:"triangle-list",cullMode:s.cullMode},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth32float"}};return this.device.createRenderPipeline(h)}}class Yo{constructor(t){this.renderer=t,this.device=t.device,this._textures={},this._views={},this.createDefaultTexture(),this.createShadowDepthTexture(),this.createDepthTexture(),this.createShadowOffsetTexture(4,3)}createDefaultTexture(){const t=this.device.createTexture({label:"Default Texture",size:[1,1],format:this.renderer.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST}),e=new Uint8Array([255,0,0,255]);this.device.queue.writeTexture({texture:t},e,{bytesPerRow:4},{width:1,height:1}),this._textures.default=t,this._views.default=t.createView({label:"Default Texture"})}writeDepthToTexture(t){this.device.queue.writeTexture({texture:this.shadowTexture},t,{bytesPerRow:4*this.shadowTexture.width},{width:this.shadowTexture.width,height:this.shadowTexture.height})}createShadowOffsetTexture(t,e){const s=e*e,r=t*t*s*2,i=new Float32Array(r);let o=0;for(let m=0;m<t;m++)for(let g=0;g<t;g++)for(let w=e-1;w>=0;w--)for(let M=0;M<e;M++){let S=(M+.5+Pt(-.5,.5))/e,T=(w+.5+Pt(-.5,.5))/e;i[o]=Math.sqrt(T)*Math.cos(2*Math.PI*S),i[o+1]=Math.sqrt(T)*Math.sin(2*Math.PI*S),o+=2}const h=this.device.createTexture({dimension:"3d",size:[t,t,s/2],format:"rgba32float",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});this.device.queue.writeTexture({texture:h},i,{bytesPerRow:4*4*t,rowsPerImage:t},[t,t,s/2]),this._textures.shadowOffset=h,this._views.shadowOffset=h.createView({dimension:"3d"})}createShadowDepthTexture(){const t=this.device.createTexture({size:[1024,1024].map(e=>e*8),format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.COPY_DST});this._textures.shadowMap=t,this._views.shadowMap=t.createView()}createDepthTexture(){this._textures.depth&&this._textures.depth.destroy();const t=this.device.createTexture({label:"Depth Texture",size:[this.renderer.width,this.renderer.height,1],format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});this._textures.depth=t,this._views.depth=t.createView({label:"Depth Texture"})}add(t,e){this._textures[t]=e,this._views[t]=e.createView({label:t})}remove(t){delete this._textures[t],delete this._views[t]}has(t){return this._textures[t]!==void 0}getTexture(t){return this._textures[t]}getView(t){return this._views[t]}}class $o{constructor(t){this.device=t.device,this.samplers={},this.createSampler(),this.createComparison()}createSampler(){const t=this.device.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"linear",addressModeU:"repeat",addressModeV:"repeat",addressModeW:"repeat"});this.samplers.sampler=t}createNearestSampler(){const t=this.device.createSampler({magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",addressModeU:"repeat",addressModeV:"repeat",addressModeW:"repeat"});this.samplers.nearest=t}getSamplerLayout(t){if(t==="texture_2d<f32>")return{viewDimension:"2d"};if(t==="texture_depth_2d")return{type:"comparison"};if(t==="texture_3d<f32>")return{viewDimension:"3d"}}createComparison(){const t=this.device.createSampler({compare:"less"});this.samplers.sampler_comparison=t}add(t,e){this.samplers[t]=e}remove(t){delete this.samplers[t]}has(t){return this.samplers[t]!==void 0}get(t){return this.samplers[t]}}class qo{constructor(t,e){this.device=t,this.renderer=e,this._objects=new Map,this._buffers=new Map,this._data=new Map,this._instanceBuffers=new Map,this.createLightProjectionViewBuffer()}createLightProjectionViewBuffer(){const t=this.device.createBuffer({label:"Light Projection View Buffer",size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this._buffers.set("lightProjViewMatrix",t)}createShadowDepthBuffer(t){const e=this.device.createBuffer({label:"Shadow Depth Buffer",size:t.width*t.height*4,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});this._buffers.set("shadowDepth",e)}createUniformBuffer(t,e){if(e&&this._objects.has(e)&&this._objects.get(e).has(t.name))return this._objects.get(e).get(t.name);if(!e&&this._buffers.has(t.name))return this._buffers.get(t.name);let s;try{s=this.device.createBuffer({label:t.name,size:t.byteSize,usage:GPUBufferUsage[t.bufferType.toUpperCase()]|GPUBufferUsage.COPY_DST})}catch{debugger}return e?(this._objects.has(e)||this._objects.set(e,new Map),this._objects.get(e).set(t.name,s),e.data&&(this.write(s,e.data),this._data.set(s,new Float32Array(e.data))),e.isMaterial&&this.write(s,e.data),t.name==="instances"&&(s.label=e.name,this.write(s,e.instanceMatrix||e.matrixWorld.data),this._data.set(s,new Float32Array(e.instanceMatrix??e.matrixWorld.data)),this._instanceBuffers.set(e,s)),e.on("write",({data:r,name:i,byteOffset:o})=>{var h;this.write((h=this._objects.get(e))==null?void 0:h.get(i),r,o)},this),t.perMesh?this._buffers.set(e,s):this._buffers.set(t.name,s)):(this._buffers.set(t.name,s),t.data&&(this.write(s,t.data),this._data.set(s,new Float32Array(t.data)))),s}write(t,e,s=0){var r;return!t||!e||(typeof t=="string"&&this._buffers.has(t)&&(t=this._buffers.get(t)),!(t instanceof GPUBuffer))||ft(this._data.get(t),e)?!1:(this.device.queue.writeBuffer(t,s,e),(r=this._data.get(t))==null||r.set(e,s/Float32Array.BYTES_PER_ELEMENT),!0)}getBufferData(t){var e;if(t){if(t instanceof GPUBuffer)return this._data.get(t);if(typeof t=="string")return t=this._buffers.get(t),this._data.get(t);if(t.isObject3D)return this._data.get((e=this._objects.get(t))==null?void 0:e.get("model"))}}getBufferDataByObject(t,e){return this._data.get(this._objects.get(t).get(e))}getInstanceBuffer(t){return this._instanceBuffers.get(t)}createBuffer(t,e,s,r){const i=this.device.createBuffer({label:t,size:e,usage:s});return r?(this.device.queue.writeBuffer(i,0,r),this._data.set(i,new Float32Array(r))):this._data.set(i,new Float32Array(e/Float32Array.BYTES_PER_ELEMENT)),this._buffers.set(t,i),i}createIndexBuffer(t,e="Index Buffer"){const s=this.device.createBuffer({label:e,size:t.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});return this.device.queue.writeBuffer(s,0,t),s}createVertexBuffer(t,e="Vertex Buffer"){const s=this.device.createBuffer({label:e,size:t.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});return this.device.queue.writeBuffer(s,0,t),s}has(t){return this._buffers.has(t)}get(t,e){var s;if(typeof t=="string")return this._buffers.get(t);if(t.isObject3D&&e)return(s=this._objects.get(t))==null?void 0:s.get(e);if(t.isObject3D)return this._objects.get(t)}delete(t){this._buffers.delete(t)}clear(){this._buffers.clear()}}class Zo{constructor(t){this.mesh=t,this.name=t.name,this.buffers={vertex:null,index:null},this.render={layout:null,pipeline:null,bindGroup:null},this.shadow={layout:null,pipeline:null,bindGroup:null}}setModelBuffer(t){this.buffers.model=t}setVertexBuffer(t){this.buffers.vertex=t}setIndexBuffer(t){this.buffers.index=t}setUniformBuffer(t,e){this.buffers[t]=e}setModelBuffer(t){this.buffers.model=t}setRenderPipeline(t,e){return this.render.pipeline=t,this.render.layout=e,this}setShadowPipeline(t,e){return this.shadow.pipeline=t,this.shadow.layout=e,this}setRenderBindGroup(t){return this.render.bindGroup=t,this}setShadowBindGroup(t){return this.shadow.bindGroup=t,this}}new L;new Ce;class ta{constructor(t,e,s=!1){this.array=t,this.isBufferAttribute=!0,this.itemSize=e,this.normalized=s===!0,this.version=0}get count(){return this.array.length/this.itemSize}set needsUpdate(t){t===!0&&this.version++,this._needsUpdate=t}get needsUpdate(){return this._needsUpdate}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXYZW(t,e,s,r,i){const o=t*this.itemSize;return this.array[o]=e,this.array[o+1]=s,this.array[o+2]=r,this.array[o+3]=i,this}getComponent(t,e){return this.array[t*this.itemSize+e]}setComponent(t,e,s){return this.array[t*this.itemSize+e]=s,this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){return this.array[t*this.itemSize+e]}setComponent(t,e,s){this.array[t*this.itemSize+e]=s}copyArray(t){return this.array.set(t),this}}function ea(n,t){const e=n instanceof Float32Array?"f":"i";if(t===1)return e+"32";if(t===2)return"vec2"+e;if(t===3)return"vec3"+e;if(t===4)return"vec4"+e;if(t===9)return"mat3x3"+e;if(t===16)return"mat4x4"+e}class Qe extends ta{constructor(t,e,s){super(new Float32Array(t),e,s),this.format="float32x"+e,this.type=ea(this.array,e)}}const Zn=new L;class ri{constructor(t=new L(-1/0,-1/0,-1/0),e=new L(1/0,1/0,1/0)){this.min=t,this.max=e}get center(){return this.min.clone().add(this.max).multiplyScalar(.5)}get size(){return this.max.clone().sub(this.min)}setFromCenterAndSize(t,e){const s=Zn.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}intersects(t){return this.min.x<=t.max.x&&this.max.x>=t.min.x&&this.min.y<=t.max.y&&this.max.y>=t.min.y&&this.min.z<=t.max.z&&this.max.z>=t.min.z}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Zn),Zn.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}getSize(t){return t.copy(this.max).sub(this.min)}randomPoint(t){return t.set(Pt(this.min.x,this.max.x),Pt(this.min.y,this.max.y),Pt(this.min.z,this.max.z)),t}makeEmpty(){return this.min.set(1/0,1/0,1/0),this.max.set(-1/0,-1/0,-1/0),this}expandByPoint(t){return this.min.min(t),this.max.max(t),this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t=new L){return t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(){return this.isEmpty()?new L:this.max.clone().sub(this.min)}setFromAttribute(t){const e=t.array,s=t.itemSize,r=e.length/s,i=this.min,o=this.max;i.set(1/0,1/0,1/0),o.set(-1/0,-1/0,-1/0);for(let h=0;h<r;h++){const m=e[h*s+0],g=e[h*s+1],w=e[h*s+2];i.min(m,g,w),o.max(m,g,w)}return this}}new L;new ri;class ii{constructor(){this.id=Nn(),this.positions=[],this.normals=[],this.indices=[],this.uvs=[],this.joints=[],this.weights=[],this.packed=[],this.isGeometry=!0,this.index=null,this.attributes={},this.boundingBox=null,this.boundingSphere=null,this.isInstancedGeometry=!1,this.attributes={},this.isIndexed=!1}setAttribute(t,e){return this.attributes[t]=e,this}getAttribute(t){return this.attributes[t]}getIndices(){return this.indices}rotateY(t){const e=this.attributes.position.array;for(let s=0;s<e.length;s+=3){const r=e[s],i=e[s+2];e[s]=r*Math.cos(t)+i*Math.sin(t),e[s+2]=i*Math.cos(t)-r*Math.sin(t)}return this}getVertexAttributesLayout(){if(this.vertexAttributesLayout)return this.vertexAttributesLayout;this.vertexAttributesLayout={arrayStride:0,attributes:[]};let t=0,e=0;for(let s in this.attributes){const r=this.attributes[s],i=r.itemSize;this.vertexAttributesLayout.arrayStride+=i*r.array.BYTES_PER_ELEMENT,this.vertexAttributesLayout.attributes.push({name:s,shaderLocation:e,offset:t,format:r.format}),e++,t+=i*r.array.BYTES_PER_ELEMENT}return this.vertexAttributesLayout}get vertexCount(){return this.attributes.position.array.length/3}setIndices(t){return t instanceof Uint32Array?(this.indices=t,this.isIndexed=!0,this.indexFormat="uint32"):t instanceof Uint16Array?(this.indices=t,this.isIndexed=!0,this.indexFormat="uint16"):t instanceof Uint8Array?(this.indices=t,this.isIndexed=!0,this.indexFormat="uint8"):t instanceof Array&&(this.indices=new Uint16Array(t),this.isIndexed=!0,this.indexFormat="uint16"),this}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ss);const t=this.attributes.position,e=t.array;if(!t)return console.error("Geometry has no position attribute."),this;const s=[0,0,0],r=e.length/3;for(let o=0;o<e.length;o+=3)s[0]+=t.array[o],s[1]+=t.array[o+1],s[2]+=t.array[o+2];s[0]/=r,s[1]/=r,s[2]/=r;let i=0;for(let o=0;o<r;o++){const h=e[o*3]-s[0],m=e[o*3+1]-s[1],g=e[o*3+2]-s[2],w=h*h+m*m+g*g;w>i&&(i=w)}return this.boundingSphere.center.set(s[0],s[1],s[2]),this.boundingSphere.radius=Math.sqrt(i),this}deleteAttribute(t){return delete this.attributes[t],this}computeVertexNormals(){this.index}getAttributes(){}setFromArrays(t,e,s,r,i,o){const h=e.length/3;let m=0;e&&(m+=3),s&&(m+=3),r&&(m+=2),i&&(m+=4),o&&(m+=4);const g=h*m;this.positions=e,this.normals=s,this.uvs=r,this.indices=t,this.joints=i,this.weights=o,this.packed=new Float32Array(g);for(let w=0;w<h;w++){const M=w*3,S=w*3,T=w*2,P=w*4,H=w*4,N=w*m;e&&(this.packed[N+0]=e[M+0],this.packed[N+1]=e[M+1],this.packed[N+2]=e[M+2]),s&&(this.packed[N+3]=s[S+0],this.packed[N+4]=s[S+1],this.packed[N+5]=s[S+2]),r&&(this.packed[N+6]=r[T+0],this.packed[N+7]=r[T+1]),i&&(this.packed[N+8]=i[P+0],this.packed[N+9]=i[P+1],this.packed[N+10]=i[P+2],this.packed[N+11]=i[P+3]),o&&(this.packed[N+12]=o[H+0],this.packed[N+13]=o[H+1],this.packed[N+14]=o[H+2],this.packed[N+15]=o[H+3])}e&&this.setAttribute("position",new Qe(e,3)),s&&this.setAttribute("normal",new Qe(s,3)),r&&this.setAttribute("uv",new Qe(r,2)),i&&this.setAttribute("joints",new Qe(i,4)),o&&this.setAttribute("weights",new Qe(o,4)),t&&this.setIndices(t),this.computeBoundingBox(),this.computeBoundingSphere(),this.attributes}get vertexBufferSize(){return Object.values(this.attributes).reduce((t,e)=>t+e.array.length*e.array.BYTES_PER_ELEMENT,0)}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ri);const t=this.attributes.position;t&&this.boundingBox.setFromAttribute(t),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('Geometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}setAttribute(t,e){return this.attributes[t]=e,this}getAttribute(t){return this.attributes[t]}getAttributes(){return Object.values(this.attributes)}}class cr{constructor(t,e,s=X.RENDER|X.SHADOW,r=GPUShaderStage.FRAGMENT){this.name=t,this.type=e,this.use=s,this.visibility=r,this.layout=this.getLayoutByType(e)}getLayoutByType(t){if(t==="sampler")return{};if(t==="sampler_comparison")return{type:"comparison"}}getBindGroupString(t=0,e=0){return`
@group(${t}) @binding(${e}) var ${this.name}: ${this.type};`}get useRender(){return this.use&X.RENDER}get useShadow(){return this.use&X.SHADOW}get useCompute(){return this.use&X.COMPUTE}}const nn=class nn extends Sn{constructor(t={}){super(t),this.isPhongMaterial=!0,this.type="MeshPhongMaterial",this._diffuseMap=t.diffuseMap,this._normalMap=t.normalMap,this._emissionMap=t.emissionMap,this._heightMap=t.heightMap,this._color=t.color instanceof Qt?t.color:new Qt(t.color||16777215),this._specularColor=t.specularColor instanceof Qt?t.specularColor:new Qt(t.specularColor||16777215),this._emissionColor=t.emissionColor instanceof Qt?t.emissionColor:new Qt(t.emissionColor||0),this._emissionIntensity=t.emissionIntensity||0,this._shininess=t.shininess||0,this._useFog=t.useFog!==void 0?Number(t.useFog):1,this._useLighting=t.useLighting!==void 0?Number(t.useLighting):1,this._useWind=t.useWind||0,this._ambientIntensity=t.ambientIntensity||1,this._alpha=t.alpha||1,this._windStrength=t.windStrength||15,this._windDirection=t.windDirection||new L(1,0,0,0),this._windSpeed=t.windSpeed||.5,this._windHeight=t.windHeight||20,this._alphaTest=t.alphaTest||.5,this._diffuseMapScale=t.diffuseMapScale||new Ce(1,1),this._normalMapScale=t.normalMapScale||new Ce(1,1),this._diffuseMapOffset=t.diffuseMapOffset||new Ce(0,0),this._normalMapOffset=t.normalMapOffset||new Ce(0,0),this._color.onChange(()=>{this._data.set(this._color.data,0)}),this._specularColor.onChange(()=>{this._data.set(this._specularColor.data,4)}),this._emissionColor.onChange(()=>{this._data.set(this._emissionColor.data,8)}),this.uniforms=[Nt.instances(),Nt.camera,Nt.scene,Nt.time,Nt.lightProjViewMatrix,new ae({name:"material",bindGroup:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,isMaterial:!0,uniforms:[new At("material").struct("Material",nn.struct)]})],this.textures=[new He("shadowOffset","texture_3d<f32>",null,X.RENDER),new He("shadowMap","texture_depth_2d",null,X.RENDER),new He("diffuseMap","texture_2d<f32>",this._diffuseMap,X.RENDER|X.SHADOW),new He("normalMap","texture_2d<f32>",this._normalMap,X.RENDER)],this.samplers=[new cr("sampler2D","sampler",X.RENDER|X.SHADOW),new cr("samplerComparison","sampler_comparison",X.RENDER)],this.chunks={vertex:[{mesh:ut.vertex.model_instanced,instanced_mesh:ut.vertex.model_instanced,skinned_mesh:ut.vertex.model_skinned},ut.vertex.projection_camera,ut.vertex.projection_shadow,ut.vertex.uv,ut.vertex.wind,ut.vertex.position,ut.vertex.fog],fragment:[ut.fragment.normal_map,ut.fragment.diffuse_map,ut.fragment.shadowmap,ut.fragment.light_phong,ut.fragment.emission,ut.fragment.fog]},this.offsets={},this.byteOffsets={};let e=0;Object.entries(nn.struct).forEach(([s,r],i)=>{this.offsets[s]=e,this.byteOffsets[s]=e*Float32Array.BYTES_PER_ELEMENT,e+=si[r]}),this._data=new Float32Array([this._color.r,this._color.g,this._color.b,this._color.a,this._specularColor.r,this._specularColor.g,this._specularColor.b,this._specularColor.a,this._emissionColor.r,this._emissionColor.g,this._emissionColor.b,this._emissionColor.a,this._windDirection.x,this._windDirection.y,this._windDirection.z,0,this._emissionIntensity,this._ambientIntensity,this._shininess,this._alpha,this._useFog,this._useLighting,this._useWind,this._windStrength,this._windSpeed,this._windHeight,this._alphaTest,this._diffuseMapScale.x,this._diffuseMapScale.y,this._normalMapScale.x,this._normalMapScale.y,this._diffuseMapOffset.x,this._diffuseMapOffset.y,this._normalMapOffset.x,this._normalMapOffset.y]),this.write(this._data)}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest=t,this._data[this.offsets.alphaTest]=t,this.write([t],this.byteOffsets.alphaTest)}set windDirection(t){this._windDirection=t,this._data.set(t.data,this.offsets.windDirection),this.write(t.data,this.byteOffsets.windDirection)}get windDirection(){return this._windDirection}get windHeight(){return this._windHeight}set windHeight(t){this._windHeight=t,this._data[this.offsets.windHeight]=t,this.write([t],this.byteOffsets.windHeight)}set windSpeed(t){this._windSpeed=t,this._data[this.offsets.windSpeed]=t,this.write([t],this.byteOffsets.windSpeed)}get windSpeed(){return this._windSpeed}get windStrength(){return this._windStrength}set windStrength(t){this._windStrength=t,this._data[this.offsets.windStrength]=t,this.write([t],this.byteOffsets.windStrength)}get ambientIntensity(){return this._ambientIntensity}set ambientIntensity(t){this._ambientIntensity=t,this._data[this.offsets.ambientIntensity]=t,this.write([t],this.byteOffsets.ambientIntensity)}get alpha(){return this._alpha}set alpha(t){this._alpha=t,this._data[this.offsets.alpha]=t,this.write([t],this.byteOffsets.alpha)}get emissionColor(){return this._emissionColor}set emissionColor(t){this._emissionColor=t,this._data.set(t.data,this.offsets.emissionColor),this.write(t.data,this.byteOffsets.emissionColor)}get emissionIntensity(){return this._emissionIntensity}set emissionIntensity(t){this._emissionIntensity=t,this._data[this.offsets.emissionIntensity]=t,this.needsUpdate=!0,this.write([t],this.byteOffsets.emissionIntensity)}get color(){return this._color}set color(t){this._color=t,this._data.set(t.data,this.byteOffsets.color),this.needsUpdate=!0}get specularColor(){return this._specularColor}set specularColor(t){this._specularColor=t,this._data.set(t.data,this.byteOffsets.specularColor),this.needsUpdate=!0}get shininess(){return this._shininess}set shininess(t){this._shininess=t,this._data[this.offsets.shininess]=t,this.write([t],this.byteOffsets.shininess)}set useFog(t){this._useFog=t,this._data[this.offsets.useFog]=t,this.write([t],this.byteOffsets.useFog)}get useFog(){return this._useFog}get useWind(){return this._useWind}set useWind(t){this._useWind=t?1:0,this._data[this.offsets.useWind]=this._useWind,this.write([this._useWind],this.byteOffsets.useWind)}get data(){return this._data}};U(nn,"struct",{color:"vec4f",specularColor:"vec4f",emissionColor:"vec4f",windDirection:"vec4f",emissionIntensity:"f32",ambientIntensity:"f32",shininess:"f32",alpha:"f32",useFog:"f32",useLighting:"f32",useWind:"f32",windStrength:"f32",windSpeed:"f32",windHeight:"f32",alphaTest:"f32",diffuseMapScale:"vec2f",normalMapScale:"vec2f",diffuseMapOffset:"vec2f",normalMapOffset:"vec2f"});let sn=nn;new L;new L;new L;class Vn extends de{constructor(t,e){super(),this.id=Nn(),this.geomatID=`${t.id}_${e.id}`,this.isMesh=!0,this.type="mesh",this.count=1,this.isCulled=!0,this.geometry=t,this.material=e}initializeSpatialGrid(t){this.gridSize=t;const e=this.geometry.positions,s=new Float32Array(e.length);let r=1/0,i=-1/0,o=1/0,h=-1/0;for(let g=0;g<e.length;g+=3){const w=new L(e[g],e[g+1],e[g+2]),M=this.matrixWorld.transformPoint(w);s[g]=M.x,s[g+1]=M.y,s[g+2]=M.z,r=Math.min(r,M.x),i=Math.max(i,M.x),o=Math.min(o,M.z),h=Math.max(h,M.z)}this.bounds={minX:r,maxX:i,minZ:o,maxZ:h},this.cellSize={x:(i-r)/this.gridSize,z:(h-o)/this.gridSize},this.grid=new Array(this.gridSize*this.gridSize);for(let g=0;g<this.grid.length;g++)this.grid[g]=[];const m=this.geometry.indices;for(let g=0;g<m.length;g+=3){const w=m[g]*3,M=m[g+1]*3,S=m[g+2]*3,T={v1:new L(s[w],s[w+1],s[w+2]),v2:new L(s[M],s[M+1],s[M+2]),v3:new L(s[S],s[S+1],s[S+2])};this.getOverlappingCells(T).forEach(H=>{this.grid[H].push(T)})}}getOverlappingCells(t){const e=Math.min(t.v1.x,t.v2.x,t.v3.x),s=Math.max(t.v1.x,t.v2.x,t.v3.x),r=Math.min(t.v1.z,t.v2.z,t.v3.z),i=Math.max(t.v1.z,t.v2.z,t.v3.z),o=this.worldToCell(e,r),h=this.worldToCell(s,i),m=new Set;for(let g=o.x;g<=h.x;g++)for(let w=o.z;w<=h.z;w++)g>=0&&g<this.gridSize&&w>=0&&w<this.gridSize&&m.add(g+w*this.gridSize);return m}worldToCell(t,e){const s=Math.floor((t-this.bounds.minX)/this.cellSize.x),r=Math.floor((e-this.bounds.minZ)/this.cellSize.z);return{x:s,z:r}}getHeightAt(t,e){if(t<this.bounds.minX||t>this.bounds.maxX||e<this.bounds.minZ||e>this.bounds.maxZ)return 0;const s=this.worldToCell(t,e),r=s.x+s.z*this.gridSize;if(r<0||r>=this.grid.length)return 0;const i=new L(t,1e3,e),o=new L(0,-1,0);let h=1/0,m=!1;const g=this.grid[r];for(const w of g)if(this.pointInTriangle(t,e,w.v1.x,w.v1.z,w.v2.x,w.v2.z,w.v3.x,w.v3.z)){const M=this.rayTriangleIntersection(i,o,w.v1,w.v2,w.v3);M&&M.t<h&&(h=M.t,m=!0)}return m?i.y+o.y*h:0}pointInTriangle(t,e,s,r,i,o,h,m){const g=(o-m)*(s-h)+(h-i)*(r-m),w=((o-m)*(t-h)+(h-i)*(e-m))/g,M=((m-r)*(t-h)+(s-h)*(e-m))/g,S=1-w-M;return 0<=w&&w<=1&&0<=M&&M<=1&&0<=S&&S<=1}rayTriangleIntersection(t,e,s,r,i){const h=r.clone().sub(s),m=i.clone().sub(s),g=e.clone().cross(m),w=h.dot(g);if(w>-1e-6&&w<1e-6)return null;const M=1/w,S=t.clone().sub(s),T=M*S.dot(g);if(T<0||T>1)return null;const P=S.cross(h),H=M*e.dot(P);if(H<0||T+H>1)return null;const N=M*m.dot(P);return N>1e-6?{t:N,u:T,v:H}:null}}Vn.geomats=new Map;const hr=new W,nt=new L;class na{constructor(t,e,s,r,i){var g;const o=e.isInstancedMesh?e.count:1;this.cullingInstanceBuffer=t.device.createBuffer({label:"Culling Instance Buffer",size:o*64,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.visibleInstancesBuffer=t.buffers.getInstanceBuffer(e),this.drawCommandBuffer=t.device.createBuffer({label:"Draw Command Buffer",size:5*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_DST,mappedAtCreation:!0}),this.boundingSphereBuffer=t.device.createBuffer({label:"Bounding Sphere Buffer",size:4*4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const h=e.instanceMatrix||e.matrixWorld.data,m=e.geometry.boundingSphere.data;t.device.queue.writeBuffer(this.cullingInstanceBuffer,0,h),t.device.queue.writeBuffer(this.boundingSphereBuffer,0,m),e.on("write",()=>{t.device.queue.writeBuffer(this.cullingInstanceBuffer,0,e.instanceMatrix||e.matrixWorld.data)}),new Uint32Array(this.drawCommandBuffer.getMappedRange()).set([((g=e.geometry.indices)==null?void 0:g.length)||e.geometry.vertexCount,e.count,0,0,0]),this.drawCommandBuffer.unmap(),this.bindGroup=t.device.createBindGroup({layout:s.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:i}},{binding:1,resource:{buffer:this.boundingSphereBuffer}},{binding:2,resource:{buffer:this.cullingInstanceBuffer}},{binding:3,resource:r},{binding:4,resource:{buffer:this.drawCommandBuffer}},{binding:5,resource:{buffer:this.visibleInstancesBuffer}}]}),this.instanceCount=o}}class sa{constructor(t){U(this,"renderer");U(this,"device");U(this,"frustumPipeline");U(this,"occlusionPipeline");U(this,"visiblityBuffer");U(this,"drawCommandsBuffer");this.renderer=t,this.device=t.device,this.depthTexture=null,this.setupPipelines(),this.visibilityCache=new Map}updateDepthTexture(t){this.depthTexture=t,this.visibilityCache.clear()}prepare(t,e){if(!this.visibilityCache.has(t)){if(t.isMesh&&t.isCulled){this.renderer.has(t)||this.renderer.createRenderObject(t);const r=new na(this.renderer,t,this.cullingPipeline,e,this.cameraBuffer);this.visibilityCache.set(t,r),t.visibilityInfo=r}if(t.children)for(const r of t.children)this.prepare(r,e)}}setupPipelines(){this.cullingPipeline=this.device.createComputePipeline({layout:"auto",compute:{module:this.device.createShaderModule({code:ut.compute.culling.code}),entryPoint:"main"}}),this.setupBuffers()}compute(t,e,s){const r=this.buildFrustum(e.projectionMatrix,e.viewMatrix,new Float32Array(24));this.device.queue.writeBuffer(this.cameraBuffer,0,e.projectionViewMatrix.data),this.device.queue.writeBuffer(this.cameraBuffer,64,r),this.device.queue.writeBuffer(this.cameraBuffer,64+4*6*4,e.position.data);for(const i of t.children)this.processSceneNode(s,i,e)}processSceneNode(t,e,s){if(e.isMesh&&this.processMesh(t,e,e.worldMatrix,s),e.children)for(const r of e.children)this.processSceneNode(t,r,s)}setupBuffers(){this.cameraBuffer=this.device.createBuffer({label:"Camera Culling Buffer",size:176,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})}buildFrustum(t,e,s){hr.multiplyMatrices(t,e);const r=hr.data;nt.set(r[3]+r[0],r[7]+r[4],r[11]+r[8]);let i=nt.length();return s[0]=nt.x/i,s[1]=nt.y/i,s[2]=nt.z/i,s[3]=(r[15]+r[12])/i,nt.set(r[3]-r[0],r[7]-r[4],r[11]-r[8]),i=nt.length(),s[4]=nt.x/i,s[5]=nt.y/i,s[6]=nt.z/i,s[7]=(r[15]-r[12])/i,nt.set(r[3]-r[1],r[7]-r[5],r[11]-r[9]),i=nt.length(),s[8]=nt.x/i,s[9]=nt.y/i,s[10]=nt.z/i,s[11]=(r[15]-r[13])/i,nt.set(r[3]+r[1],r[7]+r[5],r[11]+r[9]),i=nt.length(),s[12]=nt.x/i,s[13]=nt.y/i,s[14]=nt.z/i,s[15]=(r[15]+r[13])/i,nt.set(r[2],r[6],r[10]),i=nt.length(),s[16]=nt.x/i,s[17]=nt.y/i,s[18]=nt.z/i,s[19]=r[14]/i,nt.set(r[3]-r[2],r[7]-r[6],r[11]-r[10]),i=nt.length(),s[20]=nt.x/i,s[21]=nt.y/i,s[22]=nt.z/i,s[23]=(r[15]-r[14])/i,s}processMesh(t,e,s,r,i){let o=this.visibilityCache.get(e);if(!o)return;this.device.queue.writeBuffer(o.drawCommandBuffer,4,new Uint32Array([0]));const h=t.beginComputePass();h.setPipeline(this.cullingPipeline),h.setBindGroup(0,o.bindGroup),h.dispatchWorkgroups(Math.ceil(o.instanceCount/64)),h.end()}}new W;class ra extends Jn{constructor(t){super(),t?this.canvas=t:(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas))}async init(){if(!navigator.gpu){console.error("WebGPU is not supported on this device");return}const t=await navigator.gpu.requestAdapter();if(!t){console.error("WebGPU adapter not found");return}if(this.device=await t.requestDevice(),!this.device){console.error("WebGPU device not found");return}this.count=0,this.data=new WeakMap,this.format=navigator.gpu.getPreferredCanvasFormat(),this.context=this.canvas.getContext("webgpu"),this.frames=0,this.elapsed=0,this._lastTime=performance.now(),this.context.configure({device:this.device,format:this.format,alphaMode:"premultiplied"}),this.shadowNeedsUpdate=!0,this.width=this.canvas.width,this.height=this.canvas.height,this.aspect=this.width/this.height,this.textures=new Yo(this),this.samplers=new $o(this),this.createRenderPassDescriptor(),this.bindGroups=new Xo(this.device,this),this.pipelines=new Qo(this.device,this),this.buffers=new qo(this.device,this),this.buffers.createShadowDepthBuffer(this.textures.getTexture("shadowMap")),this.cullingSystem=new sa(this),new ResizeObserver(s=>{for(const r of s){const{inlineSize:i,blockSize:o}=r.contentBoxSize[0];r.target.width=i*Math.min(window.devicePixelRatio,2),r.target.height=o*Math.min(window.devicePixelRatio,2),r.target.width=Math.max(1,Math.min(r.target.width,this.device.limits.maxTextureDimension2D)),r.target.height=Math.max(1,Math.min(r.target.height,this.device.limits.maxTextureDimension2D)),this.width=r.target.width,this.height=r.target.height,this.aspect=this.width/this.height,this.broadcast("resize",{width:this.width,height:this.height,aspect:this.aspect})}this.textures.createDepthTexture(),this.cullingSystem.updateDepthTexture(this.textures.getView("depth")),this.createRenderPassDescriptor()}).observe(this.canvas),this.initialized=!0}createSamplers(){this.samplers={sampler_comparison:this.device.createSampler({compare:"less"}),sampler:this.device.createSampler({magFilter:"linear",minFilter:"linear"})}}createRenderPassDescriptor(){this.renderPassDescriptor={colorAttachments:[{view:null,clearValue:[.4,.5,.5,1],loadOp:"clear",storeOp:"store"}],depthStencilAttachment:{view:this.textures.getView("depth"),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}}}createDepthTexture(){this.depthTexture&&this.depthTexture.destroy(),this.depthTexture=this.device.createTexture({size:[this.width,this.height],format:"depth32float",usage:GPUTextureUsage.RENDER_ATTACHMENT}),this.depthTextureView=this.depthTexture.createView({label:"Depth Texture View"}),this.textures.depth=this.depthTextureView}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}set(t,e){this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}setSize(t,e){this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e}createRenderObject(t){const e=new Zo(t),s=this.bindGroups.createRenderBindGroupLayout(e),r=this.bindGroups.createShadowBindGroupLayout(e),i=this.bindGroups.createRenderBindGroup(e,s),o=this.bindGroups.createShadowBindGroup(e,r),h=this.buffers.createVertexBuffer(t.geometry.packed),m=this.buffers.createIndexBuffer(t.geometry.indices);e.setVertexBuffer(h),e.setIndexBuffer(m);const g=this.pipelines.createShadowPipeline(e,r),w=this.pipelines.createRenderPipeline(e,s);return e.setShadowPipeline(g,r),e.setRenderPipeline(w,s),e.setRenderBindGroup(i),e.setShadowBindGroup(o),t.material.on("update",()=>{e.setRenderBindGroup(this.bindGroups.createRenderBindGroup(e,s)),e.setShadowBindGroup(this.bindGroups.createShadowBindGroup(e,r)),e.setRenderPipeline(this.pipelines.createRenderPipeline(e,s)),e.setShadowPipeline(this.pipelines.createShadowPipeline(e,r))}),this.set(t,e),e}drawObject(t,e,s,r){if(t.isMesh){const o=this.has(t)?this.get(t):this.createRenderObject(t);s.setPipeline(o.render.pipeline),s.setBindGroup(0,o.render.bindGroup),s.setVertexBuffer(0,o.buffers.vertex),s.setIndexBuffer(o.buffers.index,t.geometry.indexFormat);const h=t.count;this.count+=h,t.geometry.isIndexed?t.isCulled&&t.visibilityInfo?s.drawIndexedIndirect(t.visibilityInfo.drawCommandBuffer,0):s.drawIndexed(t.geometry.indices.length,h):t.isCulled&&t.visibilityInfo?s.drawIndirect(t.drawCommandBuffer,0):s.draw(t.geometry.positions.length/3,h)}if(t.children.length)for(let i=0;i<t.children.length;i++)this.drawObject(t.children[i],e,s,r)}drawShadowDepth(t,e,s){if(s.length){if(t.isMesh)for(const r of s){const o=this.has(t)?this.get(t):this.createRenderObject(t);this.buffers.write("lightProjViewMatrix",r.shadow.projectionViewMatrix.data),e.setPipeline(o.shadow.pipeline),e.setBindGroup(0,o.shadow.bindGroup),e.setVertexBuffer(0,o.buffers.vertex),e.setIndexBuffer(o.buffers.index,t.geometry.indexFormat),t.geometry.isIndexed?t.isCulled&&t.visibilityInfo?e.drawIndexedIndirect(t.visibilityInfo.drawCommandBuffer,0):e.drawIndexed(t.geometry.indices.length,t.count):t.isCulled&&t.visibilityInfo?e.drawIndirect(t.visibilityInfo.drawCommandBuffer,0):e.draw(t.geometry.positions.length/3,t.count)}if(t.children.length)for(const r of t.children)this.drawShadowDepth(r,e,s)}}render(t,e){const s=(performance.now()-this._lastTime)*.001;this.elapsed+=s,this._lastTime=performance.now(),this.buffers.has(t)||this.buffers.createUniformBuffer(Nt.scene,t),this.buffers.has(e)||this.buffers.createUniformBuffer(Nt.camera,e),this.buffers.write("time",new Float32Array([this.elapsed]));const r=this.device.createCommandEncoder();this.cullingSystem.prepare(t,this.textures.getView("depth")),this.cullingSystem.compute(t,e,r),this.renderPassDescriptor.colorAttachments[0].view=this.context.getCurrentTexture().createView(),this.renderPassDescriptor.colorAttachments[0].clearValue=t.background.data;const i=r.beginRenderPass({colorAttachments:[],depthStencilAttachment:{view:this.textures.getView("shadowMap"),depthLoadOp:"clear",depthClearValue:1,depthStoreOp:"store"}});this.drawShadowDepth(t,i,t.directionalLights),i.end(),this.count=0;const o=r.beginRenderPass(this.renderPassDescriptor);this.drawObject(t,e,o,r),o.end(),this.device.queue.submit([r.finish()]),this.frames++}}class ia extends kn{constructor(t=45,e=1,s=.1,r=1e3){super(),this.isPerspectiveCamera=!0,this.fov=t,this.aspect=e,this.near=s,this.far=r,this.up=new L(0,1,0),this.zoom=1,this.focus=10,this.view=null,this.target=new L,this.updateProjectionMatrix()}updateProjectionMatrix(){this.projectionMatrix.perspective(this.fov*wo,this.aspect,this.near,this.far),this._data.set(this.projectionMatrix.data,0),this.projectionViewMatrix.multiplyMatrices(this.projectionMatrix,this.viewMatrix),this.updateFrustum(),this.emit("write",{data:this.projectionMatrix.data,name:"camera"})}}class oi{constructor({color:t="#ffffff",intensity:e=1}){this.color=new Qt(t),this.intensity=e,this._data=new Float32Array([...this.color.data,this.intensity])}get data(){return this._data}}U(oi,"byteSize",20);class oa extends de{constructor(){super(),this.instances=new Map,this.isScene=!0,this.name="Scene",this.type="scene",this.cameras=[],this.directionalLights=[],this.pointLights=[],this.meshes=[],this.background=new Qt(.7,.82,.95,1),this._needsUpdate=!0,this._fog=new ge({color:this.background,start:300,end:600,density:.01,type:ge.LINEAR}),this._ambientLight=new oi({color:"#ffffff",intensity:.5}),this.uniformGroup=Nt.scene.clone(),this.offsets=this.uniformGroup.offsets,this.byteOffsets=this.uniformGroup.byteOffsets,this._data=new Float32Array(this.uniformGroup.byteSize/Float32Array.BYTES_PER_ELEMENT),this._data.set(this._fog.data,this.offsets.fog),this._data.set(this._ambientLight.data,this.offsets.ambientLight)}get fog(){return this._fog}set fog(t){this._fog=t}get wind(){return this._wind}get needsUpdate(){return this._needsUpdate}set needsUpdate(t){this._needsUpdate=t}add(t){t!=null&&t.isObject3D&&(super.add(t),t.isMesh&&this.meshes.push(t),t.isLight&&(t.isDirectionalLight&&(this.directionalLights.push(t),this.updateDirectionalLight(t),t.on("write",()=>{this.updateDirectionalLight(t)})),t.isPointLight&&this.pointLights.push(t)),t.isCamera&&(this.camera=t))}updateDirectionalLight(t){const e=this.directionalLights.findIndex(s=>s===t);this._data.set(t.data,this.offsets.directionalLights+t.data.length*e),this._data.set(t.shadow.data,this.offsets.directionalLightShadows+t.shadow.data.length*e),this._data.set(t.shadow.projectionViewMatrix.data,this.offsets.directionalLightMatrices+t.shadow.projectionViewMatrix.data.length*e),this._data.set(new Float32Array([this.directionalLights.length]),this.offsets.directionalLightsNum),this.write(this._data,"scene")}remove(t){if(super.remove(t),t.isMesh){const e=this.meshes.indexOf(t);this.meshes.splice(e,1)}if(t.isLight){const e=this.lights.indexOf(t);this.lights.splice(e,1)}t.isCamera&&(this.camera=null)}atmosphericLighting(t){const e=t.direction,s=Math.max(-1,Math.min(1,e.y)),r={r:.1,g:.2,b:.3},i={r:.6,g:.5,b:.6},o={r:.7,g:.8,b:1};let h,m,g;const w=(S,T,P)=>{const H=Math.max(0,Math.min(1,(P-S)/(T-S)));return H*H*(3-2*H)};if(s<-.2){const S=w(-1,-.2,s);h=r.r+(i.r-r.r)*S,m=r.g+(i.g-r.g)*S,g=r.b+(i.b-r.b)*S}else if(s<.2){const S=w(-.2,.2,s);h=i.r+(o.r-i.r)*S,m=i.g+(o.g-i.g)*S,g=i.b+(o.b-i.b)*S}else{const S=w(.2,1,s);h=o.r,m=o.g,g=o.b,h+=(1-h)*.2*S,m+=(1-m)*.1*S,g+=(1-g)*.1*S}const M=Math.exp(-Math.abs(s)*5)*.3;h+=M*.3,m+=M*.2,h=Math.max(0,Math.min(1,h)),m=Math.max(0,Math.min(1,m)),g=Math.max(0,Math.min(1,g)),this.ambientColor.a=we(Math.max(0,t.direction.y),0,.2),this.background.set(h,m,g)}updateData(){let t=0;const e=this.directionalLights[0];e&&this.atmosphericLighting(e),this.uniformGroup.set("directionalLights",this.directionalLights),this.uniformGroup.set("directionalLightsNum",this.directionalLights.length),this.uniformGroup.set("directionalLightMatrices",this.directionalLights.map(s=>s.shadow.projectionViewMatrix)),this.uniformGroup.set("ambientColor",this.ambientColor),this.fog.color=this.background,this.uniformGroup.set("fog",this.fog),this.uniformGroup.uniforms.forEach(s=>{s.bufferOffset=t,this._data.set(s.data,t),t+=s.data.length}),this.needsUpdate=!0}get data(){return this._data}}const aa="4.3.2";async function ai(n,t,e,s){return s._parse(n,t,e,s)}function pe(n,t){if(!n)throw new Error(t||"loader assertion failed.")}const jn=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),ur=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);ur&&parseFloat(ur[1]);const yn=globalThis,Re=globalThis.process||{};function ca(n){var s,r;if(typeof window<"u"&&((s=window.process)==null?void 0:s.type)==="renderer"||typeof process<"u"&&((r=process.versions)!=null&&r.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent;return!!(e&&e.indexOf("Electron")>=0)}function Is(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||ca()}const ci="4.0.7";function ha(n){try{const t=window[n],e="__storage_test__";return t.setItem(e,e),t.removeItem(e),t}catch{return null}}class ua{constructor(t,e,s="sessionStorage"){this.storage=ha(s),this.id=t,this.config=e,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(t){if(Object.assign(this.config,t),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let t={};if(this.storage){const e=this.storage.getItem(this.id);t=e?JSON.parse(e):{}}return Object.assign(this.config,t),this}}function la(n){let t;return n<10?t=`${n.toFixed(2)}ms`:n<100?t=`${n.toFixed(1)}ms`:n<1e3?t=`${n.toFixed(0)}ms`:t=`${(n/1e3).toFixed(2)}s`,t}function fa(n,t=8){const e=Math.max(t-n.length,0);return`${" ".repeat(e)}${n}`}var Tn;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Tn||(Tn={}));const da=10;function lr(n){return typeof n!="string"?n:(n=n.toUpperCase(),Tn[n]||Tn.WHITE)}function pa(n,t,e){return!Is&&typeof n=="string"&&(t&&(n=`\x1B[${lr(t)}m${n}\x1B[39m`),e&&(n=`\x1B[${lr(e)+da}m${n}\x1B[49m`)),n}function Aa(n,t=["constructor"]){const e=Object.getPrototypeOf(n),s=Object.getOwnPropertyNames(e),r=n;for(const i of s){const o=r[i];typeof o=="function"&&(t.find(h=>i===h)||(r[i]=o.bind(n)))}}function vs(n,t){if(!n)throw new Error("Assertion failed")}function Ge(){var t,e,s;let n;if(Is()&&yn.performance)n=(e=(t=yn==null?void 0:yn.performance)==null?void 0:t.now)==null?void 0:e.call(t);else if("hrtime"in Re){const r=(s=Re==null?void 0:Re.hrtime)==null?void 0:s.call(Re);n=r[0]*1e3+r[1]/1e6}else n=Date.now();return n}const Oe={debug:Is()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},ma={enabled:!0,level:0};function Pe(){}const fr={},dr={once:!0};class Rs{constructor({id:t}={id:""}){this.VERSION=ci,this._startTs=Ge(),this._deltaTs=Ge(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=t,this.userData={},this._storage=new ua(`__probe-${this.id}__`,ma),this.timeStamp(`${this.id} started`),Aa(this),Object.seal(this)}set level(t){this.setLevel(t)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ge()-this._startTs).toPrecision(10))}getDelta(){return Number((Ge()-this._deltaTs).toPrecision(10))}set priority(t){this.level=t}get priority(){return this.level}getPriority(){return this.level}enable(t=!0){return this._storage.setConfiguration({enabled:t}),this}setLevel(t){return this._storage.setConfiguration({level:t}),this}get(t){return this._storage.config[t]}set(t,e){this._storage.setConfiguration({[t]:e})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(t,e){if(!t)throw new Error(e||"Assertion failed")}warn(t){return this._getLogFunction(0,t,Oe.warn,arguments,dr)}error(t){return this._getLogFunction(0,t,Oe.error,arguments)}deprecated(t,e){return this.warn(`\`${t}\` is deprecated and will be removed in a later version. Use \`${e}\` instead`)}removed(t,e){return this.error(`\`${t}\` has been removed. Use \`${e}\` instead`)}probe(t,e){return this._getLogFunction(t,e,Oe.log,arguments,{time:!0,once:!0})}log(t,e){return this._getLogFunction(t,e,Oe.debug,arguments)}info(t,e){return this._getLogFunction(t,e,console.info,arguments)}once(t,e){return this._getLogFunction(t,e,Oe.debug||Oe.info,arguments,dr)}table(t,e,s){return e?this._getLogFunction(t,e,console.table||Pe,s&&[s],{tag:Ba(e)}):Pe}time(t,e){return this._getLogFunction(t,e,console.time?console.time:console.info)}timeEnd(t,e){return this._getLogFunction(t,e,console.timeEnd?console.timeEnd:console.info)}timeStamp(t,e){return this._getLogFunction(t,e,console.timeStamp||Pe)}group(t,e,s={collapsed:!1}){const r=pr({logLevel:t,message:e,opts:s}),{collapsed:i}=s;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}groupCollapsed(t,e,s={}){return this.group(t,e,Object.assign({},s,{collapsed:!0}))}groupEnd(t){return this._getLogFunction(t,"",console.groupEnd||Pe)}withGroup(t,e,s){this.group(t,e)();try{s()}finally{this.groupEnd(t)()}}trace(){console.trace&&console.trace()}_shouldLog(t){return this.isEnabled()&&this.getLevel()>=hi(t)}_getLogFunction(t,e,s,r,i){if(this._shouldLog(t)){i=pr({logLevel:t,message:e,args:r,opts:i}),s=s||i.method,vs(s),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=Ge();const o=i.tag||i.message;if(i.once&&o)if(!fr[o])fr[o]=Ge();else return Pe;return e=ga(this.id,i.message,i),s.bind(console,e,...i.args)}return Pe}}Rs.VERSION=ci;function hi(n){if(!n)return 0;let t;switch(typeof n){case"number":t=n;break;case"object":t=n.logLevel||n.priority||0;break;default:return 0}return vs(Number.isFinite(t)&&t>=0),t}function pr(n){const{logLevel:t,message:e}=n;n.logLevel=hi(t);const s=n.args?Array.from(n.args):[];for(;s.length&&s.shift()!==e;);switch(typeof t){case"string":case"function":e!==void 0&&s.unshift(e),n.message=t;break;case"object":Object.assign(n,t);break}typeof n.message=="function"&&(n.message=n.message());const r=typeof n.message;return vs(r==="string"||r==="object"),Object.assign(n,{args:s},n.opts)}function ga(n,t,e){if(typeof t=="string"){const s=e.time?fa(la(e.total)):"";t=e.time?`${n}: ${s}  ${t}`:`${n}: ${t}`,t=pa(t,e.color,e.background)}return t}function Ba(n){for(const t in n)for(const e in n[t])return e||"untitled";return"empty"}const ts="4.3.2",ya=ts[0]>="0"&&ts[0]<="9"?`v${ts}`:"";function wa(){const n=new Rs({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=ya,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const ba=wa();function Ca(n,t){return ui(n||{},t)}function ui(n,t,e=0){if(e>3)return t;const s={...n};for(const[r,i]of Object.entries(t))i&&typeof i=="object"&&!Array.isArray(i)?s[r]=ui(s[r]||{},t[r],e+1):s[r]=t[r];return s}function xa(n){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,n)}function Ma(n){var e,s;return((s=(e=globalThis.loaders)==null?void 0:e.modules)==null?void 0:s[n])||null}const _a="latest";function Ea(){var n;return(n=globalThis._loadersgl_)!=null&&n.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version}const li=Ea();function Ae(n,t){if(!n)throw new Error(t||"loaders.gl assertion failed.")}const Zt=typeof process!="object"||String(process)!=="[object process]"||process.browser,Gs=typeof importScripts=="function",Da=typeof window<"u"&&typeof window.orientation<"u",Ar=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Ar&&parseFloat(Ar[1]);class Sa{constructor(t,e){U(this,"name");U(this,"workerThread");U(this,"isRunning",!0);U(this,"result");U(this,"_resolve",()=>{});U(this,"_reject",()=>{});this.name=t,this.workerThread=e,this.result=new Promise((s,r)=>{this._resolve=s,this._reject=r})}postMessage(t,e){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:e})}done(t){Ae(this.isRunning),this.isRunning=!1,this._resolve(t)}error(t){Ae(this.isRunning),this.isRunning=!1,this._reject(t)}}class es{terminate(){}}const ns=new Map;function Ta(n){Ae(n.source&&!n.url||!n.source&&n.url);let t=ns.get(n.source||n.url);return t||(n.url&&(t=Fa(n.url),ns.set(n.url,t)),n.source&&(t=fi(n.source),ns.set(n.source,t))),Ae(t),t}function Fa(n){if(!n.startsWith("http"))return n;const t=Ia(n);return fi(t)}function fi(n){const t=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(t)}function Ia(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function di(n,t=!0,e){const s=e||new Set;if(n){if(mr(n))s.add(n);else if(mr(n.buffer))s.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(t&&typeof n=="object")for(const r in n)di(n[r],t,s)}}return e===void 0?Array.from(s):[]}function mr(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const ss=()=>{};class Bs{constructor(t){U(this,"name");U(this,"source");U(this,"url");U(this,"terminated",!1);U(this,"worker");U(this,"onMessage");U(this,"onError");U(this,"_loadableURL","");const{name:e,source:s,url:r}=t;Ae(s||r),this.name=e,this.source=s,this.url=r,this.onMessage=ss,this.onError=i=>console.log(i),this.worker=Zt?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Zt||typeof es<"u"&&!Zt}destroy(){this.onMessage=ss,this.onError=ss,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(t,e){e=e||di(t),this.worker.postMessage(t,e)}_getErrorFromErrorEvent(t){let e="Failed to load ";return e+=`worker ${this.name} from ${this.url}. `,t.message&&(e+=`${t.message} in `),t.lineno&&(e+=`:${t.lineno}:${t.colno}`),new Error(e)}_createBrowserWorker(){this._loadableURL=Ta({source:this.source,url:this.url});const t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},t.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},t.onmessageerror=e=>console.error(e),t}_createNodeWorker(){let t;if(this.url){const s=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;t=new es(s,{eval:!1})}else if(this.source)t=new es(this.source,{eval:!0});else throw new Error("no worker");return t.on("message",e=>{this.onMessage(e)}),t.on("error",e=>{this.onError(e)}),t.on("exit",e=>{}),t}}class va{constructor(t){U(this,"name","unnamed");U(this,"source");U(this,"url");U(this,"maxConcurrency",1);U(this,"maxMobileConcurrency",1);U(this,"onDebug",()=>{});U(this,"reuseWorkers",!0);U(this,"props",{});U(this,"jobQueue",[]);U(this,"idleQueue",[]);U(this,"count",0);U(this,"isDestroyed",!1);this.source=t.source,this.url=t.url,this.setProps(t)}static isSupported(){return Bs.isSupported()}destroy(){this.idleQueue.forEach(t=>t.destroy()),this.isDestroyed=!0}setProps(t){this.props={...this.props,...t},t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}async startJob(t,e=(r,i,o)=>r.done(o),s=(r,i)=>r.error(i)){const r=new Promise(i=>(this.jobQueue.push({name:t,onMessage:e,onError:s,onStart:i}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;const t=this._getAvailableWorker();if(!t)return;const e=this.jobQueue.shift();if(e){this.onDebug({message:"Starting job",name:e.name,workerThread:t,backlog:this.jobQueue.length});const s=new Sa(e.name,t);t.onMessage=r=>e.onMessage(s,r.type,r.payload),t.onError=r=>e.onError(s,r),e.onStart(s);try{await s.result}catch(r){console.error(`Worker exception: ${r}`)}finally{this.returnWorkerToQueue(t)}}}returnWorkerToQueue(t){!Zt||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const t=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Bs({name:t,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return Da?this.maxMobileConcurrency:this.maxConcurrency}}const Ra={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},me=class me{constructor(t){U(this,"props");U(this,"workerPools",new Map);this.props={...Ra},this.setProps(t),this.workerPools=new Map}static isSupported(){return Bs.isSupported()}static getWorkerFarm(t={}){return me._workerFarm=me._workerFarm||new me({}),me._workerFarm.setProps(t),me._workerFarm}destroy(){for(const t of this.workerPools.values())t.destroy();this.workerPools=new Map}setProps(t){this.props={...this.props,...t};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(t){const{name:e,source:s,url:r}=t;let i=this.workerPools.get(e);return i||(i=new va({name:e,source:s,url:r}),i.setProps(this._getWorkerPoolProps()),this.workerPools.set(e,i)),i}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};U(me,"_workerFarm");let Fn=me;function Ga(n,t={}){const e=t[n.id]||{},s=Zt?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let r=e.workerUrl;if(!r&&n.id==="compression"&&(r=t.workerUrl),t._workerType==="test"&&(Zt?r=`modules/${n.module}/dist/${s}`:r=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!r){let i=n.version;i==="latest"&&(i=_a);const o=i?`@${i}`:"";r=`https://unpkg.com/@loaders.gl/${n.module}${o}/dist/${s}`}return Ae(r),r}function Oa(n,t=li){Ae(n,"no worker provided");const e=n.version;return!(!t||!e)}const rs={};async function De(n,t=null,e={},s=null){return t&&(n=Pa(n,t,e,s)),rs[n]=rs[n]||Ua(n),await rs[n]}function Pa(n,t,e={},s=null){if(!e.useLocalLibraries&&n.startsWith("http"))return n;s=s||n;const r=e.modules||{};return r[s]?r[s]:Zt?e.CDN?(Ae(e.CDN.startsWith("http")),`${e.CDN}/${t}@${li}/dist/libs/${s}`):Gs?`../src/libs/${s}`:`modules/${t}/src/libs/${s}`:`modules/${t}/dist/libs/${s}`}async function Ua(n){if(n.endsWith("wasm"))return await Ha(n);if(!Zt)try{const{requireFromFile:e}=globalThis.loaders||{};return await(e==null?void 0:e(n))}catch(e){return console.error(e),null}if(Gs)return importScripts(n);const t=await Na(n);return La(t,n)}function La(n,t){if(!Zt){const{requireFromString:s}=globalThis.loaders||{};return s==null?void 0:s(n,t)}if(Gs)return eval.call(globalThis,n),null;const e=document.createElement("script");e.id=t;try{e.appendChild(document.createTextNode(n))}catch{e.text=n}return document.body.appendChild(e),null}async function Ha(n){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};return Zt||!t||n.startsWith("http")?await(await fetch(n)).arrayBuffer():await t(n)}async function Na(n){const{readFileAsText:t}=globalThis.loaders||{};return Zt||!t||n.startsWith("http")?await(await fetch(n)).text():await t(n)}function Ja(n,t){return!Fn.isSupported()||!Zt&&!(t!=null&&t._nodeWorkers)?!1:n.worker&&(t==null?void 0:t.worker)}async function ka(n,t,e,s,r){const i=n.id,o=Ga(n,e),m=Fn.getWorkerFarm(e).getWorkerPool({name:i,url:o});e=JSON.parse(JSON.stringify(e)),s=JSON.parse(JSON.stringify(s||{}));const g=await m.startJob("process-on-worker",za.bind(null,r));return g.postMessage("process",{input:t,options:e,context:s}),await(await g.result).result}async function za(n,t,e,s){switch(e){case"done":t.done(s);break;case"error":t.error(new Error(s.error));break;case"process":const{id:r,input:i,options:o}=s;try{const h=await n(i,o);t.postMessage("done",{id:r,result:h})}catch(h){const m=h instanceof Error?h.message:"unknown error";t.postMessage("error",{id:r,error:m})}break;default:console.warn(`parse-with-worker unknown message ${e}`)}}function Va(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?gr(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?gr(n,0,t):""}function gr(n,t,e){if(n.byteLength<=t+e)return"";const s=new DataView(n);let r="";for(let i=0;i<e;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}function ja(n){try{return JSON.parse(n)}catch{throw new Error(`Failed to parse JSON from data starting with "${Va(n)}"`)}}function Ka(n,t,e){if(e=e||n.byteLength,n.byteLength<e||t.byteLength<e)return!1;const s=new Uint8Array(n),r=new Uint8Array(t);for(let i=0;i<s.length;++i)if(s[i]!==r[i])return!1;return!0}function Wa(...n){return Xa(n)}function Xa(n){const t=n.map(i=>i instanceof ArrayBuffer?new Uint8Array(i):i),e=t.reduce((i,o)=>i+o.byteLength,0),s=new Uint8Array(e);let r=0;for(const i of t)s.set(i,r),r+=i.byteLength;return s.buffer}function pi(n,t,e){const s=e!==void 0?new Uint8Array(n).subarray(t,t+e):new Uint8Array(n).subarray(t);return new Uint8Array(s).buffer}function an(n,t){return pe(n>=0),pe(t>0),n+(t-1)&~(t-1)}function Qa(n,t,e){let s;if(n instanceof ArrayBuffer)s=new Uint8Array(n);else{const r=n.byteOffset,i=n.byteLength;s=new Uint8Array(n.buffer||n.arrayBuffer,r,i)}return t.set(s,e),e+an(s.byteLength,4)}async function Ya(n){const t=[];for await(const e of n)t.push(e);return Wa(...t)}let $a="";const Br={};function qa(n){for(const t in Br)if(n.startsWith(t)){const e=Br[t];n=n.replace(t,e)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${$a}${n}`),n}function Za(n){return n&&typeof n=="object"&&n.isBuffer}function Ai(n){if(Za(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const t=n;return new TextEncoder().encode(t).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function mi(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(t+1):""}function tc(n){const t=n?n.lastIndexOf("/"):-1;return t>=0?n.substr(0,t):""}var ti;const ec=(ti=globalThis.loaders)==null?void 0:ti.parseImageNode,ys=typeof Image<"u",ws=typeof ImageBitmap<"u",nc=!!ec,bs=jn?!0:nc;function sc(n){switch(n){case"auto":return ws||ys||bs;case"imagebitmap":return ws;case"image":return ys;case"data":return bs;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function rc(){if(ws)return"imagebitmap";if(ys)return"image";if(bs)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function ic(n){const t=oc(n);if(!t)throw new Error("Not an image");return t}function gi(n){switch(ic(n)){case"data":return n;case"image":case"imagebitmap":const t=document.createElement("canvas"),e=t.getContext("2d");if(!e)throw new Error("getImageData");return t.width=n.width,t.height=n.height,e.drawImage(n,0,0),e.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function oc(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const ac=/^data:image\/svg\+xml/,cc=/\.svg((\?|#).*)?$/;function Os(n){return n&&(ac.test(n)||cc.test(n))}function hc(n,t){if(Os(t)){let s=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(s=unescape(encodeURIComponent(s)))}catch(i){throw new Error(i.message)}return`data:image/svg+xml;base64,${btoa(s)}`}return Bi(n,t)}function Bi(n,t){if(Os(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function yi(n,t,e){const s=hc(n,e),r=self.URL||self.webkitURL,i=typeof s!="string"&&r.createObjectURL(s);try{return await uc(i||s,t)}finally{i&&r.revokeObjectURL(i)}}async function uc(n,t){const e=new Image;return e.src=n,t.image&&t.image.decode&&e.decode?(await e.decode(),e):await new Promise((s,r)=>{try{e.onload=()=>s(e),e.onerror=i=>{const o=i instanceof Error?i.message:"error";r(new Error(o))}}catch(i){r(i)}})}const lc={};let yr=!0;async function fc(n,t,e){let s;Os(e)?s=await yi(n,t,e):s=Bi(n,e);const r=t&&t.imagebitmap;return await dc(s,r)}async function dc(n,t=null){if((pc(t)||!yr)&&(t=null),t)try{return await createImageBitmap(n,t)}catch(e){console.warn(e),yr=!1}return await createImageBitmap(n)}function pc(n){for(const t in n||lc)return!1;return!0}function Ac(n){return!yc(n,"ftyp",4)||!(n[8]&96)?null:mc(n)}function mc(n){switch(gc(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function gc(n,t,e){return String.fromCharCode(...n.slice(t,e))}function Bc(n){return[...n].map(t=>t.charCodeAt(0))}function yc(n,t,e=0){const s=Bc(t);for(let r=0;r<s.length;++r)if(s[r]!==n[r+e])return!1;return!0}const he=!1,qe=!0;function Ps(n){const t=cn(n);return bc(t)||Mc(t)||Cc(t)||xc(t)||wc(t)}function wc(n){const t=new Uint8Array(n instanceof DataView?n.buffer:n),e=Ac(t);return e?{mimeType:e.mimeType,width:0,height:0}:null}function bc(n){const t=cn(n);return t.byteLength>=24&&t.getUint32(0,he)===2303741511?{mimeType:"image/png",width:t.getUint32(16,he),height:t.getUint32(20,he)}:null}function Cc(n){const t=cn(n);return t.byteLength>=10&&t.getUint32(0,he)===1195984440?{mimeType:"image/gif",width:t.getUint16(6,qe),height:t.getUint16(8,qe)}:null}function xc(n){const t=cn(n);return t.byteLength>=14&&t.getUint16(0,he)===16973&&t.getUint32(2,qe)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,qe),height:t.getUint32(22,qe)}:null}function Mc(n){const t=cn(n);if(!(t.byteLength>=3&&t.getUint16(0,he)===65496&&t.getUint8(2)===255))return null;const{tableMarkers:s,sofMarkers:r}=_c();let i=2;for(;i+9<t.byteLength;){const o=t.getUint16(i,he);if(r.has(o))return{mimeType:"image/jpeg",height:t.getUint16(i+5,he),width:t.getUint16(i+7,he)};if(!s.has(o))return null;i+=2,i+=t.getUint16(i,he)}return null}function _c(){const n=new Set([65499,65476,65484,65501,65534]);for(let e=65504;e<65520;++e)n.add(e);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function cn(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function Ec(n,t){var r;const{mimeType:e}=Ps(n)||{},s=(r=globalThis.loaders)==null?void 0:r.parseImageNode;return pe(s),await s(n,e)}async function Dc(n,t,e){t=t||{};const r=(t.image||{}).type||"auto",{url:i}=e||{},o=Sc(r);let h;switch(o){case"imagebitmap":h=await fc(n,t,i);break;case"image":h=await yi(n,t,i);break;case"data":h=await Ec(n);break;default:pe(!1)}return r==="data"&&(h=gi(h)),h}function Sc(n){switch(n){case"auto":case"data":return rc();default:return sc(n),n}}const Tc=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],Fc=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],Ic={image:{type:"auto",decode:!0}},vc={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:aa,mimeTypes:Fc,extensions:Tc,parse:Dc,tests:[n=>!!Ps(new DataView(n))],options:Ic},is={};function Rc(n){if(is[n]===void 0){const t=jn?Oc(n):Gc(n);is[n]=t}return is[n]}function Gc(n){var r,i;const t=["image/png","image/jpeg","image/gif"],e=((r=globalThis.loaders)==null?void 0:r.imageFormatsNode)||t;return!!((i=globalThis.loaders)==null?void 0:i.parseImageNode)&&e.includes(n)}function Oc(n){switch(n){case"image/avif":case"image/webp":return Pc(n);default:return!0}}function Pc(n){try{return document.createElement("canvas").toDataURL(n).indexOf(`data:${n}`)===0}catch{return!1}}function qt(n,t){if(!n)throw new Error(t||"assert failed: gltf")}const wi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bi={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},wr=["SCALAR","VEC2","VEC3","VEC4"],Uc=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Lc=new Map(Uc),Hc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nc={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Jc={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Ci(n){return wr[n-1]||wr[0]}function Kn(n){const t=Lc.get(n.constructor);if(!t)throw new Error("Illegal typed array");return t}function xi(n,t){const e=Jc[n.componentType],s=Hc[n.type],r=Nc[n.componentType],i=n.count*s,o=n.count*s*r;qt(o>=0&&o<=t.byteLength);const h=bi[n.componentType],m=wi[n.type];return{ArrayType:e,length:i,byteLength:o,componentByteSize:h,numberOfComponentsInElement:m}}function kc(n,t,e){const s=n.bufferViews[e];qt(s);const r=s.buffer,i=t[r];qt(i);const o=(s.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,o,s.byteLength)}function zc(n,t,e){var H,N;const s=typeof e=="number"?(H=n.accessors)==null?void 0:H[e]:e;if(!s)throw new Error(`No gltf accessor ${JSON.stringify(e)}`);const r=(N=n.bufferViews)==null?void 0:N[s.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:i,byteOffset:o}=t[r.buffer],h=(o||0)+(s.byteOffset||0)+(r.byteOffset||0),{ArrayType:m,length:g,componentByteSize:w,numberOfComponentsInElement:M}=xi(s,r),S=w*M,T=r.byteStride||S;if(typeof r.byteStride>"u"||r.byteStride===S)return new m(i,h,g);const P=new m(g);for(let V=0;V<s.count;V++){const Q=new m(i,h+V*T,M);P.set(Q,V*M)}return P}function Vc(){return{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]}}class mt{constructor(t){U(this,"gltf");U(this,"sourceBuffers");U(this,"byteLength");this.gltf={json:(t==null?void 0:t.json)||Vc(),buffers:(t==null?void 0:t.buffers)||[],images:(t==null?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(t){return this.json[t]}getExtraData(t){return(this.json.extras||{})[t]}hasExtension(t){const e=this.getUsedExtensions().find(r=>r===t),s=this.getRequiredExtensions().find(r=>r===t);return typeof e=="string"||typeof s=="string"}getExtension(t){const e=this.getUsedExtensions().find(r=>r===t),s=this.json.extensions||{};return e?s[t]:null}getRequiredExtension(t){return this.getRequiredExtensions().find(s=>s===t)?this.getExtension(t):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(t,e){return(t.extensions||{})[e]}getScene(t){return this.getObject("scenes",t)}getNode(t){return this.getObject("nodes",t)}getSkin(t){return this.getObject("skins",t)}getMesh(t){return this.getObject("meshes",t)}getMaterial(t){return this.getObject("materials",t)}getAccessor(t){return this.getObject("accessors",t)}getTexture(t){return this.getObject("textures",t)}getSampler(t){return this.getObject("samplers",t)}getImage(t){return this.getObject("images",t)}getBufferView(t){return this.getObject("bufferViews",t)}getBuffer(t){return this.getObject("buffers",t)}getObject(t,e){if(typeof e=="object")return e;const s=this.json[t]&&this.json[t][e];if(!s)throw new Error(`glTF file error: Could not find ${t}[${e}]`);return s}getTypedArrayForBufferView(t){t=this.getBufferView(t);const e=t.buffer,s=this.gltf.buffers[e];qt(s);const r=(t.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,r,t.byteLength)}getTypedArrayForAccessor(t){const e=this.getAccessor(t);return zc(this.gltf.json,this.gltf.buffers,e)}getTypedArrayForImageData(t){t=this.getAccessor(t);const e=this.getBufferView(t.bufferView),r=this.getBuffer(e.buffer).data,i=e.byteOffset||0;return new Uint8Array(r,i,e.byteLength)}addApplicationData(t,e){return this.json[t]=e,this}addExtraData(t,e){return this.json.extras=this.json.extras||{},this.json.extras[t]=e,this}addObjectExtension(t,e,s){return t.extensions=t.extensions||{},t.extensions[e]=s,this.registerUsedExtension(e),this}setObjectExtension(t,e,s){const r=t.extensions||{};r[e]=s}removeObjectExtension(t,e){const s=(t==null?void 0:t.extensions)||{};if(s[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const r=this.json.extensionsRemoved;r.includes(e)||r.push(e)}delete s[e]}addExtension(t,e={}){return qt(e),this.json.extensions=this.json.extensions||{},this.json.extensions[t]=e,this.registerUsedExtension(t),e}addRequiredExtension(t,e={}){return qt(e),this.addExtension(t,e),this.registerRequiredExtension(t),e}registerUsedExtension(t){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(e=>e===t)||this.json.extensionsUsed.push(t)}registerRequiredExtension(t){this.registerUsedExtension(t),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(e=>e===t)||this.json.extensionsRequired.push(t)}removeExtension(t){var e;if((e=this.json.extensions)!=null&&e[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const s=this.json.extensionsRemoved;s.includes(t)||s.push(t)}this.json.extensions&&delete this.json.extensions[t],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,t),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,t)}setDefaultScene(t){this.json.scene=t}addScene(t){const{nodeIndices:e}=t;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:e}),this.json.scenes.length-1}addNode(t){const{meshIndex:e,matrix:s}=t;this.json.nodes=this.json.nodes||[];const r={mesh:e};return s&&(r.matrix=s),this.json.nodes.push(r),this.json.nodes.length-1}addMesh(t){const{attributes:e,indices:s,material:r,mode:i=4}=t,h={primitives:[{attributes:this._addAttributes(e),mode:i}]};if(s){const m=this._addIndices(s);h.primitives[0].indices=m}return Number.isFinite(r)&&(h.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(h),this.json.meshes.length-1}addPointCloud(t){const s={primitives:[{attributes:this._addAttributes(t),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(s),this.json.meshes.length-1}addImage(t,e){const s=Ps(t),r=e||(s==null?void 0:s.mimeType),o={bufferView:this.addBufferView(t),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(o),this.json.images.length-1}addBufferView(t,e=0,s=this.byteLength){const r=t.byteLength;qt(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(t);const i={buffer:e,byteOffset:s,byteLength:r};return this.byteLength+=an(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}addAccessor(t,e){const s={bufferView:t,type:Ci(e.size),componentType:e.componentType,count:e.count,max:e.max,min:e.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(t,e={size:3}){const s=this.addBufferView(t);let r={min:e.min,max:e.max};(!r.min||!r.max)&&(r=this._getAccessorMinMax(t,e.size));const i={size:e.size,componentType:Kn(t),count:Math.round(t.length/e.size),min:r.min,max:r.max};return this.addAccessor(s,Object.assign(i,e))}addTexture(t){const{imageIndex:e}=t,s={source:e};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(t){return this.json.materials=this.json.materials||[],this.json.materials.push(t),this.json.materials.length-1}createBinaryChunk(){var i,o;const t=this.byteLength,e=new ArrayBuffer(t),s=new Uint8Array(e);let r=0;for(const h of this.sourceBuffers||[])r=Qa(h,s,r);(o=(i=this.json)==null?void 0:i.buffers)!=null&&o[0]?this.json.buffers[0].byteLength=t:this.json.buffers=[{byteLength:t}],this.gltf.binary=e,this.sourceBuffers=[e],this.gltf.buffers=[{arrayBuffer:e,byteOffset:0,byteLength:e.byteLength}]}_removeStringFromArray(t,e){let s=!0;for(;s;){const r=t.indexOf(e);r>-1?t.splice(r,1):s=!1}}_addAttributes(t={}){const e={};for(const s in t){const r=t[s],i=this._getGltfAttributeName(s),o=this.addBinaryBuffer(r.value,r);e[i]=o}return e}_addIndices(t){return this.addBinaryBuffer(t,{size:1})}_getGltfAttributeName(t){switch(t.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return t}}_getAccessorMinMax(t,e){const s={min:null,max:null};if(t.length<e)return s;s.min=[],s.max=[];const r=t.subarray(0,e);for(const i of r)s.min.push(i),s.max.push(i);for(let i=e;i<t.length;i+=e)for(let o=0;o<e;o++)s.min[0+o]=Math.min(s.min[0+o],t[i+o]),s.max[0+o]=Math.max(s.max[0+o],t[i+o]);return s}}function br(n){return(n%1+1)%1}const Mi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},jc={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},_i={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Us(n,t){return _i[t]*Mi[n]}function Wn(n,t,e,s){if(e!=="UINT8"&&e!=="UINT16"&&e!=="UINT32"&&e!=="UINT64")return null;const r=n.getTypedArrayForBufferView(t),i=Xn(r,"SCALAR",e,s+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function Xn(n,t,e,s=1){const r=Mi[t],i=jc[e],o=_i[e],h=s*r,m=h*o;let g=n.buffer,w=n.byteOffset;return w%o!==0&&(g=new Uint8Array(g).slice(w,w+m).buffer,w=0),new i(g,w,h)}function Ls(n,t,e){var g,w,M,S,T;const s=`TEXCOORD_${t.texCoord||0}`,r=e.attributes[s],i=n.getTypedArrayForAccessor(r),o=n.gltf.json,h=t.index,m=(w=(g=o.textures)==null?void 0:g[h])==null?void 0:w.source;if(typeof m<"u"){const P=(S=(M=o.images)==null?void 0:M[m])==null?void 0:S.mimeType,H=(T=n.gltf.images)==null?void 0:T[m];if(H&&typeof H.width<"u"){const N=[];for(let V=0;V<i.length;V+=2){const Q=Kc(H,P,i,V,t.channels);N.push(Q)}return N}}return[]}function Ei(n,t,e,s,r){if(!(e!=null&&e.length))return;const i=[];for(const w of e){let M=s.findIndex(S=>S===w);M===-1&&(M=s.push(w)-1),i.push(M)}const o=new Uint32Array(i),h=n.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,m=n.addBufferView(o,h,0),g=n.addAccessor(m,{size:1,componentType:Kn(o),count:o.length});r.attributes[t]=g}function Kc(n,t,e,s,r=[0]){const i={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=e[s],h=e[s+1];let m=1;t&&(t.indexOf("image/jpeg")!==-1||t.indexOf("image/png")!==-1)&&(m=4);const g=Wc(o,h,n,m);let w=0;for(const M of r){const S=typeof M=="number"?Object.values(i)[M]:i[M],T=g+S.offset,P=gi(n);if(P.data.length<=T)throw new Error(`${P.data.length} <= ${T}`);const H=P.data[T];w|=H<<S.shift}return w}function Wc(n,t,e,s=1){const r=e.width,i=br(n)*(r-1),o=Math.round(i),h=e.height,m=br(t)*(h-1),g=Math.round(m),w=e.components?e.components:s;return(g*r+o)*w}function Di(n,t,e,s,r){const i=[];for(let o=0;o<t;o++){const h=e[o],m=e[o+1]-e[o];if(m+h>s)break;const g=h/r,w=m/r;i.push(n.slice(g,g+w))}return i}function Si(n,t,e){const s=[];for(let r=0;r<t;r++){const i=r*e;s.push(n.slice(i,i+e))}return s}function Ti(n,t,e,s){if(e)throw new Error("Not implemented - arrayOffsets for strings is specified");if(s){const r=[],i=new TextDecoder("utf8");let o=0;for(let h=0;h<n;h++){const m=s[h+1]-s[h];if(m+o<=t.length){const g=t.subarray(o,m+o),w=i.decode(g);r.push(w),o+=m}}return r}return[]}const ke="EXT_mesh_features",Xc=ke;async function Qc(n,t){const e=new mt(n);$c(e,t)}function Yc(n,t){const e=new mt(n);return Zc(e),e.createBinaryChunk(),e.gltf}function $c(n,t){const e=n.gltf.json;if(e.meshes)for(const s of e.meshes)for(const r of s.primitives)qc(n,r,t)}function qc(n,t,e){var i,o,h;if(!((i=e==null?void 0:e.gltf)!=null&&i.loadBuffers))return;const s=(o=t.extensions)==null?void 0:o[ke],r=s==null?void 0:s.featureIds;if(r)for(const m of r){let g;if(typeof m.attribute<"u"){const w=`_FEATURE_ID_${m.attribute}`,M=t.attributes[w];g=n.getTypedArrayForAccessor(M)}else typeof m.texture<"u"&&((h=e==null?void 0:e.gltf)!=null&&h.loadImages)?g=Ls(n,m.texture,t):g=[];m.data=g}}function Zc(n,t){const e=n.gltf.json.meshes;if(e)for(const s of e)for(const r of s.primitives)eh(n,r)}function th(n,t,e,s){t.extensions||(t.extensions={});let r=t.extensions[ke];r||(r={featureIds:[]},t.extensions[ke]=r);const{featureIds:i}=r,o={featureCount:e.length,propertyTable:s,data:e};i.push(o),n.addObjectExtension(t,ke,r)}function eh(n,t){var r;const e=(r=t.extensions)==null?void 0:r[ke];if(!e)return;const s=e.featureIds;s.forEach((i,o)=>{if(i.data){const{accessorKey:h,index:m}=nh(t.attributes),g=new Uint32Array(i.data);s[o]={featureCount:g.length,propertyTable:i.propertyTable,attribute:m},n.gltf.buffers.push({arrayBuffer:g.buffer,byteOffset:g.byteOffset,byteLength:g.byteLength});const w=n.addBufferView(g),M=n.addAccessor(w,{size:1,componentType:Kn(g),count:g.length});t.attributes[h]=M}})}function nh(n){const t="_FEATURE_ID_",e=Object.keys(n).filter(i=>i.indexOf(t)===0);let s=-1;for(const i of e){const o=Number(i.substring(t.length));o>s&&(s=o)}return s++,{accessorKey:`${t}${s}`,index:s}}const sh=Object.freeze(Object.defineProperty({__proto__:null,createExtMeshFeatures:th,decode:Qc,encode:Yc,name:Xc},Symbol.toStringTag,{value:"Module"})),je="EXT_structural_metadata",rh=je;async function ih(n,t){const e=new mt(n);ah(e,t)}function oh(n,t){const e=new mt(n);return xh(e),e.createBinaryChunk(),e.gltf}function ah(n,t){var s,r;if(!((s=t.gltf)!=null&&s.loadBuffers))return;const e=n.getExtension(je);e&&((r=t.gltf)!=null&&r.loadImages&&ch(n,e),hh(n,e))}function ch(n,t){const e=t.propertyTextures,s=n.gltf.json;if(e&&s.meshes)for(const r of s.meshes)for(const i of r.primitives)lh(n,e,i,t)}function hh(n,t){const e=t.schema;if(!e)return;const s=e.classes,r=t.propertyTables;if(s&&r)for(const i in s){const o=uh(r,i);o&&dh(n,e,o)}}function uh(n,t){for(const e of n)if(e.class===t)return e;return null}function lh(n,t,e,s){var o;if(!t)return;const r=(o=e.extensions)==null?void 0:o[je],i=r==null?void 0:r.propertyTextures;if(i)for(const h of i){const m=t[h];fh(n,m,e,s)}}function fh(n,t,e,s){var i;if(!t.properties)return;s.dataAttributeNames||(s.dataAttributeNames=[]);const r=t.class;for(const o in t.properties){const h=`${r}_${o}`,m=(i=t.properties)==null?void 0:i[o];if(!m)continue;m.data||(m.data=[]);const g=m.data,w=Ls(n,m,e);w!==null&&(Ei(n,h,w,g,e),m.data=g,s.dataAttributeNames.push(h))}}function dh(n,t,e){var i,o;const s=(i=t.classes)==null?void 0:i[e.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const r=e.count;for(const h in s.properties){const m=s.properties[h],g=(o=e.properties)==null?void 0:o[h];if(g){const w=ph(n,t,m,r,g);g.data=w}}}function ph(n,t,e,s,r){let i=[];const o=r.values,h=n.getTypedArrayForBufferView(o),m=Ah(n,e,r,s),g=mh(n,r,s);switch(e.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":{i=gh(e,s,h,m);break}case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${e.type}`);case"STRING":{i=Ti(s,h,m,g);break}case"ENUM":{i=Bh(t,e,s,h,m);break}default:throw new Error(`Unknown classProperty type ${e.type}`)}return i}function Ah(n,t,e,s){return t.array&&typeof t.count>"u"&&typeof e.arrayOffsets<"u"?Wn(n,e.arrayOffsets,e.arrayOffsetType||"UINT32",s):null}function mh(n,t,e){return typeof t.stringOffsets<"u"?Wn(n,t.stringOffsets,t.stringOffsetType||"UINT32",e):null}function gh(n,t,e,s){const r=n.array,i=n.count,o=Us(n.type,n.componentType),h=e.byteLength/o;let m;return n.componentType?m=Xn(e,n.type,n.componentType,h):m=e,r?s?Di(m,t,s,e.length,o):i?Si(m,t,i):[]:m}function Bh(n,t,e,s,r){var M;const i=t.enumType;if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const o=(M=n.enums)==null?void 0:M[i];if(!o)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${i}`);const h=o.valueType||"UINT16",m=Us(t.type,h),g=s.byteLength/m;let w=Xn(s,t.type,h,g);if(w||(w=s),t.array){if(r)return yh({valuesData:w,numberOfElements:e,arrayOffsets:r,valuesDataBytesLength:s.length,elementSize:m,enumEntry:o});const S=t.count;return S?wh(w,e,S,o):[]}return Hs(w,0,e,o)}function yh(n){const{valuesData:t,numberOfElements:e,arrayOffsets:s,valuesDataBytesLength:r,elementSize:i,enumEntry:o}=n,h=[];for(let m=0;m<e;m++){const g=s[m],w=s[m+1]-s[m];if(w+g>r)break;const M=g/i,S=w/i,T=Hs(t,M,S,o);h.push(T)}return h}function wh(n,t,e,s){const r=[];for(let i=0;i<t;i++){const o=e*i,h=Hs(n,o,e,s);r.push(h)}return r}function Hs(n,t,e,s){const r=[];for(let i=0;i<e;i++)if(n instanceof BigInt64Array||n instanceof BigUint64Array)r.push("");else{const o=n[t+i],h=bh(s,o);h?r.push(h.name):r.push("")}return r}function bh(n,t){for(const e of n.values)if(e.value===t)return e;return null}const Ch="schemaClassId";function xh(n,t){var s,r;const e=n.getExtension(je);if(e&&e.propertyTables)for(const i of e.propertyTables){const o=i.class,h=(r=(s=e.schema)==null?void 0:s.classes)==null?void 0:r[o];i.properties&&h&&Mh(i,h,n)}}function Mh(n,t,e){for(const s in n.properties){const r=n.properties[s].data;if(r){const i=t.properties[s];if(i){const o=Sh(r,i,e);n.properties[s]=o}}}}function _h(n,t,e=Ch){let s=n.getExtension(je);s||(s=n.addExtension(je)),s.schema=Eh(t,e,s.schema);const r=Dh(t,e,s.schema);return s.propertyTables||(s.propertyTables=[]),s.propertyTables.push(r)-1}function Eh(n,t,e){const s=e??{id:"schema_id"},r={properties:{}};for(const i of n){const o={type:i.elementType,componentType:i.componentType};r.properties[i.name]=o}return s.classes={},s.classes[t]=r,s}function Dh(n,t,e){var o;const s={class:t,count:0};let r=0;const i=(o=e.classes)==null?void 0:o[t];for(const h of n){if(r===0&&(r=h.values.length),r!==h.values.length&&h.values.length)throw new Error("Illegal values in attributes");(i==null?void 0:i.properties[h.name])&&(s.properties||(s.properties={}),s.properties[h.name]={values:0,data:h.values})}return s.count=r,s}function Sh(n,t,e){const s={values:0};if(t.type==="STRING"){const{stringData:r,stringOffsets:i}=Ih(n);s.stringOffsets=os(i,e),s.values=os(r,e)}else if(t.type==="SCALAR"&&t.componentType){const r=Fh(n,t.componentType);s.values=os(r,e)}return s}const Th={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Fh(n,t){const e=[];for(const r of n)e.push(Number(r));const s=Th[t];if(!s)throw new Error("Illegal component type");return new s(e)}function Ih(n){const t=new TextEncoder,e=[];let s=0;for(const m of n){const g=t.encode(m);s+=g.length,e.push(g)}const r=new Uint8Array(s),i=[];let o=0;for(const m of e)r.set(m,o),i.push(o),o+=m.length;i.push(o);const h=new Uint32Array(i);return{stringData:r,stringOffsets:h}}function os(n,t){return t.gltf.buffers.push({arrayBuffer:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength}),t.addBufferView(n)}const vh=Object.freeze(Object.defineProperty({__proto__:null,createExtStructuralMetadata:_h,decode:ih,encode:oh,name:rh},Symbol.toStringTag,{value:"Module"})),Fi="EXT_feature_metadata",Rh=Fi;async function Gh(n,t){const e=new mt(n);Oh(e,t)}function Oh(n,t){var s,r;if(!((s=t.gltf)!=null&&s.loadBuffers))return;const e=n.getExtension(Fi);e&&((r=t.gltf)!=null&&r.loadImages&&Ph(n,e),Uh(n,e))}function Ph(n,t){const e=t.schema;if(!e)return;const s=e.classes,{featureTextures:r}=t;if(s&&r)for(const i in s){const o=s[i],h=Hh(r,i);h&&Jh(n,h,o)}}function Uh(n,t){const e=t.schema;if(!e)return;const s=e.classes,r=t.featureTables;if(s&&r)for(const i in s){const o=Lh(r,i);o&&Nh(n,e,o)}}function Lh(n,t){for(const e in n){const s=n[e];if(s.class===t)return s}return null}function Hh(n,t){for(const e in n){const s=n[e];if(s.class===t)return s}return null}function Nh(n,t,e){var i,o;if(!e.class)return;const s=(i=t.classes)==null?void 0:i[e.class];if(!s)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${e.class}`);const r=e.count;for(const h in s.properties){const m=s.properties[h],g=(o=e.properties)==null?void 0:o[h];if(g){const w=kh(n,t,m,r,g);g.data=w}}}function Jh(n,t,e){var r;const s=t.class;for(const i in e.properties){const o=(r=t==null?void 0:t.properties)==null?void 0:r[i];if(o){const h=Wh(n,o,s);o.data=h}}}function kh(n,t,e,s,r){let i=[];const o=r.bufferView,h=n.getTypedArrayForBufferView(o),m=zh(n,e,r,s),g=Vh(n,e,r,s);return e.type==="STRING"||e.componentType==="STRING"?i=Ti(s,h,m,g):jh(e)&&(i=Kh(e,s,h,m)),i}function zh(n,t,e,s){return t.type==="ARRAY"&&typeof t.componentCount>"u"&&typeof e.arrayOffsetBufferView<"u"?Wn(n,e.arrayOffsetBufferView,e.offsetType||"UINT32",s):null}function Vh(n,t,e,s){return typeof e.stringOffsetBufferView<"u"?Wn(n,e.stringOffsetBufferView,e.offsetType||"UINT32",s):null}function jh(n){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(n.type)||typeof n.componentType<"u"&&t.includes(n.componentType)}function Kh(n,t,e,s){const r=n.type==="ARRAY",i=n.componentCount,o="SCALAR",h=n.componentType||n.type,m=Us(o,h),g=e.byteLength/m,w=Xn(e,o,h,g);return r?s?Di(w,t,s,e.length,m):i?Si(w,t,i):[]:w}function Wh(n,t,e){const s=n.gltf.json;if(!s.meshes)return[];const r=[];for(const i of s.meshes)for(const o of i.primitives)Xh(n,e,t,r,o);return r}function Xh(n,t,e,s,r){const i={channels:e.channels,...e.texture},o=Ls(n,i,r);o&&Ei(n,t,o,s,r)}const Qh=Object.freeze(Object.defineProperty({__proto__:null,decode:Gh,name:Rh},Symbol.toStringTag,{value:"Module"})),Yh="4.3.2",$h="4.3.2",In={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};let Cr;async function xr(n){xa(n.modules);const t=Ma("basis");return t||(Cr||(Cr=qh(n)),await Cr)}async function qh(n){let t=null,e=null;return[t,e]=await Promise.all([await De(In.TRANSCODER,"textures",n),await De(In.TRANSCODER_WASM,"textures",n)]),t=t||globalThis.BASIS,await Zh(t,e)}function Zh(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(s=>{n(e).then(r=>{const{BasisFile:i,initializeBasis:o}=r;o(),s({BasisFile:i})})})}let as;async function Mr(n){const t=n.modules||{};return t.basisEncoder?t.basisEncoder:(as=as||tu(n),await as)}async function tu(n){let t=null,e=null;return[t,e]=await Promise.all([await De(In.ENCODER,"textures",n),await De(In.ENCODER_WASM,"textures",n)]),t=t||globalThis.BASIS,await eu(t,e)}function eu(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(s=>{n(e).then(r=>{const{BasisFile:i,KTX2File:o,initializeBasis:h,BasisEncoder:m}=r;h(),s({BasisFile:i,KTX2File:o,BasisEncoder:m})})})}const Ue={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_RGBA8_ETC2_EAC:37493,COMPRESSED_SRGB8_ETC2:37494,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37495,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37496,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37497,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGB_ATC_WEBGL:35986,COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL:35987,COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL:34798,COMPRESSED_RGBA_ASTC_4X4_KHR:37808,COMPRESSED_RGBA_ASTC_5X4_KHR:37809,COMPRESSED_RGBA_ASTC_5X5_KHR:37810,COMPRESSED_RGBA_ASTC_6X5_KHR:37811,COMPRESSED_RGBA_ASTC_6X6_KHR:37812,COMPRESSED_RGBA_ASTC_8X5_KHR:37813,COMPRESSED_RGBA_ASTC_8X6_KHR:37814,COMPRESSED_RGBA_ASTC_8X8_KHR:37815,COMPRESSED_RGBA_ASTC_10X5_KHR:37816,COMPRESSED_RGBA_ASTC_10X6_KHR:37817,COMPRESSED_RGBA_ASTC_10X8_KHR:37818,COMPRESSED_RGBA_ASTC_10X10_KHR:37819,COMPRESSED_RGBA_ASTC_12X10_KHR:37820,COMPRESSED_RGBA_ASTC_12X12_KHR:37821,COMPRESSED_SRGB8_ALPHA8_ASTC_4X4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5X4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5X5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6X5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6X6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8X5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8X6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8X8_KHR:37847,COMPRESSED_SRGB8_ALPHA8_ASTC_10X5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10X6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10X8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_10X10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_12X10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12X12_KHR:37853,COMPRESSED_RED_RGTC1_EXT:36283,COMPRESSED_SIGNED_RED_RGTC1_EXT:36284,COMPRESSED_RED_GREEN_RGTC2_EXT:36285,COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT:36286,COMPRESSED_SRGB_S3TC_DXT1_EXT:35916,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:35919},nu=["","WEBKIT_","MOZ_"],_r={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let wn=null;function su(n){if(!wn){n=n||ru()||void 0,wn=new Set;for(const t of nu)for(const e in _r)if(n&&n.getExtension(`${t}${e}`)){const s=_r[e];wn.add(s)}}return wn}function ru(){try{return document.createElement("canvas").getContext("webgl")}catch{return null}}const Wt=[171,75,84,88,32,50,48,187,13,10,26,10];function iu(n){const t=new Uint8Array(n);return!(t.byteLength<Wt.length||t[0]!==Wt[0]||t[1]!==Wt[1]||t[2]!==Wt[2]||t[3]!==Wt[3]||t[4]!==Wt[4]||t[5]!==Wt[5]||t[6]!==Wt[6]||t[7]!==Wt[7]||t[8]!==Wt[8]||t[9]!==Wt[9]||t[10]!==Wt[10]||t[11]!==Wt[11])}const ou={etc1:{basisFormat:0,compressed:!0,format:Ue.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:Ue.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:Ue.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:Ue.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:Ue.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:Ue.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};async function au(n,t){if(t.basis.containerFormat==="auto"){if(iu(n)){const s=await Mr(t);return Er(s.KTX2File,n,t)}const{BasisFile:e}=await xr(t);return cs(e,n,t)}switch(t.basis.module){case"encoder":const e=await Mr(t);switch(t.basis.containerFormat){case"ktx2":return Er(e.KTX2File,n,t);case"basis":default:return cs(e.BasisFile,n,t)}case"transcoder":default:const{BasisFile:s}=await xr(t);return cs(s,n,t)}}function cs(n,t,e){const s=new n(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("Failed to start basis transcoding");const r=s.getNumImages(),i=[];for(let o=0;o<r;o++){const h=s.getNumLevels(o),m=[];for(let g=0;g<h;g++)m.push(cu(s,o,g,e));i.push(m)}return i}finally{s.close(),s.delete()}}function cu(n,t,e,s){const r=n.getImageWidth(t,e),i=n.getImageHeight(t,e),o=n.getHasAlpha(),{compressed:h,format:m,basisFormat:g}=Ii(s,o),w=n.getImageTranscodedSizeInBytes(t,e,g),M=new Uint8Array(w);if(!n.transcodeImage(M,t,e,g,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:i,data:M,compressed:h,format:m,hasAlpha:o}}function Er(n,t,e){const s=new n(new Uint8Array(t));try{if(!s.startTranscoding())throw new Error("failed to start KTX2 transcoding");const r=s.getLevels(),i=[];for(let o=0;o<r;o++)i.push(hu(s,o,e));return[i]}finally{s.close(),s.delete()}}function hu(n,t,e){const{alphaFlag:s,height:r,width:i}=n.getImageLevelInfo(t,0,0),{compressed:o,format:h,basisFormat:m}=Ii(e,s),g=n.getImageTranscodedSizeInBytes(t,0,0,m),w=new Uint8Array(g);if(!n.transcodeImage(w,t,0,0,m,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:i,height:r,data:w,compressed:o,levelSize:g,hasAlpha:s,format:h}}function Ii(n,t){let e=n&&n.basis&&n.basis.format;return e==="auto"&&(e=vi()),typeof e=="object"&&(e=t?e.alpha:e.noAlpha),e=e.toLowerCase(),ou[e]}function vi(){const n=su();return n.has("astc")?"astc-4x4":n.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:n.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:n.has("etc1")?"etc1":n.has("etc2")?"etc2":"rgb565"}const uu={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:$h,worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},lu={...uu,parse:au},Ke=!0,Dr=1735152710,Ns=12,vn=8,fu=1313821514,du=5130562,pu=0,Au=0,mu=1;function gu(n,t=0){return`${String.fromCharCode(n.getUint8(t+0))}${String.fromCharCode(n.getUint8(t+1))}${String.fromCharCode(n.getUint8(t+2))}${String.fromCharCode(n.getUint8(t+3))}`}function Bu(n,t=0,e={}){const s=new DataView(n),{magic:r=Dr}=e,i=s.getUint32(t,!1);return i===r||i===Dr}function yu(n,t,e=0,s={}){const r=new DataView(t),i=gu(r,e+0),o=r.getUint32(e+4,Ke),h=r.getUint32(e+8,Ke);switch(Object.assign(n,{header:{byteOffset:e,byteLength:h,hasBinChunk:!1},type:i,version:o,json:{},binChunks:[]}),e+=Ns,n.version){case 1:return wu(n,r,e);case 2:return bu(n,r,e,s={});default:throw new Error(`Invalid GLB version ${n.version}. Only supports version 1 and 2.`)}}function wu(n,t,e){pe(n.header.byteLength>Ns+vn);const s=t.getUint32(e+0,Ke),r=t.getUint32(e+4,Ke);return e+=vn,pe(r===pu),Cs(n,t,e,s),e+=s,e+=xs(n,t,e,n.header.byteLength),e}function bu(n,t,e,s){return pe(n.header.byteLength>Ns+vn),Cu(n,t,e,s),e+n.header.byteLength}function Cu(n,t,e,s){for(;e+8<=n.header.byteLength;){const r=t.getUint32(e+0,Ke),i=t.getUint32(e+4,Ke);switch(e+=vn,i){case fu:Cs(n,t,e,r);break;case du:xs(n,t,e,r);break;case Au:s.strict||Cs(n,t,e,r);break;case mu:s.strict||xs(n,t,e,r);break}e+=an(r,4)}return e}function Cs(n,t,e,s){const r=new Uint8Array(t.buffer,e,s),o=new TextDecoder("utf8").decode(r);return n.json=JSON.parse(o),an(s,4)}function xs(n,t,e,s){return n.header.hasBinChunk=!0,n.binChunks.push({byteOffset:e,byteLength:s,arrayBuffer:t.buffer}),an(s,4)}function Ri(n,t){if(n.startsWith("data:")||n.startsWith("http:")||n.startsWith("https:"))return n;const s=t.baseUri||t.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${n}`);return s.substr(0,s.lastIndexOf("/")+1)+n}const xu="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",Mu="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",_u=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),Eu=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Du={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Su={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function Tu(n,t,e,s,r,i="NONE"){const o=await Fu();Ru(o,o.exports[Su[r]],n,t,e,s,o.exports[Du[i||"NONE"]])}let hs;async function Fu(){return hs||(hs=Iu()),hs}async function Iu(){let n=xu;WebAssembly.validate(_u)&&(n=Mu,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(vu(n),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}function vu(n){const t=new Uint8Array(n.length);for(let s=0;s<n.length;++s){const r=n.charCodeAt(s);t[s]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}let e=0;for(let s=0;s<n.length;++s)t[e++]=t[s]<60?Eu[t[s]]:(t[s]-60)*64+t[++s];return t.buffer.slice(0,e)}function Ru(n,t,e,s,r,i,o){const h=n.exports.sbrk,m=s+3&-4,g=h(m*r),w=h(i.length),M=new Uint8Array(n.exports.memory.buffer);M.set(i,w);const S=t(g,s,r,w,i.length);if(S===0&&o&&o(g,m,r),e.set(M.subarray(g,g+s*r)),h(g-h(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const Rn="EXT_meshopt_compression",Gu=Rn;async function Ou(n,t){var r,i;const e=new mt(n);if(!((r=t==null?void 0:t.gltf)!=null&&r.decompressMeshes)||!((i=t.gltf)!=null&&i.loadBuffers))return;const s=[];for(const o of n.json.bufferViews||[])s.push(Pu(e,o));await Promise.all(s),e.removeExtension(Rn)}async function Pu(n,t){const e=n.getObjectExtension(t,Rn);if(e){const{byteOffset:s=0,byteLength:r=0,byteStride:i,count:o,mode:h,filter:m="NONE",buffer:g}=e,w=n.gltf.buffers[g],M=new Uint8Array(w.arrayBuffer,w.byteOffset+s,r),S=new Uint8Array(n.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await Tu(S,o,i,M,h,m),n.removeObjectExtension(t,Rn)}}const Uu=Object.freeze(Object.defineProperty({__proto__:null,decode:Ou,name:Gu},Symbol.toStringTag,{value:"Module"})),Le="EXT_texture_webp",Lu=Le;function Hu(n,t){const e=new mt(n);if(!Rc("image/webp")){if(e.getRequiredExtensions().includes(Le))throw new Error(`gltf: Required extension ${Le} not supported by browser`);return}const{json:s}=e;for(const r of s.textures||[]){const i=e.getObjectExtension(r,Le);i&&(r.source=i.source),e.removeObjectExtension(r,Le)}e.removeExtension(Le)}const Nu=Object.freeze(Object.defineProperty({__proto__:null,name:Lu,preprocess:Hu},Symbol.toStringTag,{value:"Module"})),Dn="KHR_texture_basisu",Ju=Dn;function ku(n,t){const e=new mt(n),{json:s}=e;for(const r of s.textures||[]){const i=e.getObjectExtension(r,Dn);i&&(r.source=i.source,e.removeObjectExtension(r,Dn))}e.removeExtension(Dn)}const zu=Object.freeze(Object.defineProperty({__proto__:null,name:Ju,preprocess:ku},Symbol.toStringTag,{value:"Module"})),Vu="4.3.2",ju={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:Vu,worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:typeof WebAssembly=="object"?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function Ku(n){switch(n.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}function Wu(n){let t=1/0,e=1/0,s=1/0,r=-1/0,i=-1/0,o=-1/0;const h=n.POSITION?n.POSITION.value:[],m=h&&h.length;for(let g=0;g<m;g+=3){const w=h[g],M=h[g+1],S=h[g+2];t=w<t?w:t,e=M<e?M:e,s=S<s?S:s,r=w>r?w:r,i=M>i?M:i,o=S>o?S:o}return[[t,e,s],[r,i,o]]}function Xu(n,t,e){const s=Ku(t.value),r=e||Qu(t);return{name:n,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:s}]},nullable:!1,metadata:r}}function Qu(n){const t={};return"byteOffset"in n&&(t.byteOffset=n.byteOffset.toString(10)),"byteStride"in n&&(t.byteStride=n.byteStride.toString(10)),"normalized"in n&&(t.normalized=n.normalized.toString()),t}function Yu(n,t,e){const s=Gi(t.metadata),r=[],i=$u(t.attributes);for(const o in n){const h=n[o],m=Sr(o,h,i[o]);r.push(m)}if(e){const o=Sr("indices",e);r.push(o)}return{fields:r,metadata:s}}function $u(n){const t={};for(const e in n){const s=n[e];t[s.name||"undefined"]=s}return t}function Sr(n,t,e){const s=e?Gi(e.metadata):void 0;return Xu(n,t,s)}function Gi(n){Object.entries(n);const t={};for(const e in n)t[`${e}.string`]=JSON.stringify(n[e]);return t}const Tr={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},qu={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Zu=4;class tl{constructor(t){U(this,"draco");U(this,"decoder");U(this,"metadataQuerier");this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(t,e={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(t),t.byteLength),this._disableAttributeTransforms(e);const r=this.decoder.GetEncodedGeometryType(s),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let o;switch(r){case this.draco.TRIANGULAR_MESH:o=this.decoder.DecodeBufferToMesh(s,i);break;case this.draco.POINT_CLOUD:o=this.decoder.DecodeBufferToPointCloud(s,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!o.ok()||!i.ptr){const S=`DRACO decompression failed: ${o.error_msg()}`;throw new Error(S)}const h=this._getDracoLoaderData(i,r,e),m=this._getMeshData(i,h,e),g=Wu(m.attributes),w=Yu(m.attributes,h,m.indices);return{loader:"draco",loaderData:h,header:{vertexCount:i.num_points(),boundingBox:g},...m,schema:w}}finally{this.draco.destroy(s),i&&this.draco.destroy(i)}}_getDracoLoaderData(t,e,s){const r=this._getTopLevelMetadata(t),i=this._getDracoAttributes(t,s);return{geometry_type:e,num_attributes:t.num_attributes(),num_points:t.num_points(),num_faces:t instanceof this.draco.Mesh?t.num_faces():0,metadata:r,attributes:i}}_getDracoAttributes(t,e){const s={};for(let r=0;r<t.num_attributes();r++){const i=this.decoder.GetAttribute(t,r),o=this._getAttributeMetadata(t,r);s[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:o};const h=this._getQuantizationTransform(i,e);h&&(s[i.unique_id()].quantization_transform=h);const m=this._getOctahedronTransform(i,e);m&&(s[i.unique_id()].octahedron_transform=m)}return s}_getMeshData(t,e,s){const r=this._getMeshAttributes(e,t,s);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");if(t instanceof this.draco.Mesh)switch(s.topology){case"triangle-strip":return{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(t),size:1}};case"triangle-list":default:return{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(t),size:1}}}return{topology:"point-list",mode:0,attributes:r}}_getMeshAttributes(t,e,s){const r={};for(const i of Object.values(t.attributes)){const o=this._deduceAttributeName(i,s);i.name=o;const h=this._getAttributeValues(e,i);if(h){const{value:m,size:g}=h;r[o]={value:m,size:g,byteOffset:i.byte_offset,byteStride:i.byte_stride,normalized:i.normalized}}}return r}_getTriangleListIndices(t){const s=t.num_faces()*3,r=s*Zu,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(t,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,s).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(t){const e=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(t,e),sl(e)}finally{this.draco.destroy(e)}}_getAttributeValues(t,e){const s=qu[e.data_type];if(!s)return console.warn(`DRACO: Unsupported attribute type ${e.data_type}`),null;const r=e.num_components,o=t.num_points()*r,h=o*s.BYTES_PER_ELEMENT,m=el(this.draco,s);let g;const w=this.draco._malloc(h);try{const M=this.decoder.GetAttribute(t,e.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(t,M,m,h,w),g=new s(this.draco.HEAPF32.buffer,w,o).slice()}finally{this.draco._free(w)}return{value:g,size:r}}_deduceAttributeName(t,e){const s=t.unique_id;for(const[o,h]of Object.entries(e.extraAttributes||{}))if(h===s)return o;const r=t.attribute_type;for(const o in Tr)if(this.draco[o]===r)return Tr[o];const i=e.attributeNameEntry||"name";return t.metadata[i]?t.metadata[i].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(t){const e=this.decoder.GetMetadata(t);return this._getDracoMetadata(e)}_getAttributeMetadata(t,e){const s=this.decoder.GetAttributeMetadata(t,e);return this._getDracoMetadata(s)}_getDracoMetadata(t){if(!t||!t.ptr)return{};const e={},s=this.metadataQuerier.NumEntries(t);for(let r=0;r<s;r++){const i=this.metadataQuerier.GetEntryName(t,r);e[i]=this._getDracoMetadataField(t,i)}return e}_getDracoMetadataField(t,e){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(t,e,s);const r=nl(s);return{int:this.metadataQuerier.GetIntEntry(t,e),string:this.metadataQuerier.GetStringEntry(t,e),double:this.metadataQuerier.GetDoubleEntry(t,e),intArray:r}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(t){const{quantizedAttributes:e=[],octahedronAttributes:s=[]}=t,r=[...e,...s];for(const i of r)this.decoder.SkipAttributeTransform(this.draco[i])}_getQuantizationTransform(t,e){const{quantizedAttributes:s=[]}=e,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits(),range:o.range(),min_values:new Float32Array([1,2,3]).map(h=>o.min_value(h))}}finally{this.draco.destroy(o)}}return null}_getOctahedronTransform(t,e){const{octahedronAttributes:s=[]}=e,r=t.attribute_type();if(s.map(o=>this.decoder[o]).includes(r)){const o=new this.draco.AttributeQuantizationTransform;try{if(o.InitFromAttribute(t))return{quantization_bits:o.quantization_bits()}}finally{this.draco.destroy(o)}}return null}}function el(n,t){switch(t){case Float32Array:return n.DT_FLOAT32;case Int8Array:return n.DT_INT8;case Int16Array:return n.DT_INT16;case Int32Array:return n.DT_INT32;case Uint8Array:return n.DT_UINT8;case Uint16Array:return n.DT_UINT16;case Uint32Array:return n.DT_UINT32;default:return n.DT_INVALID}}function nl(n){const t=n.size(),e=new Int32Array(t);for(let s=0;s<t;s++)e[s]=n.GetValue(s);return e}function sl(n){const t=n.size(),e=new Int32Array(t);for(let s=0;s<t;s++)e[s]=n.GetValue(s);return e}const rl="1.5.6",il="1.4.1",us=`https://www.gstatic.com/draco/versioned/decoders/${rl}`,Ht={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},ls={[Ht.DECODER]:`${us}/${Ht.DECODER}`,[Ht.DECODER_WASM]:`${us}/${Ht.DECODER_WASM}`,[Ht.FALLBACK_DECODER]:`${us}/${Ht.FALLBACK_DECODER}`,[Ht.ENCODER]:`https://raw.githubusercontent.com/google/draco/${il}/javascript/${Ht.ENCODER}`};let fs;async function ol(n){const t=n.modules||{};return t.draco3d?fs||(fs=t.draco3d.createDecoderModule({}).then(e=>({draco:e}))):fs||(fs=al(n)),await fs}async function al(n){let t,e;switch(n.draco&&n.draco.decoderType){case"js":t=await De(ls[Ht.FALLBACK_DECODER],"draco",n,Ht.FALLBACK_DECODER);break;case"wasm":default:[t,e]=await Promise.all([await De(ls[Ht.DECODER],"draco",n,Ht.DECODER),await De(ls[Ht.DECODER_WASM],"draco",n,Ht.DECODER_WASM)])}return t=t||globalThis.DracoDecoderModule,await cl(t,e)}function cl(n,t){const e={};return t&&(e.wasmBinary=t),new Promise(s=>{n({...e,onModuleLoaded:r=>s({draco:r})})})}const hl={...ju,parse:ul};async function ul(n,t){const{draco:e}=await ol(t),s=new tl(e);try{return s.parseSync(n,t==null?void 0:t.draco)}finally{s.destroy()}}function ll(n){const t={};for(const e in n){const s=n[e];if(e!=="indices"){const r=Oi(s);t[e]=r}}return t}function Oi(n){const{buffer:t,size:e,count:s}=fl(n);return{value:t,size:e,byteOffset:0,count:s,type:Ci(e),componentType:Kn(t)}}function fl(n){let t=n,e=1,s=0;return n&&n.value&&(t=n.value,e=n.size||1),t&&(ArrayBuffer.isView(t)||(t=dl(t,Float32Array)),s=t.length/e),{buffer:t,size:e,count:s}}function dl(n,t,e=!1){return n?Array.isArray(n)?new t(n):e&&!(n instanceof t)?new t(n):n:null}const Se="KHR_draco_mesh_compression",pl=Se;function Al(n,t,e){const s=new mt(n);for(const r of Pi(s))s.getObjectExtension(r,Se)}async function ml(n,t,e){var i;if(!((i=t==null?void 0:t.gltf)!=null&&i.decompressMeshes))return;const s=new mt(n),r=[];for(const o of Pi(s))s.getObjectExtension(o,Se)&&r.push(Bl(s,o,t,e));await Promise.all(r),s.removeExtension(Se)}function gl(n,t={}){const e=new mt(n);for(const s of e.json.meshes||[])yl(),e.addRequiredExtension(Se)}async function Bl(n,t,e,s){const r=n.getObjectExtension(t,Se);if(!r)return;const i=n.getTypedArrayForBufferView(r.bufferView),o=pi(i.buffer,i.byteOffset),h={...e};delete h["3d-tiles"];const m=await ai(o,hl,h,s),g=ll(m.attributes);for(const[w,M]of Object.entries(g))if(w in t.attributes){const S=t.attributes[w],T=n.getAccessor(S);T!=null&&T.min&&(T!=null&&T.max)&&(M.min=T.min,M.max=T.max)}t.attributes=g,m.indices&&(t.indices=Oi(m.indices)),n.removeObjectExtension(t,Se),wl(t)}function yl(n,t,e=4,s,r){if(!s.DracoWriter)throw new Error("options.gltf.DracoWriter not provided")}function wl(n){if(!n.attributes&&Object.keys(n.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function*Pi(n){for(const t of n.json.meshes||[])for(const e of t.primitives)yield e}const bl=Object.freeze(Object.defineProperty({__proto__:null,decode:ml,encode:gl,name:pl,preprocess:Al},Symbol.toStringTag,{value:"Module"})),Cl={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...Cl}};const te=globalThis.mathgl.config;function xl(n,{precision:t=te.precision}={}){return n=Ml(n),`${parseFloat(n.toPrecision(t))}`}function Gn(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Ui(n,t,e){const s=te.EPSILON;try{if(n===t)return!0;if(Gn(n)&&Gn(t)){if(n.length!==t.length)return!1;for(let r=0;r<n.length;++r)if(!Ui(n[r],t[r]))return!1;return!0}return n&&n.equals?n.equals(t):t&&t.equals?t.equals(n):typeof n=="number"&&typeof t=="number"?Math.abs(n-t)<=te.EPSILON*Math.max(1,Math.abs(n),Math.abs(t)):!1}finally{te.EPSILON=s}}function Ml(n){return Math.round(n/te.EPSILON)*te.EPSILON}class Li extends Array{clone(){return new this.constructor().copy(this)}fromArray(t,e=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=t[s+e];return this.check()}toArray(t=[],e=0){for(let s=0;s<this.ELEMENTS;++s)t[e+s]=this[s];return t}toObject(t){return t}from(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}to(t){return t===this?this:Gn(t)?this.toArray(t):this.toObject(t)}toTarget(t){return t?this.to(t):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(te)}formatString(t){let e="";for(let s=0;s<this.ELEMENTS;++s)e+=(s>0?", ":"")+xl(this[s],t);return`${t.printTypes?this.constructor.name:""}[${e}]`}equals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(!Ui(this[e],t[e]))return!1;return!0}exactEquals(t){if(!t||this.length!==t.length)return!1;for(let e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}negate(){for(let t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}lerp(t,e,s){if(s===void 0)return this.lerp(this,t,e);for(let r=0;r<this.ELEMENTS;++r){const i=t[r],o=typeof e=="number"?e:e[r];this[r]=i+s*(o-i)}return this.check()}min(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}max(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}clamp(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t[s]),e[s]);return this.check()}add(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]+=e[s];return this.check()}subtract(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]-=e[s];return this.check()}scale(t){if(typeof t=="number")for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;else for(let e=0;e<this.ELEMENTS&&e<t.length;++e)this[e]*=t[e];return this.check()}multiplyByScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}check(){if(te.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let t=this.length===this.ELEMENTS;for(let e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}sub(t){return this.subtract(t)}setScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}addScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}subScalar(t){return this.addScalar(-t)}multiplyScalar(t){for(let e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}divideScalar(t){return this.multiplyByScalar(1/t)}clampScalar(t,e){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],t),e);return this.check()}get elements(){return this}}function _l(n,t){if(n.length!==t)return!1;for(let e=0;e<n.length;++e)if(!Number.isFinite(n[e]))return!1;return!0}function Xt(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function El(n,t,e=""){if(te.debug&&!_l(n,t))throw new Error(`math.gl: ${e} some fields set to invalid numbers'`);return n}function Fr(n,t){if(!n)throw new Error(`math.gl assertion ${t}`)}class Dl extends Li{get x(){return this[0]}set x(t){this[0]=Xt(t)}get y(){return this[1]}set y(t){this[1]=Xt(t)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let t=0;for(let e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}magnitudeSquared(){return this.lengthSquared()}distance(t){return Math.sqrt(this.distanceSquared(t))}distanceSquared(t){let e=0;for(let s=0;s<this.ELEMENTS;++s){const r=this[s]-t[s];e+=r*r}return Xt(e)}dot(t){let e=0;for(let s=0;s<this.ELEMENTS;++s)e+=this[s]*t[s];return Xt(e)}normalize(){const t=this.magnitude();if(t!==0)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}multiply(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]*=e[s];return this.check()}divide(...t){for(const e of t)for(let s=0;s<this.ELEMENTS;++s)this[s]/=e[s];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(t){return this.distance(t)}distanceToSquared(t){return this.distanceSquared(t)}getComponent(t){return Fr(t>=0&&t<this.ELEMENTS,"index is out of range"),Xt(this[t])}setComponent(t,e){return Fr(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}addVectors(t,e){return this.copy(t).add(e)}subVectors(t,e){return this.copy(t).subtract(e)}multiplyVectors(t,e){return this.copy(t).multiply(e)}addScaledVector(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}}let On=typeof Float32Array<"u"?Float32Array:Array;function Sl(){const n=new On(2);return On!=Float32Array&&(n[0]=0,n[1]=0),n}function Tl(n,t,e){const s=t[0],r=t[1];return n[0]=e[0]*s+e[3]*r+e[6],n[1]=e[1]*s+e[4]*r+e[7],n}(function(){const n=Sl();return function(t,e,s,r,i,o){let h,m;for(e||(e=2),s||(s=0),r?m=Math.min(r*e+s,t.length):m=t.length,h=s;h<m;h+=e)n[0]=t[h],n[1]=t[h+1],i(n,n,o),t[h]=n[0],t[h+1]=n[1];return t}})();function Fl(n,t,e){const s=t[0],r=t[1],i=t[2],o=e[3]*s+e[7]*r+e[11]*i||1;return n[0]=(e[0]*s+e[4]*r+e[8]*i)/o,n[1]=(e[1]*s+e[5]*r+e[9]*i)/o,n[2]=(e[2]*s+e[6]*r+e[10]*i)/o,n}function Il(n,t,e){const s=t[0],r=t[1];return n[0]=e[0]*s+e[2]*r,n[1]=e[1]*s+e[3]*r,n[2]=t[2],n}function vl(n,t,e){const s=t[0],r=t[1],i=t[2];return n[0]=e[0]*s+e[3]*r+e[6]*i,n[1]=e[1]*s+e[4]*r+e[7]*i,n[2]=e[2]*s+e[5]*r+e[8]*i,n[3]=t[3],n}function Rl(){const n=new On(3);return On!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Gl(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function Ol(n,t,e){const s=t[0],r=t[1],i=t[2],o=e[0],h=e[1],m=e[2];return n[0]=r*m-i*h,n[1]=i*o-s*m,n[2]=s*h-r*o,n}function Pl(n,t,e){const s=t[0],r=t[1],i=t[2];let o=e[3]*s+e[7]*r+e[11]*i+e[15];return o=o||1,n[0]=(e[0]*s+e[4]*r+e[8]*i+e[12])/o,n[1]=(e[1]*s+e[5]*r+e[9]*i+e[13])/o,n[2]=(e[2]*s+e[6]*r+e[10]*i+e[14])/o,n}function Hi(n,t,e){const s=t[0],r=t[1],i=t[2];return n[0]=s*e[0]+r*e[3]+i*e[6],n[1]=s*e[1]+r*e[4]+i*e[7],n[2]=s*e[2]+r*e[5]+i*e[8],n}function Ul(n,t,e){const s=e[0],r=e[1],i=e[2],o=e[3],h=t[0],m=t[1],g=t[2];let w=r*g-i*m,M=i*h-s*g,S=s*m-r*h,T=r*S-i*M,P=i*w-s*S,H=s*M-r*w;const N=o*2;return w*=N,M*=N,S*=N,T*=2,P*=2,H*=2,n[0]=h+w+T,n[1]=m+M+P,n[2]=g+S+H,n}function Ll(n,t,e,s){const r=[],i=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],i[0]=r[0],i[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),i[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Hl(n,t,e,s){const r=[],i=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],i[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),i[1]=r[1],i[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Nl(n,t,e,s){const r=[],i=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],i[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),i[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),i[2]=r[2],n[0]=i[0]+e[0],n[1]=i[1]+e[1],n[2]=i[2]+e[2],n}function Jl(n,t){const e=n[0],s=n[1],r=n[2],i=t[0],o=t[1],h=t[2],m=Math.sqrt((e*e+s*s+r*r)*(i*i+o*o+h*h)),g=m&&Gl(n,t)/m;return Math.acos(Math.min(Math.max(g,-1),1))}(function(){const n=Rl();return function(t,e,s,r,i,o){let h,m;for(e||(e=3),s||(s=0),r?m=Math.min(r*e+s,t.length):m=t.length,h=s;h<m;h+=e)n[0]=t[h],n[1]=t[h+1],n[2]=t[h+2],i(n,n,o),t[h]=n[0],t[h+1]=n[1],t[h+2]=n[2];return t}})();const ds=[0,0,0];let bn;class Js extends Dl{static get ZERO(){return bn||(bn=new Js(0,0,0),Object.freeze(bn)),bn}constructor(t=0,e=0,s=0){super(-0,-0,-0),arguments.length===1&&Gn(t)?this.copy(t):(te.debug&&(Xt(t),Xt(e),Xt(s)),this[0]=t,this[1]=e,this[2]=s)}set(t,e,s){return this[0]=t,this[1]=e,this[2]=s,this.check()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}fromObject(t){return te.debug&&(Xt(t.x),Xt(t.y),Xt(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}toObject(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}get ELEMENTS(){return 3}get z(){return this[2]}set z(t){this[2]=Xt(t)}angle(t){return Jl(this,t)}cross(t){return Ol(this,this,t),this.check()}rotateX({radians:t,origin:e=ds}){return Ll(this,this,e,t),this.check()}rotateY({radians:t,origin:e=ds}){return Hl(this,this,e,t),this.check()}rotateZ({radians:t,origin:e=ds}){return Nl(this,this,e,t),this.check()}transform(t){return this.transformAsPoint(t)}transformAsPoint(t){return Pl(this,this,t),this.check()}transformAsVector(t){return Fl(this,this,t),this.check()}transformByMatrix3(t){return Hi(this,this,t),this.check()}transformByMatrix2(t){return Il(this,this,t),this.check()}transformByQuaternion(t){return Ul(this,this,t),this.check()}}class kl extends Li{toString(){let t="[";if(te.printRowMajor){t+="row-major:";for(let e=0;e<this.RANK;++e)for(let s=0;s<this.RANK;++s)t+=` ${this[s*this.RANK+e]}`}else{t+="column-major:";for(let e=0;e<this.ELEMENTS;++e)t+=` ${this[e]}`}return t+="]",t}getElementIndex(t,e){return e*this.RANK+t}getElement(t,e){return this[e*this.RANK+t]}setElement(t,e,s){return this[e*this.RANK+t]=Xt(s),this}getColumn(t,e=new Array(this.RANK).fill(-0)){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)e[r]=this[s+r];return e}setColumn(t,e){const s=t*this.RANK;for(let r=0;r<this.RANK;++r)this[s+r]=e[r];return this}}function zl(n,t){if(n===t){const e=t[1],s=t[2],r=t[5];n[1]=t[3],n[2]=t[6],n[3]=e,n[5]=t[7],n[6]=s,n[7]=r}else n[0]=t[0],n[1]=t[3],n[2]=t[6],n[3]=t[1],n[4]=t[4],n[5]=t[7],n[6]=t[2],n[7]=t[5],n[8]=t[8];return n}function Vl(n,t){const e=t[0],s=t[1],r=t[2],i=t[3],o=t[4],h=t[5],m=t[6],g=t[7],w=t[8],M=w*o-h*g,S=-w*i+h*m,T=g*i-o*m;let P=e*M+s*S+r*T;return P?(P=1/P,n[0]=M*P,n[1]=(-w*s+r*g)*P,n[2]=(h*s-r*o)*P,n[3]=S*P,n[4]=(w*e-r*m)*P,n[5]=(-h*e+r*i)*P,n[6]=T*P,n[7]=(-g*e+s*m)*P,n[8]=(o*e-s*i)*P,n):null}function jl(n){const t=n[0],e=n[1],s=n[2],r=n[3],i=n[4],o=n[5],h=n[6],m=n[7],g=n[8];return t*(g*i-o*m)+e*(-g*r+o*h)+s*(m*r-i*h)}function Ir(n,t,e){const s=t[0],r=t[1],i=t[2],o=t[3],h=t[4],m=t[5],g=t[6],w=t[7],M=t[8],S=e[0],T=e[1],P=e[2],H=e[3],N=e[4],V=e[5],Q=e[6],G=e[7],j=e[8];return n[0]=S*s+T*o+P*g,n[1]=S*r+T*h+P*w,n[2]=S*i+T*m+P*M,n[3]=H*s+N*o+V*g,n[4]=H*r+N*h+V*w,n[5]=H*i+N*m+V*M,n[6]=Q*s+G*o+j*g,n[7]=Q*r+G*h+j*w,n[8]=Q*i+G*m+j*M,n}function Kl(n,t,e){const s=t[0],r=t[1],i=t[2],o=t[3],h=t[4],m=t[5],g=t[6],w=t[7],M=t[8],S=e[0],T=e[1];return n[0]=s,n[1]=r,n[2]=i,n[3]=o,n[4]=h,n[5]=m,n[6]=S*s+T*o+g,n[7]=S*r+T*h+w,n[8]=S*i+T*m+M,n}function Wl(n,t,e){const s=t[0],r=t[1],i=t[2],o=t[3],h=t[4],m=t[5],g=t[6],w=t[7],M=t[8],S=Math.sin(e),T=Math.cos(e);return n[0]=T*s+S*o,n[1]=T*r+S*h,n[2]=T*i+S*m,n[3]=T*o-S*s,n[4]=T*h-S*r,n[5]=T*m-S*i,n[6]=g,n[7]=w,n[8]=M,n}function vr(n,t,e){const s=e[0],r=e[1];return n[0]=s*t[0],n[1]=s*t[1],n[2]=s*t[2],n[3]=r*t[3],n[4]=r*t[4],n[5]=r*t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n}function Xl(n,t){const e=t[0],s=t[1],r=t[2],i=t[3],o=e+e,h=s+s,m=r+r,g=e*o,w=s*o,M=s*h,S=r*o,T=r*h,P=r*m,H=i*o,N=i*h,V=i*m;return n[0]=1-M-P,n[3]=w-V,n[6]=S+N,n[1]=w+V,n[4]=1-g-P,n[7]=T-H,n[2]=S-N,n[5]=T+H,n[8]=1-g-M,n}var Ms;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL1ROW0=3]="COL1ROW0",n[n.COL1ROW1=4]="COL1ROW1",n[n.COL1ROW2=5]="COL1ROW2",n[n.COL2ROW0=6]="COL2ROW0",n[n.COL2ROW1=7]="COL2ROW1",n[n.COL2ROW2=8]="COL2ROW2"})(Ms||(Ms={}));const Ql=Object.freeze([1,0,0,0,1,0,0,0,1]);class hn extends kl{static get IDENTITY(){return $l()}static get ZERO(){return Yl()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Ms}constructor(t,...e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(t)?this.copy(t):e.length>0?this.copy([t,...e]):this.identity()}copy(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}identity(){return this.copy(Ql)}fromObject(t){return this.check()}fromQuaternion(t){return Xl(this,t),this.check()}set(t,e,s,r,i,o,h,m,g){return this[0]=t,this[1]=e,this[2]=s,this[3]=r,this[4]=i,this[5]=o,this[6]=h,this[7]=m,this[8]=g,this.check()}setRowMajor(t,e,s,r,i,o,h,m,g){return this[0]=t,this[1]=r,this[2]=h,this[3]=e,this[4]=i,this[5]=m,this[6]=s,this[7]=o,this[8]=g,this.check()}determinant(){return jl(this)}transpose(){return zl(this,this),this.check()}invert(){return Vl(this,this),this.check()}multiplyLeft(t){return Ir(this,t,this),this.check()}multiplyRight(t){return Ir(this,this,t),this.check()}rotate(t){return Wl(this,this,t),this.check()}scale(t){return Array.isArray(t)?vr(this,this,t):vr(this,this,[t,t]),this.check()}translate(t){return Kl(this,this,t),this.check()}transform(t,e){let s;switch(t.length){case 2:s=Tl(e||[-0,-0],t,this);break;case 3:s=Hi(e||[-0,-0,-0],t,this);break;case 4:s=vl(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return El(s,t.length),s}transformVector(t,e){return this.transform(t,e)}transformVector2(t,e){return this.transform(t,e)}transformVector3(t,e){return this.transform(t,e)}}let Cn,xn=null;function Yl(){return Cn||(Cn=new hn([0,0,0,0,0,0,0,0,0]),Object.freeze(Cn)),Cn}function $l(){return xn||(xn=new hn,Object.freeze(xn)),xn}const Qn="KHR_texture_transform",ql=Qn,Mn=new Js,Zl=new hn,tf=new hn;async function ef(n,t){var i;if(!new mt(n).hasExtension(Qn)||!((i=t.gltf)!=null&&i.loadBuffers))return;const r=n.json.materials||[];for(let o=0;o<r.length;o++)nf(o,n)}function nf(n,t){var i,o,h,m;const e=(i=t.json.materials)==null?void 0:i[n],s=[(o=e==null?void 0:e.pbrMetallicRoughness)==null?void 0:o.baseColorTexture,e==null?void 0:e.emissiveTexture,e==null?void 0:e.normalTexture,e==null?void 0:e.occlusionTexture,(h=e==null?void 0:e.pbrMetallicRoughness)==null?void 0:h.metallicRoughnessTexture],r=[];for(const g of s)g&&((m=g==null?void 0:g.extensions)!=null&&m[Qn])&&sf(t,n,g,r)}function sf(n,t,e,s){const r=rf(e,s);if(!r)return;const i=n.json.meshes||[];for(const o of i)for(const h of o.primitives){const m=h.material;Number.isFinite(m)&&t===m&&of(n,h,r)}}function rf(n,t){var o;const e=(o=n.extensions)==null?void 0:o[Qn],{texCoord:s=0}=n,{texCoord:r=s}=e;if(!(t.findIndex(([h,m])=>h===s&&m===r)!==-1)){const h=hf(e);return s!==r&&(n.texCoord=r),t.push([s,r]),{originalTexCoord:s,texCoord:r,matrix:h}}return null}function of(n,t,e){var h,m;const{originalTexCoord:s,texCoord:r,matrix:i}=e,o=t.attributes[`TEXCOORD_${s}`];if(Number.isFinite(o)){const g=(h=n.json.accessors)==null?void 0:h[o];if(g&&g.bufferView){const w=(m=n.json.bufferViews)==null?void 0:m[g.bufferView];if(w){const{arrayBuffer:M,byteOffset:S}=n.buffers[w.buffer],T=(S||0)+(g.byteOffset||0)+(w.byteOffset||0),{ArrayType:P,length:H}=xi(g,w),N=bi[g.componentType],V=wi[g.type],Q=w.byteStride||N*V,G=new Float32Array(H);for(let j=0;j<g.count;j++){const ct=new P(M,T+j*Q,2);Mn.set(ct[0],ct[1],1),Mn.transformByMatrix3(i),G.set([Mn[0],Mn[1]],j*V)}s===r?af(g,w,n.buffers,G):cf(r,g,t,n,G)}}}}function af(n,t,e,s){n.componentType=5126,e.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength}),t.buffer=e.length-1,t.byteLength=s.buffer.byteLength,t.byteOffset=0,delete t.byteStride}function cf(n,t,e,s,r){s.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const i=s.json.bufferViews;if(!i)return;i.push({buffer:s.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const o=s.json.accessors;o&&(o.push({bufferView:(i==null?void 0:i.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),e.attributes[`TEXCOORD_${n}`]=o.length-1)}function hf(n){const{offset:t=[0,0],rotation:e=0,scale:s=[1,1]}=n,r=new hn().set(1,0,0,0,1,0,t[0],t[1],1),i=Zl.set(Math.cos(e),Math.sin(e),0,-Math.sin(e),Math.cos(e),0,0,0,1),o=tf.set(s[0],0,0,0,s[1],0,0,0,1);return r.multiplyRight(i).multiplyRight(o)}const uf=Object.freeze(Object.defineProperty({__proto__:null,decode:ef,name:ql},Symbol.toStringTag,{value:"Module"})),Me="KHR_lights_punctual",lf=Me;async function ff(n){const t=new mt(n),{json:e}=t,s=t.getExtension(Me);s&&(t.json.lights=s.lights,t.removeExtension(Me));for(const r of e.nodes||[]){const i=t.getObjectExtension(r,Me);i&&(r.light=i.light),t.removeObjectExtension(r,Me)}}async function df(n){const t=new mt(n),{json:e}=t;if(e.lights){const s=t.addExtension(Me);qt(!s.lights),s.lights=e.lights,delete e.lights}if(t.json.lights){for(const s of t.json.lights){const r=s.node;t.addObjectExtension(r,Me,s)}delete t.json.lights}}const pf=Object.freeze(Object.defineProperty({__proto__:null,decode:ff,encode:df,name:lf},Symbol.toStringTag,{value:"Module"})),rn="KHR_materials_unlit",Af=rn;async function mf(n){const t=new mt(n),{json:e}=t;for(const s of e.materials||[])s.extensions&&s.extensions.KHR_materials_unlit&&(s.unlit=!0),t.removeObjectExtension(s,rn);t.removeExtension(rn)}function gf(n){const t=new mt(n),{json:e}=t;if(t.materials)for(const s of e.materials||[])s.unlit&&(delete s.unlit,t.addObjectExtension(s,rn,{}),t.addExtension(rn))}const Bf=Object.freeze(Object.defineProperty({__proto__:null,decode:mf,encode:gf,name:Af},Symbol.toStringTag,{value:"Module"})),$e="KHR_techniques_webgl",yf=$e;async function wf(n){const t=new mt(n),{json:e}=t,s=t.getExtension($e);if(s){const r=Cf(s,t);for(const i of e.materials||[]){const o=t.getObjectExtension(i,$e);o&&(i.technique=Object.assign({},o,r[o.technique]),i.technique.values=xf(i.technique,t)),t.removeObjectExtension(i,$e)}t.removeExtension($e)}}async function bf(n,t){}function Cf(n,t){const{programs:e=[],shaders:s=[],techniques:r=[]}=n,i=new TextDecoder;return s.forEach(o=>{if(Number.isFinite(o.bufferView))o.code=i.decode(t.getTypedArrayForBufferView(o.bufferView));else throw new Error("KHR_techniques_webgl: no shader code")}),e.forEach(o=>{o.fragmentShader=s[o.fragmentShader],o.vertexShader=s[o.vertexShader]}),r.forEach(o=>{o.program=e[o.program]}),r}function xf(n,t){const e=Object.assign({},n.values);return Object.keys(n.uniforms||{}).forEach(s=>{n.uniforms[s].value&&!(s in e)&&(e[s]=n.uniforms[s].value)}),Object.keys(e).forEach(s=>{typeof e[s]=="object"&&e[s].index!==void 0&&(e[s].texture=t.getTexture(e[s].index))}),e}const Mf=Object.freeze(Object.defineProperty({__proto__:null,decode:wf,encode:bf,name:yf},Symbol.toStringTag,{value:"Module"})),Ni=[vh,sh,Uu,Nu,zu,bl,pf,Bf,Mf,uf,Qh];function _f(n,t={},e){var r;const s=Ni.filter(i=>Ji(i.name,t));for(const i of s)(r=i.preprocess)==null||r.call(i,n,t,e)}async function Ef(n,t={},e){var r;const s=Ni.filter(i=>Ji(i.name,t));for(const i of s)await((r=i.decode)==null?void 0:r.call(i,n,t,e))}function Ji(n,t){var r;const e=((r=t==null?void 0:t.gltf)==null?void 0:r.excludeExtensions)||{};return!(n in e&&!e[n])}const ps="KHR_binary_glTF";function Df(n){const t=new mt(n),{json:e}=t;for(const s of e.images||[]){const r=t.getObjectExtension(s,ps);r&&Object.assign(s,r),t.removeObjectExtension(s,ps)}e.buffers&&e.buffers[0]&&delete e.buffers[0].uri,t.removeExtension(ps)}const Rr={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},Sf={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class Tf{constructor(){U(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}});U(this,"json")}normalize(t,e){this.json=t.json;const s=t.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${s.asset.version}`);return}if(!e.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),Df(t),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(t){t.asset=t.asset||{},t.asset.version="2.0",t.asset.generator=t.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(t){for(const e in Rr)this._convertTopLevelObjectToArray(t,e)}_convertTopLevelObjectToArray(t,e){const s=t[e];if(!(!s||Array.isArray(s))){t[e]=[];for(const r in s){const i=s[r];i.id=i.id||r;const o=t[e].length;t[e].push(i),this.idToIndexMap[e][r]=o}}}_convertObjectIdsToArrayIndices(t){for(const e in Rr)this._convertIdsToIndices(t,e);"scene"in t&&(t.scene=this._convertIdToIndex(t.scene,"scene"));for(const e of t.textures)this._convertTextureIds(e);for(const e of t.meshes)this._convertMeshIds(e);for(const e of t.nodes)this._convertNodeIds(e);for(const e of t.scenes)this._convertSceneIds(e)}_convertTextureIds(t){t.source&&(t.source=this._convertIdToIndex(t.source,"image"))}_convertMeshIds(t){for(const e of t.primitives){const{attributes:s,indices:r,material:i}=e;for(const o in s)s[o]=this._convertIdToIndex(s[o],"accessor");r&&(e.indices=this._convertIdToIndex(r,"accessor")),i&&(e.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(t){t.children&&(t.children=t.children.map(e=>this._convertIdToIndex(e,"node"))),t.meshes&&(t.meshes=t.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(t){t.nodes&&(t.nodes=t.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(t,e){t[e]||(console.warn(`gltf v1: json doesn't contain attribute ${e}`),t[e]=[]);for(const s of t[e])for(const r in s){const i=s[r],o=this._convertIdToIndex(i,r);s[r]=o}}_convertIdToIndex(t,e){const s=Sf[e];if(s in this.idToIndexMap){const r=this.idToIndexMap[s][t];if(!Number.isFinite(r))throw new Error(`gltf v1: failed to resolve ${e} with id ${t}`);return r}return t}_updateObjects(t){for(const e of this.json.buffers)delete e.type}_updateMaterial(t){var e,s,r;for(const i of t.materials){i.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const o=((e=i.values)==null?void 0:e.tex)||((s=i.values)==null?void 0:s.texture2d_0)||((r=i.values)==null?void 0:r.diffuseTex),h=t.textures.findIndex(m=>m.id===o);h!==-1&&(i.pbrMetallicRoughness.baseColorTexture={index:h})}}}function Ff(n,t={}){return new Tf().normalize(n,t)}async function If(n,t,e=0,s,r){var i,o,h;return vf(n,t,e,s),Ff(n,{normalize:(i=s==null?void 0:s.gltf)==null?void 0:i.normalize}),_f(n,s,r),(o=s==null?void 0:s.gltf)!=null&&o.loadBuffers&&n.json.buffers&&await Rf(n,s,r),(h=s==null?void 0:s.gltf)!=null&&h.loadImages&&await Gf(n,s,r),await Ef(n,s,r),n}function vf(n,t,e,s){if(s.uri&&(n.baseUri=s.uri),t instanceof ArrayBuffer&&!Bu(t,e,s)&&(t=new TextDecoder().decode(t)),typeof t=="string")n.json=ja(t);else if(t instanceof ArrayBuffer){const o={};e=yu(o,t,e,s.glb),qt(o.type==="glTF",`Invalid GLB magic string ${o.type}`),n._glb=o,n.json=o.json}else qt(!1,"GLTF: must be ArrayBuffer or string");const r=n.json.buffers||[];if(n.buffers=new Array(r.length).fill(null),n._glb&&n._glb.header.hasBinChunk){const{binChunks:o}=n._glb;n.buffers[0]={arrayBuffer:o[0].arrayBuffer,byteOffset:o[0].byteOffset,byteLength:o[0].byteLength}}const i=n.json.images||[];n.images=new Array(i.length).fill({})}async function Rf(n,t,e){var r,i;const s=n.json.buffers||[];for(let o=0;o<s.length;++o){const h=s[o];if(h.uri){const{fetch:m}=e;qt(m);const g=Ri(h.uri,t),w=await((r=e==null?void 0:e.fetch)==null?void 0:r.call(e,g)),M=await((i=w==null?void 0:w.arrayBuffer)==null?void 0:i.call(w));n.buffers[o]={arrayBuffer:M,byteOffset:0,byteLength:M.byteLength},delete h.uri}else n.buffers[o]===null&&(n.buffers[o]={arrayBuffer:new ArrayBuffer(h.byteLength),byteOffset:0,byteLength:h.byteLength})}}async function Gf(n,t,e){const s=Of(n),r=n.json.images||[],i=[];for(const o of s)i.push(Pf(n,r[o],o,t,e));return await Promise.all(i)}function Of(n){const t=new Set,e=n.json.textures||[];for(const s of e)s.source!==void 0&&t.add(s.source);return Array.from(t).sort()}async function Pf(n,t,e,s,r){let i;if(t.uri&&!t.hasOwnProperty("bufferView")){const h=Ri(t.uri,s),{fetch:m}=r;i=await(await m(h)).arrayBuffer(),t.bufferView={data:i}}if(Number.isFinite(t.bufferView)){const h=kc(n.json,n.buffers,t.bufferView);i=pi(h.buffer,h.byteOffset,h.byteLength)}qt(i,"glTF image has no data");let o=await ai(i,[vc,lu],{...s,mimeType:t.mimeType,basis:s.basis||{format:vi()}},r);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),n.images=n.images||[],n.images[e]=o}const Pn={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:Yh,extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:Uf,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function Uf(n,t={},e){t={...Pn.options,...t},t.gltf={...Pn.options.gltf,...t.gltf};const{byteOffset:s=0}=t;return await If({},n,s,t,e)}const Lf=n=>typeof n=="boolean",Ze=n=>typeof n=="function",un=n=>n!==null&&typeof n=="object",Gr=n=>un(n)&&n.constructor==={}.constructor,Hf=n=>!!n&&typeof n[Symbol.iterator]=="function",Nf=n=>n&&typeof n[Symbol.asyncIterator]=="function",Te=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Fe=n=>typeof Blob<"u"&&n instanceof Blob,Jf=n=>n&&typeof n=="object"&&n.isBuffer,kf=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||un(n)&&Ze(n.tee)&&Ze(n.cancel)&&Ze(n.getReader),zf=n=>un(n)&&Ze(n.read)&&Ze(n.pipe)&&Lf(n.readable),ki=n=>kf(n)||zf(n);class Vf extends Error{constructor(e,s){super(e);U(this,"reason");U(this,"url");U(this,"response");this.reason=s.reason,this.url=s.url,this.response=s.response}}const jf=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Kf=/^([-\w.]+\/[-\w.+]+)/;function Or(n,t){return n.toLowerCase()===t.toLowerCase()}function Wf(n){const t=Kf.exec(n);return t?t[1]:n}function Pr(n){const t=jf.exec(n);return t?t[1]:""}const zi=/\?.*/;function Xf(n){const t=n.match(zi);return t&&t[0]}function ks(n){return n.replace(zi,"")}function Qf(n){if(n.length<50)return n;const t=n.slice(n.length-15);return`${n.substr(0,32)}...${t}`}function Yn(n){return Te(n)?n.url:Fe(n)?n.name||"":typeof n=="string"?n:""}function zs(n){if(Te(n)){const t=n,e=t.headers.get("content-type")||"",s=ks(t.url);return Wf(e)||Pr(s)}return Fe(n)?n.type||"":typeof n=="string"?Pr(n):""}function Yf(n){return Te(n)?n.headers["content-length"]||-1:Fe(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function Vi(n){if(Te(n))return n;const t={},e=Yf(n);e>=0&&(t["content-length"]=String(e));const s=Yn(n),r=zs(n);r&&(t["content-type"]=r);const i=await Zf(n);i&&(t["x-first-bytes"]=i),typeof n=="string"&&(n=new TextEncoder().encode(n));const o=new Response(n,{headers:t});return Object.defineProperty(o,"url",{value:s}),o}async function $f(n){if(!n.ok)throw await qf(n)}async function qf(n){const t=Qf(n.url);let e=`Failed to fetch resource (${n.status}) ${n.statusText}: ${t}`;e=e.length>100?`${e.slice(0,100)}...`:e;const s={reason:n.statusText,url:n.url,response:n};try{const r=n.headers.get("Content-Type");s.reason=!n.bodyUsed&&(r!=null&&r.includes("application/json"))?await n.json():await n.text()}catch{}return new Vf(e,s)}async function Zf(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const e=n.slice(0,5);return await new Promise(s=>{const r=new FileReader;r.onload=i=>{var o;return s((o=i==null?void 0:i.target)==null?void 0:o.result)},r.readAsDataURL(e)})}if(n instanceof ArrayBuffer){const e=n.slice(0,5);return`data:base64,${td(e)}`}return null}function td(n){let t="";const e=new Uint8Array(n);for(let s=0;s<e.byteLength;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function ed(n){return!nd(n)&&!sd(n)}function nd(n){return n.startsWith("http:")||n.startsWith("https:")}function sd(n){return n.startsWith("data:")}async function Ur(n,t){var e,s;if(typeof n=="string"){const r=qa(n);return ed(r)&&(e=globalThis.loaders)!=null&&e.fetchNode?(s=globalThis.loaders)==null?void 0:s.fetchNode(r,t):await fetch(r,t)}return await Vi(n)}const Lr=new Rs({id:"loaders.gl"});class rd{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class id{constructor(){U(this,"console");this.console=console}log(...t){return this.console.log.bind(this.console,...t)}info(...t){return this.console.info.bind(this.console,...t)}warn(...t){return this.console.warn.bind(this.console,...t)}error(...t){return this.console.error.bind(this.console,...t)}}const ji={fetch:null,mimeType:void 0,nothrow:!1,log:new id,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:jn,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},od={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Ki(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function Wi(){const n=Ki();return n.globalOptions=n.globalOptions||{...ji},n.globalOptions}function ad(n,t,e,s){return e=e||[],e=Array.isArray(e)?e:[e],cd(n,e),ud(t,n,s)}function cd(n,t){Hr(n,null,ji,od,t);for(const e of t){const s=n&&n[e.id]||{},r=e.options&&e.options[e.id]||{},i=e.deprecatedOptions&&e.deprecatedOptions[e.id]||{};Hr(s,e.id,r,i,t)}}function Hr(n,t,e,s,r){const i=t||"Top level",o=t?`${t}.`:"";for(const h in n){const m=!t&&un(n[h]),g=h==="baseUri"&&!t,w=h==="workerUrl"&&t;if(!(h in e)&&!g&&!w){if(h in s)Lr.warn(`${i} loader option '${o}${h}' no longer supported, use '${s[h]}'`)();else if(!m){const M=hd(h,r);Lr.warn(`${i} loader option '${o}${h}' not recognized. ${M}`)()}}}}function hd(n,t){const e=n.toLowerCase();let s="";for(const r of t)for(const i in r.options){if(n===i)return`Did you mean '${r.id}.${i}'?`;const o=i.toLowerCase();(e.startsWith(o)||o.startsWith(e))&&(s=s||`Did you mean '${r.id}.${i}'?`)}return s}function ud(n,t,e){const r={...n.options||{}};return ld(r,e),r.log===null&&(r.log=new rd),Nr(r,Wi()),Nr(r,t),r}function Nr(n,t){for(const e in t)if(e in t){const s=t[e];Gr(s)&&Gr(n[e])?n[e]={...n[e],...t[e]}:n[e]=t[e]}}function ld(n,t){t&&!("baseUri"in n)&&(n.baseUri=t)}function Vs(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n==null?void 0:n.extensions)):!1}function Xi(n){pe(n,"null loader"),pe(Vs(n),"invalid loader");let t;return Array.isArray(n)&&(t=n[1],n=n[0],n={...n,options:{...n.options,...t}}),(n!=null&&n.parseTextSync||n!=null&&n.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const fd=()=>{const n=Ki();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function dd(){return fd()}const pd=/\.([^.]+)$/;async function Ad(n,t=[],e,s){if(!Qi(n))return null;let r=Jr(n,t,{...e,nothrow:!0},s);if(r)return r;if(Fe(n)&&(n=await n.slice(0,10).arrayBuffer(),r=Jr(n,t,e,s)),!r&&!(e!=null&&e.nothrow))throw new Error(Yi(n));return r}function Jr(n,t=[],e,s){if(!Qi(n))return null;if(t&&!Array.isArray(t))return Xi(t);let r=[];t&&(r=r.concat(t)),e!=null&&e.ignoreRegisteredLoaders||r.push(...dd()),gd(r);const i=md(n,r,e,s);if(!i&&!(e!=null&&e.nothrow))throw new Error(Yi(n));return i}function md(n,t,e,s){const r=Yn(n),i=zs(n),o=ks(r)||(s==null?void 0:s.url);let h=null,m="";return e!=null&&e.mimeType&&(h=As(t,e==null?void 0:e.mimeType),m=`match forced by supplied MIME type ${e==null?void 0:e.mimeType}`),h=h||Bd(t,o),m=m||(h?`matched url ${o}`:""),h=h||As(t,i),m=m||(h?`matched MIME type ${i}`:""),h=h||wd(t,n),m=m||(h?`matched initial data ${$i(n)}`:""),e!=null&&e.fallbackMimeType&&(h=h||As(t,e==null?void 0:e.fallbackMimeType),m=m||(h?`matched fallback MIME type ${i}`:"")),m&&ba.log(1,`selectLoader selected ${h==null?void 0:h.name}: ${m}.`),h}function Qi(n){return!(n instanceof Response&&n.status===204)}function Yi(n){const t=Yn(n),e=zs(n);let s="No valid loader found (";s+=t?`${mi(t)}, `:"no url provided, ",s+=`MIME type: ${e?`"${e}"`:"not provided"}, `;const r=n?$i(n):"";return s+=r?` first bytes: "${r}"`:"first bytes: not available",s+=")",s}function gd(n){for(const t of n)Xi(t)}function Bd(n,t){const e=t&&pd.exec(t),s=e&&e[1];return s?yd(n,s):null}function yd(n,t){t=t.toLowerCase();for(const e of n)for(const s of e.extensions)if(s.toLowerCase()===t)return e;return null}function As(n,t){var e;for(const s of n)if((e=s.mimeTypes)!=null&&e.some(r=>Or(t,r))||Or(t,`application/x.${s.id}`))return s;return null}function wd(n,t){if(!t)return null;for(const e of n)if(typeof t=="string"){if(bd(t,e))return e}else if(ArrayBuffer.isView(t)){if(kr(t.buffer,t.byteOffset,e))return e}else if(t instanceof ArrayBuffer&&kr(t,0,e))return e;return null}function bd(n,t){return t.testText?t.testText(n):(Array.isArray(t.tests)?t.tests:[t.tests]).some(s=>n.startsWith(s))}function kr(n,t,e){return(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>Cd(n,t,e,r))}function Cd(n,t,e,s){if(s instanceof ArrayBuffer)return Ka(s,n,s.byteLength);switch(typeof s){case"function":return s(n);case"string":const r=_s(n,t,s.length);return s===r;default:return!1}}function $i(n,t=5){return typeof n=="string"?n.slice(0,t):ArrayBuffer.isView(n)?_s(n.buffer,n.byteOffset,t):n instanceof ArrayBuffer?_s(n,0,t):""}function _s(n,t,e){if(n.byteLength<t+e)return"";const s=new DataView(n);let r="";for(let i=0;i<e;i++)r+=String.fromCharCode(s.getUint8(t+i));return r}const xd=256*1024;function*Md(n,t){const e=(t==null?void 0:t.chunkSize)||xd;let s=0;const r=new TextEncoder;for(;s<n.length;){const i=Math.min(n.length-s,e),o=n.slice(s,s+i);s+=i,yield r.encode(o)}}const _d=256*1024;function*Ed(n,t={}){const{chunkSize:e=_d}=t;let s=0;for(;s<n.byteLength;){const r=Math.min(n.byteLength-s,e),i=new ArrayBuffer(r),o=new Uint8Array(n,s,r);new Uint8Array(i).set(o),s+=r,yield i}}const Dd=1024*1024;async function*Sd(n,t){const e=(t==null?void 0:t.chunkSize)||Dd;let s=0;for(;s<n.size;){const r=s+e,i=await n.slice(s,r).arrayBuffer();s=r,yield i}}function zr(n,t){return jn?Td(n,t):Fd(n)}async function*Td(n,t){const e=n.getReader();let s;try{for(;;){const r=s||e.read();t!=null&&t._streamReadAhead&&(s=e.read());const{done:i,value:o}=await r;if(i)return;yield Ai(o)}}catch{e.releaseLock()}}async function*Fd(n,t){for await(const e of n)yield Ai(e)}function Id(n,t){if(typeof n=="string")return Md(n,t);if(n instanceof ArrayBuffer)return Ed(n,t);if(Fe(n))return Sd(n,t);if(ki(n))return zr(n,t);if(Te(n))return zr(n.body,t);throw new Error("makeIterator")}const qi="Cannot convert supplied data type";function vd(n,t,e){if(t.text&&typeof n=="string")return n;if(Jf(n)&&(n=n.buffer),n instanceof ArrayBuffer){const s=n;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(n)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(n);let s=n.buffer;const r=n.byteLength||n.length;return(n.byteOffset!==0||r!==s.byteLength)&&(s=s.slice(n.byteOffset,n.byteOffset+r)),s}throw new Error(qi)}async function Rd(n,t,e){const s=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||s)return vd(n,t);if(Fe(n)&&(n=await Vi(n)),Te(n)){const r=n;return await $f(r),t.binary?await r.arrayBuffer():await r.text()}if(ki(n)&&(n=Id(n,e)),Hf(n)||Nf(n))return Ya(n);throw new Error(qi)}function Zi(n,t){const e=Wi(),s=n||e;return typeof s.fetch=="function"?s.fetch:un(s.fetch)?r=>Ur(r,s.fetch):t!=null&&t.fetch?t==null?void 0:t.fetch:Ur}function Gd(n,t,e){if(e)return e;const s={fetch:Zi(t,n),...n};if(s.url){const r=ks(s.url);s.baseUrl=r,s.queryString=Xf(s.url),s.filename=mi(r),s.baseUrl=tc(r)}return Array.isArray(s.loaders)||(s.loaders=null),s}function Od(n,t){if(n&&!Array.isArray(n))return n;let e;if(n&&(e=Array.isArray(n)?n:[n]),t&&t.loaders){const s=Array.isArray(t.loaders)?t.loaders:[t.loaders];e=e?[...e,...s]:s}return e&&e.length?e:void 0}async function Un(n,t,e,s){t&&!Array.isArray(t)&&!Vs(t)&&(s=void 0,e=t,t=void 0),n=await n,e=e||{};const r=Yn(n),o=Od(t,s),h=await Ad(n,o,e);return h?(e=ad(e,h,o,r),s=Gd({url:r,_parse:Un,loaders:o},e,s||null),await Pd(h,n,e,s)):null}async function Pd(n,t,e,s){if(Oa(n),e=Ca(n.options,e),Te(t)){const i=t,{ok:o,redirected:h,status:m,statusText:g,type:w,url:M}=i,S=Object.fromEntries(i.headers.entries());s.response={headers:S,ok:o,redirected:h,status:m,statusText:g,type:w,url:M}}t=await Rd(t,n,e);const r=n;if(r.parseTextSync&&typeof t=="string")return r.parseTextSync(t,e,s);if(Ja(n,e))return await ka(n,t,e,s,Un);if(r.parseText&&typeof t=="string")return await r.parseText(t,e,s);if(r.parse)return await r.parse(t,e,s);throw Ae(!r.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}async function Vr(n,t,e,s){let r,i;!Array.isArray(t)&&!Vs(t)?(r=[],i=t):(r=t,i=e);const o=Zi(i);let h=n;return typeof n=="string"&&(h=await o(n)),Fe(n)&&(h=await o(n)),Array.isArray(r)?await Un(h,r,i):await Un(h,r,i)}const Ud=new W,q=new W;new W;const ye=new fe,jr=new L,Kr=new L,Ld=new L,Ye=new W;class to extends Vn{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,t.isInstancedGeometry=!0,this.type="instanced_mesh",this.instanceMatrix=new Float32Array(s*16),this.count=s,this.needsUpdate=!0,e.uniforms[0].uniforms[0].storage("mat4x4f",s),e.uniforms[0].calculateGroupByteSize();for(let r=0;r<s;r++)this.setMatrixAt(Ud,r)}setPositionAt(t,e){this.getMatrixAt(q,e),q.setPosition(t),this.setMatrixAt(q,e)}getPositionAt(t){return this.getMatrixAt(q,t),q.getPosition()}lookAt(t,e){this.getMatrixAt(q,e);const s=q.getPosition();Ye.lookAt(s,t),ye.setFromRotationMatrix(Ye).invert(),q.compose(q.getPosition(),ye,q.getScale()),this.setMatrixAt(q,e)}rotateXAt(t,e){this.getMatrixAt(q,e),q.rotateX(t),this.setMatrixAt(q,e)}rotateYAt(t,e){this.getMatrixAt(q,e),q.rotateY(t),this.setMatrixAt(q,e)}rotateZAt(t,e){this.getMatrixAt(q,e),q.rotateZ(t),this.setMatrixAt(q,e)}setAllPositionsArray(t){for(let e=0;e<this.count;e++)this.getMatrixAt(q,e),q.setPosition(t[e*3],t[e*3+1],t[e*3+2]),q.toArray(this.instanceMatrix,e*16);this.geometry.computeBoundingBox(),this.write(this.instanceMatrix,"instances")}setAllScalesArray(t){for(let e=0;e<this.count;e++)this.getMatrixAt(q,e),q.scale(t[e]),q.toArray(this.instanceMatrix,e*16);this.write(this.instanceMatrix,"instances")}setAllRotationsArray(t){for(let e=0;e<this.count;e++)this.getMatrixAt(q,e),ye.set(t[e*4],t[e*4+1],t[e*4+2],t[e*4+3]),Ye.setFromQuaternion(ye),q.compose(q.getPosition(),ye,q.getScale()),q.toArray(this.instanceMatrix,e*16);this.write(this.instanceMatrix,"instances")}setAllDirectionsArray(t){for(let e=0;e<this.count;e++)this.getMatrixAt(q,e),jr.setFromMatrixPosition(q),Kr.set(t[e*3],t[e*3+1],t[e*3+2]),Ye.lookAt(Kr,Ld),ye.setFromRotationMatrix(Ye).invert(),q.compose(jr,ye,q.getScale()),q.toArray(this.instanceMatrix,e*16);this.write(this.instanceMatrix,"instances")}setScaleAt(t,e){this.getMatrixAt(q,e),q.scale(t),this.setMatrixAt(q,e)}setMatrixAt(t,e){t.toArray(this.instanceMatrix,e*16),this.geometry.computeBoundingBox(),this.write(t.data,"instances",e*16*4)}getMatrixAt(t,e){t.fromArray(this.instanceMatrix,e*16)}}const Hd=(()=>{let n,t;const e={};return function(r,i){t||(t=r.createShaderModule({label:"textured quad shaders for mip level generation",code:`
            struct VSOutput {
              @builtin(position) position: vec4f,
              @location(0) texcoord: vec2f,
            };
 
            @vertex fn vs(
              @builtin(vertex_index) vertexIndex : u32
            ) -> VSOutput {
              let pos = array(
                // 1st triangle
                vec2f( 0.0,  0.0),  // center
                vec2f( 1.0,  0.0),  // right, center
                vec2f( 0.0,  1.0),  // center, top
 
                // 2nd triangle
                vec2f( 0.0,  1.0),  // center, top
                vec2f( 1.0,  0.0),  // right, center
                vec2f( 1.0,  1.0),  // right, top
              );
 
              var vsOutput: VSOutput;
              let xy = pos[vertexIndex];
              vsOutput.position = vec4f(xy * 2.0 - 1.0, 0.0, 1.0);
              vsOutput.texcoord = vec2f(xy.x, 1.0 - xy.y);
              return vsOutput;
            }
 
            @group(0) @binding(0) var ourSampler: sampler;
            @group(0) @binding(1) var ourTexture: texture_2d<f32>;
 
            @fragment fn fs(fsInput: VSOutput) -> @location(0) vec4f {
              return textureSample(ourTexture, ourSampler, fsInput.texcoord);
            }
          `}),n=r.createSampler({minFilter:"linear",magFilter:"linear",addressModeU:"repeat"})),e[i.format]||(e[i.format]=r.createRenderPipeline({label:"mip level generator pipeline",layout:"auto",vertex:{module:t},fragment:{module:t,targets:[{format:i.format}]}}));const o=e[i.format],h=r.createCommandEncoder({label:"mip gen encoder"});let m=i.width,g=i.height,w=0;for(;m>1||g>1;){m=Math.max(1,m/2|0),g=Math.max(1,g/2|0);const S=r.createBindGroup({layout:o.getBindGroupLayout(0),entries:[{binding:0,resource:n},{binding:1,resource:i.createView({baseMipLevel:w,mipLevelCount:1})}]});++w;const T={label:"our basic canvas renderPass",colorAttachments:[{view:i.createView({baseMipLevel:w,mipLevelCount:1}),loadOp:"clear",storeOp:"store"}]},P=h.beginRenderPass(T);P.setPipeline(o),P.setBindGroup(0,S),P.draw(6),P.end()}const M=h.finish();r.queue.submit([M])}})();class Nd{constructor(t){U(this,"generateMips",t=>{let e,s;return function(){if(!e){const w=this.device.createShaderModule({label:"texture quad shaders for mip level",code:`
                        struct VertexOutput {
                            @builtin position : vec4f,
                            @location(0) uv : vec2f,
                        }
                        
                        @vertex
                        fn vert(@builtin(vertex_index) vertexIndex: u32) -> VertexOutput {
                            var pos = array<vec2f, 6>(
                                vec2<f32>(-1.0, 1.0),
                                vec2<f32>(1.0, -1.0),
                                vec2<f32>(-1.0, -1.0),
                                vec2<f32>(-1.0, 1.0),
                                vec2<f32>(1.0, 1.0),
                                vec2<f32>(1.0, -1.0)
                            );
                            
                            var output: VertexOutput;
                            let xy = pos[vertexIndex];
                            output.position = vec4f(xy, 0.0, 1.0);
                            output.uv = (xy.x, 1.0 - xy.y);
                            return output;
                        }
                        
                        @group @binding(0) var sampler2D: sampler;
                        @group @binding(1) var texture: texture_2d<f32>;
                        @fragment
                        fn frag(input: VertexOutput) -> vec4<f32> {
                            return textureSample(texture, sampler2D, input.uv);
                        }
                    `});e=this.device.createRenderPipeline({label:"mip level generator pipeline",layout:"auto",vertex:{module:w},fragment:{module:w,targets:[{format:t.format}]}}),s=this.device.createSampler({minFilter:"linear"})}const i=this.device.createCommandEncoder();let o=t.width,h=t.height,m=0;for(;o>1||h>1;){o=Math.max(1,o/2|0),h=Math.max(1,h/2|0);const w=this.device.createBindGroup({layout:e.getBindGroupLayout(0),entries:[{binding:0,resource:s},{binding:1,resource:t.createView({baseMipLevel:m,mipLevelCount:1})}]});m++;const M={label:"mip level render pass",colorAttachments:[{view:t.createView({baseMipLevel:m,mipLevelCount:1}),clearValue:[0,0,0,1],loadOp:"clear",storeOp:"store"}]},S=i.beginRenderPass(M);S.setPipeline(e),S.setBindGroup(0,w),S.draw(6),S.end()}const g=i.finish();this.device.queue.submit([g])}});this.renderer=t,this.device=t.device}async getBitmap(t){const s=await(await fetch(t)).blob();return await createImageBitmap(s,{colorSpaceConversion:"none"})}async load(t,e={rotateY:!1}){const s=await this.getBitmap(t);return this.createTexture(s,{mips:!0,url:t})}async loadFromBlob(t){const e=await createImageBitmap(t,{colorSpaceConversion:"none"});return this.createTexture(e,{mips:!0})}numMipLevels(...t){const e=Math.max(...t);return 1+Math.log2(e)|0}createTexture(t,e={}){const s=this.device.createTexture({format:"rgba8unorm",size:[t.width,t.height],mipLevelCount:e.mips?this.numMipLevels(t.width,t.height):1,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT});return this.device.queue.copyExternalImageToTexture({source:t},{texture:s},[t.width,t.height]),s.mipLevelCount>1&&Hd(this.device,s),s}}class Es extends de{constructor(){super(),this.type="Bone",this.isBone=!0,this.inverseBindMatrix=new W,this.bindMatrix=new W}}const Wr=new W;new W;new W;class js{constructor(t,e){this.bones=t.slice(0),this.boneInverses=e.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),this.globalMatrixInverse=new W,this.inverseBindMatrices=new Float32Array(this.boneInverses.length*16);for(let s=0;s<this.boneInverses.length;s++)this.inverseBindMatrices.set(this.boneInverses[s].data,s*16);this.boneTexture=null}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const s=new W;this.bones[t]&&(this.bones[t].updateMatrixWorld(!0),s.copy(this.bones[t].matrixWorld).invert()),this.boneInverses.push(s),this.inverseBindMatrices.set(s.data,t*16)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&s.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const s=this.bones[t];s&&(s.parent&&s.parent.isBone?(s.matrix.copy(s.parent.matrixWorld).invert(),s.matrix.multiply(s.matrixWorld)):s.matrix.copy(s.matrixWorld),s.matrix.decompose(s.position,s.quaternion,s.scale))}}update(t){const e=this.bones;this.boneInverses;const s=this.boneMatrices,r=this.boneTexture;this.globalMatrixInverse.copy(t);for(let i=0;i<e.length;i++){const o=e[i];Wr.multiplyMatrices(this.globalMatrixInverse,o.matrixWorld),s.set(Wr.data,i*16)}r!==null&&(r.needsUpdate=!0)}clone(){return new js(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const s=new DataTexture(e,t,t,RGBAFormat,FloatType);return s.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=s,this}getBoneByName(t){for(let e=0,s=this.bones.length;e<s;e++){const r=this.bones[e];if(r.name===t)return r}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let s=0,r=t.bones.length;s<r;s++){const i=t.bones[s];let o=e[i];o===void 0&&(console.warn("Skeleton: No bone found with UUID:",i),o=new Es),this.bones.push(o),this.boneInverses.push(new W().fromArray(t.boneInverses[s]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,s=this.boneInverses;for(let r=0,i=e.length;r<i;r++){const o=e[r];t.bones.push(o.uuid);const h=s[r];t.boneInverses.push(h.toArray())}return t}}const be=class be{constructor(t=0,e=0,s=0,r=0){this.data=new Float32Array([t,e,s,r]),this.needsUpdate=!1,this.isVector4=!0,ht.create(t,e,s,r,this.data)}get width(){return this.data[3]}set width(t){this.data[3]=t,this._onChangeCallback()}get height(){return this.data[4]}set height(t){this.data[4]=t,this._onChangeCallback()}get x(){return this.data[0]}set x(t){this.data[0]=t,this._onChangeCallback()}get y(){return this.data[1]}set y(t){this.data[1]=t,this._onChangeCallback()}get z(){return this.data[2]}set z(t){this.data[2]=t,this._onChangeCallback()}set w(t){this.data[3]=t,this._onChangeCallback()}get w(){return this.data[3]}setX(t){return this.data[0]=t,this._onChangeCallback(),this}setY(t){return this.data[1]=t,this._onChangeCallback(),this}setZ(t){return this.data[2]=t,this._onChangeCallback(),this}setW(t){return this.data[3]=t,this._onChangeCallback(),this}manhattanLength(){return Math.abs(this.data[0])+Math.abs(this.data[1])+Math.abs(this.data[2])+Math.abs(this.data[3])}setComponent(t,e){return this.data[t]=e,this._onChangeCallback(),this}getComponent(t){return this.data[t]}setScalar(t){return ht.set(t,t,t,t,this.data),this._onChangeCallback(),this}print(){return`Vec4 { x: ${this.data[0]}, y: ${this.data[1]}, z: ${this.data[2]}, w: ${this.data[3]} }`}invert(){return ht.negate(this.data,this.data),this._onChangeCallback(),this}equals(t){return ht.equals(this.data,t.data)}min(t){return ht.min(this.data,t.data,this.data),this._onChangeCallback(),this}max(t){return ht.max(this.data,t.data,this.data),this._onChangeCallback(),this}setFromMatrixColumn(t,e){return this.fromArray(t.data,e*4)}fromArray(t,e=0){return this.data[0]=t[e],this.data[1]=t[e+1],this.data[2]=t[e+2],this.data[3]=t[e+3],this._onChangeCallback(),this}divScalar(t){return ht.scale(this.data,1/t,this.data),this._onChangeCallback(),this}set(t,e,s){return ht.set(t,e,s,this.data),this._onChangeCallback(),this}add(t){return ht.add(t.data,this.data,this.data),this}addVectors(t,e){return ht.add(t.data,e.data,this.data),this}sub(t){return ht.sub(this.data,t.data,this.data),this}subVectors(t,e){return ht.sub(t.data,e.data,this.data),this._onChangeCallback(),this}copy(t){return ht.copy(t.data,this.data),this}clone(){return new be().copy(this)}distanceTo(t){return ht.distance(this.data,t.data)}dot(t){return ht.dot(this.data,t.data)}cross(t){return ht.cross(this.data,t.data,this.data),this}length(){return ht.length(this.data)}normalize(){return ht.normalize(this.data,this.data),this}applyMatrix4(t){return ht.transformMat4(this.data,this.data,t),this}applyQuaternion(t){return ht.transformQuat(this.data,this.data,t.data),this}multiplyScalar(t){return ht.scale(this.data,t,this.data),this}toArray(t=[],e=0){return t[e+0]=this.data[0],t[e+1]=this.data[1],t[e+2]=this.data[2],t[e+3]=this.data[3],t}subVectors(t,e){return ht.sub(t.data,e.data,this.data),this._onChangeCallback(),this}equalsArray(t,e=0){return this.data[0]===t[e]&&this.data[1]===t[e+1]&&this.data[2]===t[e+2]}lengthSq(){return ht.lengthSq(this.data)}crossVectors(t,e){return ht.cross(t.data,e.data,this.data),this._onChangeCallback(),this}clampLength(t,e){const s=this.length();return this.multiplyScalar(Math.max(t,Math.min(e,s))/s),this._onChangeCallback(),this}lerpVectors(t,e,s){return this.subVectors(e,t).multiplyScalar(s).add(t),this}setFromBufferAttribute(t,e){return this.data[0]=t.getX(e),this.data[1]=t.getY(e),this.data[2]=t.getZ(e),this.data[3]=t.getW(e),this._onChangeCallback(),this}clear(){return this.data.fill(0),this._onChangeCallback(),this}onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}static subVectors(t,e){return new be().subVectors(t,e)}static addVectors(t,e){return new be().addVectors(t,e)}static crossVectors(t,e){return new be().crossVectors(t,e)}};U(be,"byteSize",4*Float32Array.BYTES_PER_ELEMENT);let on=be;const ms=0,Xr=1,Qr=new L,Yr=new on,$r=new on,Jd=new L,qr=new W,_n=new L,Zr=new W;class kd extends Vn{constructor(t,e,s){super(t,e),this.isSkinnedMesh=!0,this.type="skinned_mesh",this.bindMode=ms,this.bindMatrix=new W,this.bindMatrixInverse=new W,this.boundingBox=null,this.boundingSphere=null,this.bonesMatrices=new Float32Array(16*s.bones.length),this.inverseBindMatrices=new Float32Array(16*s.bones.length),this.material.uniforms.unshift(new ae({name:"joint_matrices",perMesh:!0,bufferType:"storage",visibility:GPUShaderStage.VERTEX,uniforms:[new At("joint_matrices").storage("mat4x4f",s.bones.length)]}),new ae({name:"inverse_bind_matrices",perMesh:!0,bufferType:"storage",visibility:GPUShaderStage.VERTEX,uniforms:[new At("inverse_bind_matrices").storage("mat4x4f",s.bones.length)]})),this.bind(s)}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)this.getVertexPosition(s,_n),this.boundingBox.expandByPoint(_n)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ss),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let s=0;s<e.count;s++)this.getVertexPosition(s,_n),this.boundingSphere.expandByPoint(_n)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const s=this.material,r=this.matrixWorld;s!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere.copy(this.boundingSphere),_sphere.applyMatrix4(r),t.ray.intersectsSphere(_sphere)!==!1&&(Zr.copy(r).invert(),_ray.copy(t.ray).applyMatrix4(Zr),!(this.boundingBox!==null&&_ray.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,_ray)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new on,e=this.geometry.attributes.weights;for(let s=0,r=e.count;s<r;s++){console.log(e),t.setFromBufferAttribute(e,s);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(s,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===ms?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Xr?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.bindMode===ms?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Xr?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const s=this.skeleton,r=this.geometry;Yr.setFromBufferAttribute(r.attributes.joints,t),$r.setFromBufferAttribute(r.attributes.weights,t),Qr.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let i=0;i<4;i++){const o=$r.getComponent(i);if(o!==0){const h=Yr.getComponent(i);qr.multiplyMatrices(s.bones[h].matrixWorld,s.boneInverses[h]),e.addScaledVector(Jd.copy(Qr).applyMatrix4(qr),o)}}return e.applyMatrix4(this.bindMatrixInverse)}update(){this.updateWorldMatrix(!0,!0),this.skeleton.update(this.bindMatrixInverse),this.write(this.skeleton.boneMatrices,"joint_matrices"),this.write(this.skeleton.inverseBindMatrices,"inverse_bind_matrices")}}class zd{constructor(t,e){this.name=t,this.tracks=e,this.duration=this.calculateDuration()}calculateDuration(){let t=0;for(const e of this.tracks){const s=e.times[e.times.length-1];t=Math.max(t,s)}return t}}class Ks{constructor(t,e,s,r="LINEAR"){this.name=t,this.times=e,this.values=s,this.interpolation=r}evaluate(t){const e=this.times,s=this.values;if(t<=e[0])return s.slice(0,s.length/e.length);if(t>=e[e.length-1])return s.slice(-s.length/e.length);const r=this.findNextKeyframeIndex(t),i=r-1,o=e[i],h=e[r],m=(t-o)/(h-o);return this.interpolate(s.slice(i*s.length/e.length,(i+1)*s.length/e.length),s.slice(r*s.length/e.length,(r+1)*s.length/e.length),m)}findNextKeyframeIndex(t){const e=this.times;let s=1;for(;s<e.length&&t>=e[s];)s++;return s}interpolate(t,e,s){switch(this.interpolation){case"STEP":return t;case"LINEAR":return t.map((r,i)=>r+(e[i]-r)*s);case"CUBICSPLINE":return console.warn("CUBICSPLINE interpolation not implemented"),t;default:return console.warn(`Unknown interpolation ${this.interpolation}`),t}}}class Vd extends Ks{interpolate(t,e,s){return new L().lerpVectors(new L().fromArray(t),new L().fromArray(e),s).toArray()}}class jd extends Ks{interpolate(t,e,s){const r=new fe().fromArray(t),i=new fe().fromArray(e);return new fe().slerpQuaternions(r,i,s).toArray()}}const Kd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Wd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};class ze{constructor(t){if(ze.instance)return ze.instance;this.cache=new Map,this.textureLoader=new Nd(t),ze.instance=this}async load(t,e=0){return this.cache.clear(),this.instances=e,this.data=await Vr(t,Pn),console.log(this.data),this.parse(this.data,e)}async loadMesh(t,e=0){return this.cache.clear(),this.instances=e,this.data=await Vr(t,Pn),this.parseNode(this.data.json,this.data.buffers,0)}createGeometry(t,e,s){const r=new ii,i=t.primitives[0],o=this.parseAccessor(e,s,i.attributes.POSITION),h=this.parseAccessor(e,s,i.attributes.NORMAL),m=this.parseAccessor(e,s,i.attributes.TEXCOORD_0),g=this.parseAccessor(e,s,i.indices),w=this.parseAccessor(e,s,i.attributes.JOINTS_0),M=this.parseAccessor(e,s,i.attributes.WEIGHTS_0);return r.setFromArrays(g,o,h,m,w,M),r}createMaterial(t,e,s){let r=new sn({color:"#ffffff"});try{const i=t.primitives[0];if(i.material!==void 0){const h=e.materials[i.material].pbrMetallicRoughness;if((h==null?void 0:h.baseColorTexture)!==void 0){const m=e.textures[h.baseColorTexture.index],g=e.images[m.source];if(!g)return new sn({color:"#ffffff"});const w=e.bufferViews[g.bufferView],M=s[w.buffer],S=M.arrayBuffer.slice(M.byteOffset+w.byteOffset,M.byteOffset+w.byteOffset+w.byteLength),T=new Blob([S],{type:g.mimeType});this.textureLoader.loadFromBlob(T).then(P=>{r.diffuseMap=P})}}}catch(i){console.error(i)}return r}parse(t){const e=t.json,s=t.buffers,r=this.parseScenes(e,s),i=this.parseAnimations(e,s),h=r[e.scene||0].find(m=>m.isInstancedMesh);return{scenes:r,animations:i,instancedMeshes:h,scene:r[e.scene||0]}}parseScenes(t,e){return t.scenes.map(s=>{const r=new de;return s.nodes.forEach(i=>{const o=this.parseNode(t,e,i);r.add(o)}),r})}createSkeleton(t,e,s){const r=e.skins[t.skin],o=r.joints.map(w=>this.parseNode(e,s,w)).filter(w=>w instanceof Es);let h=this.parseAccessor(e,s,r.inverseBindMatrices),m=[];for(let w=0;w<o.length;w++){const M=new W().fromArray(h,w*16);m.push(M)}return new js(o,m)}parseAnimations(t,e){return t.animations?t.animations.map(s=>{const r=s.channels.map(i=>{const o=s.samplers[i.sampler],h=i.target,m=h.node!==void 0?t.nodes[h.node].name:h.node,g=t.accessors[o.input],w=t.accessors[o.output],M=this.parseAccessor(t,e,g),S=this.parseAccessor(t,e,w);let T;switch(h.path){case"translation":case"scale":T=Vd;break;case"rotation":T=jd;break;default:T=Ks}return new T(m+"."+h.path,M,S,o.interpolation)});return new zd(s.name,r)}):[]}isBone(t){var e;return(e=this.data.json.skins)==null?void 0:e.some(s=>s.joints.includes(t))}parseNode(t,e,s){if(this.cache.has(s))return this.cache.get(s);const r=t.nodes[s];let i;if(r.mesh!==void 0){const o=t.meshes[r.mesh],h=this.createGeometry(o,t,e),m=this.createMaterial(o,t,e);r.skin!==void 0?i=new kd(h,m,this.createSkeleton(r,t,e)):i=this.instances?new to(h,m,this.instances):new Vn(h,m)}else this.isBone(s)?i=new Es:i=new de;return r.name&&(i.name=r.name),this.cache.set(s,i),r.translation&&i.position.fromArray(r.translation),r.rotation&&i.quaternion.fromArray(r.rotation),r.scale&&i.scale.fromArray(r.scale),r.matrix&&(i.matrix.fromArray(r.matrix),i.matrix.compose(i.position,i.quaternion,i.scale)),r.children&&r.children.forEach(o=>{const h=this.parseNode(t,e,o);h&&i.add(h)}),i}parseAccessor(t,e,s){let r;if(typeof s=="object"?r=s:r=t.accessors[s],!r)return null;const i=t.bufferViews[r.bufferView],o=e[i.buffer],h=r.count,m=Wd[r.type],g=o.byteOffset+(r.byteOffset||0)+i.byteOffset,w=Kd[r.componentType];let M=h*m*w.BYTES_PER_ELEMENT,S=new w(o.arrayBuffer,g,h*m);if(M%4!==0){const T=Math.ceil(M/4)*4,P=new w(T);P.set(S),S=P}return S}}new L;new L;new L;new L;new L;new L;new L;class Xd extends ii{constructor(t=1,e=.2,s=1){super(),this.height=s,this.width=e,this.segments=Math.max(1,Math.floor(t)),this.build()}build(){const t=[],e=[],s=[],r=[];this.height/this.segments;for(let i=0;i<=this.segments;i++){const o=i/this.segments,h=o*this.height;let m,g;if(m=this.width/2*(1-o),g=.3*(1-o),t.push(-m,h,0),e.push(-g,.7,.7),s.push(0,o),t.push(m,h,0),e.push(g,.7,.7),s.push(1,o),i>0){const w=(i-1)*2;r.push(w,w+1,w+2,w+1,w+3,w+2)}}for(let i=0;i<e.length;i+=3){const o=new L(e[i],e[i+1],e[i+2]).normalize();e[i]=o.x,e[i+1]=o.y,e[i+2]=o.z}this.setFromArrays(r,t,e,s)}}const Qd="/assets/terrain_2-BtXSWZh4.glb",Yd="/assets/tree-BFp3LkNt.gltf";class $d{constructor(t,e){this.camera=t,this.canvas=e,this.moveSpeed=50,this.lookSpeed=.002,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.pitch=0,this.yaw=0,this.moveVector=new L(0,0,0),this.direction=new L(0,0,-1),this.right=new L(1,0,0),this.up=new L(0,1,0),this.isLocked=!1,this.bindEvents(),this.setupPointerLock()}setupPointerLock(){this.canvas.addEventListener("click",()=>{this.isLocked||this.canvas.requestPointerLock()}),document.addEventListener("pointerlockchange",()=>{this.isLocked=document.pointerLockElement===this.canvas})}bindEvents(){document.addEventListener("mousemove",t=>{if(!this.isLocked)return;const e=t.movementX||0,s=t.movementY||0;this.yaw-=e*this.lookSpeed,this.pitch-=s*this.lookSpeed,this.pitch=Math.max(-Math.PI/2,Math.min(Math.PI/2,this.pitch)),this.updateCameraRotation()}),document.addEventListener("keydown",t=>this.updateMovementState(t,!0)),document.addEventListener("keyup",t=>this.updateMovementState(t,!1))}updateMovementState(t,e){switch(t.code){case"KeyW":this.moveForward=e;break;case"KeyS":this.moveBackward=e;break;case"KeyA":this.moveLeft=e;break;case"KeyD":this.moveRight=e;break;case"Space":this.moveUp=e;break;case"ShiftLeft":this.moveDown=e;break}}updateCameraRotation(){const t=Math.cos(this.pitch);this.direction.set(Math.sin(this.yaw)*t,Math.sin(this.pitch),Math.cos(this.yaw)*t),this.right.crossVectors(this.up,this.direction).normalize(),this.camera.direction.copy(this.direction);const e=new L().copy(this.camera.position).add(this.direction);this.camera.lookAt(e),this.camera.target.copy(e)}update(t){if(this.isLocked&&(this.moveVector.set(0,0,0),this.moveForward&&this.moveVector.add(this.direction),this.moveBackward&&this.moveVector.sub(this.direction),this.moveRight&&this.moveVector.sub(this.right),this.moveLeft&&this.moveVector.add(this.right),this.moveUp&&this.moveVector.add(this.up),this.moveDown&&this.moveVector.sub(this.up),this.moveVector.length()>0)){this.moveVector.normalize().multiplyScalar(this.moveSpeed*t);const e=this.camera.position.clone();e.add(this.moveVector),this.camera.setPosition(e)}}}new L;class qd{constructor(){}createPatchesOfGrass(t,e,s,r){const i=new to(new Xd(4,.2,1),new sn({color:"#9DA326"}),e),o=new fe,h=[],m=[],g=[];for(let w=0;w<e;w++){const M=Pt(t.x-s,t.x+s),S=Pt(t.z-s,t.z+s),T=r.getHeightAt(M,S);h.push(M,T,S),o.setFromEulerAngles(Pt(-.3,.3),Pt(-Math.PI,Math.PI),Pt(-.3,-.5)),m.push(o.x,o.y,o.z,o.w),g.push(Pt(.1,2.5))}return i.material.useWind=!0,i.material.windHeight=2.5,i.material.windStrength=50,i.material.ambientIntensity=1,i.setAllPositionsArray(h),i.setAllRotationsArray(m),i.setAllScalesArray(g),i.material.chunks.fragment.push(new le("fragment_diffuse_map",`
            let noise = noise2D(input.vPositionW.xz * 0.02) * 0.3 + 1.0;
            let y = 1.0;
            color = vec4f(color.r * noise * y, color.g * noise * y, color.b * y * noise, 1.0);
        `)),i}async init(){const t=document.getElementById("canvas");this.stats=new oo,this.last=performance.now(),this.elapsed=0,document.body.appendChild(this.stats.dom),this.renderer=new ra(t),await this.renderer.init(),this.scene=new oa,this.camera=new ia(50,this.renderer.aspect,.1,600),this.camera.position.z=-20,this.camera.position.y=20,this.camera.position.x=-20,this.camera.lookAt(0,0,0),this.camera.target.set(0,-25,0),this.camera.name="MainCamera",this.scene.add(this.camera);const e=await new ze(this.renderer).loadMesh(Qd);e.material.diffuseMap=this.renderer.textures.getTexture("default"),e.setScale(4),this.terrain=e,this.scene.add(e),e.initializeSpatialGrid(64),e.isCulled=!1;const s=await new ze(this.renderer).load(Yd,50),r=[],i=[],o=[],h=new fe;for(let w=0;w<s.instancedMeshes[0].count;w++){const M=Pt(-400,400),S=Pt(-400,400),T=e.getHeightAt(M,S);r.push(M,T,S),o.push(Pt(2,3)),h.setFromEulerAngles(0,Pt(0,Math.PI*2),0),i.push(h.x,h.y,h.z,h.w)}s.instancedMeshes.forEach(w=>{w.material.alphaTest=.2,w.material.ambientIntensity=2,w.setAllPositionsArray(r),w.setAllScalesArray(o),w.setAllRotationsArray(i),this.scene.add(w)});const m=400,g=800;for(let w=-g/2;w<g/2;w+=m)for(let M=-g/2;M<g/2;M+=m)this.scene.add(this.createPatchesOfGrass({x:w+m*.5,z:M+m*.5},1e6,m/2,e));this.light=new Fs({intensity:1}),this.light.name="MyDirectionalLight",this.light.rotation.x=-Math.PI/3,this.light.rotation.y=-.3,this.scene.add(this.light),this.controls=new $d(this.camera,t),requestAnimationFrame(()=>this.loop())}loop(){const t=performance.now(),e=(t-this.last)/1e3;this.last=t,this.elapsed+=e,this.update(e),requestAnimationFrame(()=>this.loop())}update(t){var e;this.stats.update(),(e=this.controls)==null||e.update(t),this.camera.setPosition(this.camera.position.x,this.terrain.getHeightAt(this.camera.position.x,this.camera.position.z)+10,this.camera.position.z),this.renderer.render(this.scene,this.camera)}}const Zd=new qd;Zd.init();
